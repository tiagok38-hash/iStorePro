const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ProductModal-D-J2CwZs.js","assets/index-BMA--0RW.js","assets/react-vendor-Bv8thS0I.js","assets/supabase-C1Qlw3jS.js","assets/CurrencyInput-DaWIS5Fg.js","assets/SearchableDropdown-Cwt49rKC.js","assets/CustomerModal-Cs-UW485.js","assets/Button-wK47DqCu.js","assets/PurchaseOrderModal-BwkkzoWZ.js","assets/StockInModal-Dx5N_4VN.js"])))=>i.map(i=>d[i]);
import{u as Ge,j as e,M as qs,P as fe,S as H,e as $s,f as v,A as k,X as ye,h as Us,I as Hs,i as Fs,g as Rs,a as zs,k as Bs,l as Vs,m as _s,n as Ks,o as Gs,p as Ws,q as Qs,r as Js,b as Ys,s as Xs,T as Zs,t as et,v as ze,w as st,x as tt,E as at,y as rt,z as We,B as ot,D as Be,F as Qe,G as nt,H as ct,J as lt,K as dt,L as it,_ as Ne,N as xt,O as mt,Q as ut,R as ht,V as pt,W as gt,Y as bt,Z as jt,$ as ft,a0 as yt}from"./index-BMA--0RW.js";import{r as a,L as Nt}from"./react-vendor-Bv8thS0I.js";import{C as be}from"./ConfirmationModal-CVAza7gk.js";import{S as wt}from"./SaleDetailModal-DuxgAQqk.js";import{C as je}from"./CurrencyInput-DaWIS5Fg.js";import{P as vt}from"./PurchaseOrderDetailModal-B9r54sPu.js";import{D as St}from"./DeleteWithReasonModal-BnPkPZth.js";import"./supabase-C1Qlw3jS.js";const Ct=({product:n,onClose:u,onSave:h})=>{const[i,o]=a.useState(0),{showToast:r}=Ge(),d=n.stock+i,m=!!(n.serialNumber||n.imei1||n.imei2)&&d>1,j=()=>{if(m){r("Produtos únicos (com IMEI/Nº de Série) não podem ter estoque maior que 1.","error");return}h(n,d)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-surface rounded-lg shadow-xl p-6 w-full max-w-md mx-4",children:[e.jsx("h2",{className:"text-xl font-bold text-primary mb-2",children:"Ajustar Estoque"}),e.jsx("p",{className:"text-muted mb-6",children:n.model}),e.jsxs("div",{className:"flex items-center justify-center gap-4 my-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-center text-muted",children:"Estoque Atual"}),e.jsx("p",{className:"text-4xl font-bold text-center",children:n.stock})]}),e.jsx("div",{className:"text-4xl font-light text-muted",children:"+"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-center text-muted",children:"Ajuste"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>o(N=>N-1),className:"p-2 rounded-full bg-gray-200 hover:bg-gray-300",children:e.jsx(qs,{className:"h-5 w-5"})}),e.jsx("input",{type:"number",value:i,onChange:N=>o(parseInt(N.target.value)||0),className:"w-20 text-center p-2 border rounded bg-transparent border-border text-4xl font-bold"}),e.jsx("button",{onClick:()=>o(N=>N+1),className:"p-2 rounded-full bg-gray-200 hover:bg-gray-300",children:e.jsx(fe,{className:"h-5 w-5"})})]})]}),e.jsx("div",{className:"text-4xl font-light text-muted",children:"="}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-center text-muted",children:"Novo Estoque"}),e.jsx("p",{className:`text-4xl font-bold text-center ${d<0?"text-danger":"text-primary"}`,children:d})]})]}),m&&e.jsx("p",{className:"text-center text-sm text-danger mt-2",children:"Produtos únicos não podem ter estoque maior que 1."}),e.jsxs("div",{className:"flex justify-end space-x-4 mt-8",children:[e.jsx("button",{type:"button",onClick:u,className:"px-4 py-2 bg-danger text-white rounded-md hover:bg-danger/90",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:j,className:"px-4 py-2 bg-success text-white rounded-md hover:bg-success/90 disabled:bg-muted disabled:cursor-not-allowed",disabled:d<0||i===0||m,title:m?"Produtos únicos não podem ter estoque maior que 1.":"",children:"Confirmar Ajuste"})]})]})})},we=n=>new Date(n).toLocaleString("pt-BR",{dateStyle:"short",timeStyle:"short"}),Pt=({product:n,sales:u,customers:h,users:i,onRowClick:o})=>{const r=c=>h.find(m=>m.id===c)?.name||"N/A",d=c=>i.find(m=>m.id===c)?.name||"N/A";return e.jsx("div",{className:"overflow-x-auto",children:u.length===0?e.jsx("div",{className:"text-center text-muted py-8",children:"Nenhuma venda registrada para este produto."}):e.jsxs("table",{className:"w-full text-sm text-left text-muted",children:[e.jsx("thead",{className:"text-xs text-secondary uppercase bg-surface-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-3",children:"ID Venda"}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:"Data"}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:"Cliente"}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:"Vendedor"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-center",children:"Qtd."}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-right",children:"Preço Unit."}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-right",children:"Total Item"})]})}),e.jsx("tbody",{children:u.map(c=>{const m=c.items.find(j=>j.productId===n.id);return m?e.jsxs("tr",{className:"bg-surface border-b border-border hover:bg-surface-secondary cursor-pointer",onClick:()=>o(c),children:[e.jsx("td",{className:"px-4 py-3 font-medium text-primary",children:c.id}),e.jsx("td",{className:"px-4 py-3",children:we(c.date)}),e.jsx("td",{className:"px-4 py-3",children:r(c.customerId)}),e.jsx("td",{className:"px-4 py-3",children:d(c.salespersonId)}),e.jsx("td",{className:"px-4 py-3 font-semibold text-primary text-center",children:m.quantity}),e.jsx("td",{className:"px-4 py-3 text-right",children:v(m.unitPrice)}),e.jsx("td",{className:"px-4 py-3 font-semibold text-primary text-right",children:v(m.unitPrice*m.quantity)})]},c.id):null})})]})})},kt=({product:n})=>{const u=n.priceHistory||[];if(u.length===0)return e.jsx("div",{className:"text-center text-muted py-8",children:"Nenhum registro encontrado."});const h=[...u].sort((i,o)=>new Date(o.timestamp).getTime()-new Date(i.timestamp).getTime());return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-muted",children:[e.jsx("thead",{className:"text-xs text-secondary uppercase bg-surface-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Data/Hora"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right",children:"Preço Anterior"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right",children:"Novo Preço"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right",children:"Variação"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Alterado Por"})]})}),e.jsx("tbody",{children:h.map(i=>{const o=i.newPrice-i.oldPrice,r=i.oldPrice>0?(o/i.oldPrice*100).toFixed(1):"100";return e.jsxs("tr",{className:"bg-surface border-b border-border",children:[e.jsx("td",{className:"px-6 py-4",children:we(i.timestamp)}),e.jsx("td",{className:"px-6 py-4 text-right",children:v(i.oldPrice)}),e.jsx("td",{className:"px-6 py-4 text-right font-semibold text-primary",children:v(i.newPrice)}),e.jsxs("td",{className:`px-6 py-4 text-right font-medium ${o>=0?"text-success":"text-danger"}`,children:[o>=0?"+":"",v(o)," (",r,"%)"]}),e.jsx("td",{className:"px-6 py-4",children:i.changedBy})]},i.id)})})]})})},Tt=({product:n,auditLogs:u=[]})=>{let h=n.stockHistory||[];if(h.length===0&&u.length>0){const r=[k.STOCK_ADJUST,k.STOCK_LAUNCH,k.STOCK_REVERT,k.SALE_CREATE,k.SALE_CANCEL,k.PURCHASE_LAUNCH],d=u.filter(c=>r.includes(c.action));if(d.length>0){const c={[k.STOCK_LAUNCH]:"Lançamento de Estoque",[k.STOCK_ADJUST]:"Ajuste Manual",[k.SALE_CREATE]:"Venda",[k.SALE_CANCEL]:"Cancelamento de Venda",[k.PURCHASE_LAUNCH]:"Entrada por Compra"};h=d.map(m=>({id:m.id,timestamp:m.timestamp,reason:c[m.action]||"Movimentação",oldStock:"-",adjustment:0,newStock:"-",details:m.details,changedBy:m.userName}))}}if(h.length===0)return e.jsx("div",{className:"text-center text-muted py-8",children:"Nenhum registro encontrado."});const i=[...h].sort((r,d)=>new Date(d.timestamp).getTime()-new Date(r.timestamp).getTime()),o={Venda:"bg-blue-100 text-blue-700","Cancelamento de Venda":"bg-orange-100 text-orange-700","Ajuste Manual":"bg-yellow-100 text-yellow-700","Lançamento de Estoque":"bg-green-100 text-green-700","Entrada por Compra":"bg-purple-100 text-purple-700"};return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-muted",children:[e.jsx("thead",{className:"text-xs text-secondary uppercase bg-surface-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-3",children:"Data/Hora"}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:"Motivo"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-center",children:"Anterior"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-center",children:"Ajuste"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-center",children:"Novo"}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:"Detalhes"}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:"Por"})]})}),e.jsx("tbody",{children:i.map(r=>e.jsxs("tr",{className:"bg-surface border-b border-border",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:we(r.timestamp)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-md text-xs font-semibold whitespace-nowrap ${o[r.reason]||"bg-gray-100 text-gray-700"}`,children:r.reason})}),e.jsx("td",{className:"px-4 py-3 text-center",children:r.oldStock}),e.jsx("td",{className:`px-4 py-3 text-center font-bold ${r.adjustment>0?"text-success":r.adjustment<0?"text-danger":"text-muted"}`,children:r.adjustment!==0?r.adjustment>0?`+${r.adjustment}`:r.adjustment:"-"}),e.jsx("td",{className:"px-4 py-3 text-center font-semibold text-primary",children:r.newStock}),e.jsx("td",{className:"px-4 py-3 text-xs text-muted max-w-xs truncate",title:r.details,children:r.details}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:r.changedBy})]},r.id))})]})})},Dt=({product:n,salesHistory:u,customers:h,users:i,productMap:o,onClose:r})=>{const[d,c]=a.useState("sales"),[m,j]=a.useState(null),[N,S]=a.useState([]),[T,p]=a.useState(!0);return a.useEffect(()=>{(async()=>{p(!0);try{const D=(await $s()).filter(L=>L.entityId===n.id);S(D)}catch(b){console.error("Failed to fetch audit logs",b)}finally{p(!1)}})()},[n.id]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-surface rounded-lg shadow-xl p-6 w-full max-w-5xl mx-4 max-h-[90vh] flex flex-col",children:[e.jsx("h2",{className:"text-xl font-bold text-primary mb-2",children:"Histórico do Produto"}),e.jsx("p",{className:"text-muted mb-4 font-semibold",children:n.model}),e.jsx("div",{className:"border-b border-border mb-4",children:e.jsxs("nav",{className:"-mb-px flex space-x-6",children:[e.jsx("button",{onClick:()=>c("sales"),className:`py-2 px-1 border-b-2 text-sm font-medium ${d==="sales"?"border-success text-success":"border-transparent text-muted hover:text-primary"}`,children:"Histórico de Vendas"}),e.jsx("button",{onClick:()=>c("prices"),className:`py-2 px-1 border-b-2 text-sm font-medium ${d==="prices"?"border-success text-success":"border-transparent text-muted hover:text-primary"}`,children:"Histórico de Preços"}),e.jsx("button",{onClick:()=>c("stock"),className:`py-2 px-1 border-b-2 text-sm font-medium ${d==="stock"?"border-success text-success":"border-transparent text-muted hover:text-primary"}`,children:"Histórico de Estoque"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2",children:T?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(H,{})}):e.jsxs(e.Fragment,{children:[d==="sales"&&e.jsx(Pt,{product:n,sales:u,customers:h,users:i,onRowClick:j}),d==="prices"&&e.jsx(kt,{product:n}),d==="stock"&&e.jsx(Tt,{product:n,auditLogs:N})]})}),e.jsx("div",{className:"flex justify-end mt-6 pt-4 border-t border-border",children:e.jsx("button",{type:"button",onClick:r,className:"px-6 py-2 bg-danger text-white rounded-md hover:bg-danger/90",children:"Fechar"})})]})}),m&&e.jsx(wt,{sale:m,productMap:o,customers:h,users:i,onClose:()=>j(null)})]})},Et=({allProducts:n,onClose:u,onBulkUpdate:h})=>{const[i,o]=a.useState("todas"),[r,d]=a.useState(""),[c,m]=a.useState([]),[j,N]=a.useState(!1),[S,T]=a.useState(null),[p,C]=a.useState(null),[b,D]=a.useState(null),[L,K]=a.useState(!1),G=()=>{N(!0);const g=r.toLowerCase(),I=n.filter(P=>{const W=`${P.brand} ${P.model} ${P.color||""}`.toLowerCase().includes(g),te=i==="todas"||P.condition===i,O=P.stock>0;return W&&te&&O});setTimeout(()=>{m(I),N(!1)},300)},se=async()=>{if(c.length===0)return;if(S===null&&p===null&&b===null){alert("Preencha pelo menos um campo de preço para atualizar.");return}K(!0);const g=c.map(I=>({id:I.id,...p!==null&&{price:p},...S!==null&&{costPrice:S},...b!==null&&{wholesalePrice:b}}));await h(g),K(!1)},M="p-2 border rounded bg-surface border-border focus:ring-success focus:border-success text-sm",F=`${M} font-semibold`;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4",children:e.jsxs("div",{className:"bg-surface rounded-lg shadow-xl w-full max-w-5xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("h2",{className:"text-xl font-bold text-primary",children:"Atualização de Preço em massa"})}),e.jsx("button",{onClick:u,className:"p-1 text-muted hover:text-danger",children:e.jsx(ye,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{value:i,onChange:g=>o(g.target.value),className:`${M} w-52`,children:[e.jsx("option",{value:"todas",children:"Todas as Condições"}),e.jsx("option",{children:"Novo"}),e.jsx("option",{children:"Seminovo"}),e.jsx("option",{children:"CPO"}),e.jsx("option",{children:"Openbox"})]}),e.jsx("input",{type:"text",placeholder:"Digite o nome do produto para buscar...",value:r,onChange:g=>d(g.target.value),className:`${M} flex-1`}),e.jsxs("button",{onClick:G,disabled:j,className:"flex items-center justify-center gap-2 px-6 py-2 bg-primary text-white rounded-md hover:bg-primary/90 disabled:bg-muted",children:[j?e.jsx(H,{className:"h-5 w-5"}):e.jsx(Us,{}),"BUSCAR"]})]}),e.jsxs("div",{className:"p-3 bg-accent-light text-accent rounded-md text-sm flex items-start gap-2",children:[e.jsx(Hs,{className:"h-5 w-5 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Dica de busca eficiente:"}),' Utilize a mesma nomenclatura dos itens disponíveis em seu estoque, como por exemplo: "iPhone 16 Pro Max 512GB", dessa forma exibirá somente os produtos que correspondem com a informação digitada.']})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto border-t border-b border-border",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"text-left text-xs text-muted bg-surface-secondary sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2",children:"Descrição"}),e.jsx("th",{className:"p-2 text-center",children:"Estoque atual"}),e.jsx("th",{className:"p-2 text-right",children:"Custo atual"}),e.jsx("th",{className:"p-2 text-right",children:"Venda atual"}),e.jsx("th",{className:"p-2 text-right",children:"ATC atual"})]})}),e.jsx("tbody",{children:c.map(g=>{const I=`${g.brand} ${g.model}`,P=g.color&&!I.toLowerCase().includes(g.color.toLowerCase());return e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("td",{className:"p-2 font-medium text-primary",children:`${I}${P?" "+g.color:""}`}),e.jsx("td",{className:"p-2 text-center",children:g.stock}),e.jsx("td",{className:"p-2 text-right",children:v(g.costPrice||0)}),e.jsx("td",{className:"p-2 text-right font-semibold",children:v(g.price)}),e.jsx("td",{className:"p-2 text-right text-muted",children:v(g.wholesalePrice||0)})]},g.id)})})]}),c.length===0&&!j&&e.jsx("p",{className:"text-center text-muted py-8",children:"Nenhum produto encontrado. Refine sua busca."})]}),e.jsxs("div",{className:"p-4 bg-surface-secondary flex items-end justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-muted",children:["Para atualizar os preços dos itens listados, preencha apenas os campos que deseja modificar. ",e.jsx("span",{className:"font-semibold",children:"Deixe vazio os que não deseja alterar."})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-muted mb-1",children:"Novo preço de Custo"}),e.jsx(je,{value:S,onChange:T,className:`${F} w-36`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-muted mb-1",children:"Novo preço de Venda"}),e.jsx(je,{value:p,onChange:C,className:`${F} w-36`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-muted mb-1",children:"Novo preço ATC"}),e.jsx(je,{value:b,onChange:D,className:`${F} w-36`})]}),e.jsx("button",{onClick:se,disabled:L||c.length===0,className:"px-6 py-2 bg-primary text-white rounded-md hover:bg-primary/90 disabled:bg-muted self-end",children:L?e.jsx(H,{className:"h-5 w-5"}):"ATUALIZAR"})]})]})]})})},It=a.lazy(()=>Ne(()=>import("./ProductModal-D-J2CwZs.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),Lt=a.lazy(()=>Ne(()=>import("./PurchaseOrderModal-BwkkzoWZ.js"),__vite__mapDeps([8,1,2,3,4,5,6,7])).then(n=>({default:n.PurchaseOrderModal}))),At=a.lazy(()=>Ne(()=>import("./StockInModal-Dx5N_4VN.js"),__vite__mapDeps([9,1,2,3,4]))),Mt=({onHistory:n,onUpdateStock:u,onEdit:h,onDelete:i,permissions:o})=>{const[r,d]=a.useState(!1),c=a.useRef(null),m=a.useRef(null),[j,N]=a.useState({}),S=()=>{if(r)d(!1);else{if(!c.current)return;const p=c.current.getBoundingClientRect(),C=window.innerHeight-p.bottom,b=160,D={position:"fixed",width:"11rem",right:window.innerWidth-p.right,zIndex:50};C<b&&p.top>b?D.bottom=window.innerHeight-p.top:D.top=p.bottom,N(D),d(!0)}};a.useEffect(()=>{const p=b=>{r&&m.current&&!m.current.contains(b.target)&&c.current&&!c.current.contains(b.target)&&d(!1)},C=()=>{r&&d(!1)};return document.addEventListener("mousedown",p),window.addEventListener("scroll",C,!0),window.addEventListener("resize",C),()=>{document.removeEventListener("mousedown",p),window.removeEventListener("scroll",C,!0),window.removeEventListener("resize",C)}},[r]);const T="w-full text-left flex items-center gap-3 px-4 py-2 text-sm";return e.jsxs("div",{children:[e.jsx("button",{ref:c,onClick:S,className:"p-1 rounded-full hover:bg-gray-200 text-muted",children:e.jsx(bt,{className:"h-5 w-5"})}),r&&e.jsx("div",{ref:m,style:j,className:"rounded-md shadow-lg bg-surface ring-1 ring-black ring-opacity-5",children:e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{onClick:()=>{n(),d(!1)},className:`${T} text-secondary hover:bg-surface-secondary`,children:[e.jsx(jt,{className:"h-4 w-4"})," Histórico"]}),o?.canEditStock&&e.jsxs("button",{onClick:()=>{u(),d(!1)},className:`${T} text-secondary hover:bg-surface-secondary`,children:[e.jsx(ft,{className:"h-4 w-4"})," Editar Estoque"]}),o?.canEditProduct&&e.jsxs("button",{onClick:()=>{h(),d(!1)},className:`${T} text-secondary hover:bg-surface-secondary`,children:[e.jsx(We,{className:"h-4 w-4"})," Editar"]}),o?.canDeleteProduct&&e.jsxs("button",{onClick:()=>{i(),d(!1)},className:`${T} text-danger hover:bg-danger-light`,children:[e.jsx(Qe,{className:"h-4 w-4"})," Excluir"]})]})})]})},Ve=({text:n,type:u})=>{const h={success:"bg-green-100 text-green-700",warning:"bg-orange-100 text-orange-700","warning-filled":"bg-orange-500 text-white",danger:"bg-red-100 text-red-700",info:"bg-blue-100 text-blue-700",default:"bg-gray-100 text-gray-700"};return e.jsx("span",{className:`px-2.5 py-1 text-xs font-semibold rounded-full ${h[u]}`,children:n})},Ot=n=>{if(!n)return"bg-gray-100 text-gray-700";if(n.linkedCustomerId)return"bg-purple-100 text-purple-700 border border-purple-200";const u=["bg-blue-100 text-blue-700 border border-blue-200","bg-green-100 text-green-700 border border-green-200","bg-orange-100 text-orange-700 border border-orange-200","bg-pink-100 text-pink-700 border border-pink-200","bg-teal-100 text-teal-700 border border-teal-200","bg-cyan-100 text-cyan-700 border border-cyan-200","bg-indigo-100 text-indigo-700 border border-indigo-200"];let h=0;const i=n.id||n.name;for(let r=0;r<i.length;r++)h=i.charCodeAt(r)+((h<<5)-h);const o=Math.abs(h)%u.length;return u[o]},_e=()=>{const n=new Date;return new Date(n.getFullYear(),n.getMonth(),1).toISOString().split("T")[0]},Ke=()=>{const n=new Date;return new Date(n.getFullYear(),n.getMonth()+1,0).toISOString().split("T")[0]},Vt=()=>{const[n,u]=a.useState("estoque"),[h,i]=a.useState(!0),{showToast:o}=Ge(),{permissions:r,user:d}=Fs(),[c,m]=a.useState([]),[j,N]=a.useState([]),[S,T]=a.useState([]),[p,C]=a.useState([]),[b,D]=a.useState([]),[L,K]=a.useState([]),[G,se]=a.useState([]),[M,F]=a.useState([]),[g,I]=a.useState([]),[P,ve]=a.useState([]),[W,te]=a.useState([]),[O,Se]=a.useState(""),[Je,Ce]=a.useState(!1),[Pe,ae]=a.useState(!1),[Ye,ke]=a.useState(!1),[Xe,re]=a.useState(!1),[Ze,oe]=a.useState(!1),[Q,es]=a.useState(null),[J,Te]=a.useState(null),[De,ss]=a.useState(null),[Ee,ne]=a.useState(null),[ts,as]=a.useState([]),[E,rs]=a.useState({stock:"Em estoque",condition:"Todos",location:"Todos"}),[ce,os]=a.useState("newest"),[ns,Y]=a.useState(!1),[Ie,Le]=a.useState(null),[R,Ae]=a.useState(null),[cs,Me]=a.useState(null),[z,le]=a.useState(null),[q,de]=a.useState(null),[B,ie]=a.useState(null),[X,Oe]=a.useState(""),[V,Z]=a.useState(_e()),[_,ee]=a.useState(Ke()),[xe,ls]=a.useState("newest"),[$,ds]=a.useState("Todos"),[is,xs]=a.useState("mes"),w=a.useCallback(async()=>{i(!0);try{const[s,t,x,l,f,y,A,pe,ge,Ms,Os]=await Promise.all([Rs(),zs(),Bs(),Vs(),_s(),Ks(),Gs(),Ws(),Qs(),Js(),Ys()]);m(s),N(t),T(x),C(l),D(f),K(y),se(A),F(pe),I(ge),ve(Ms),te(Os)}catch{o("Erro ao carregar dados.","error")}finally{i(!1)}},[o]);a.useEffect(()=>{w();const s=()=>w();window.addEventListener("company-data-updated",s);const t=new BroadcastChannel("app-updates");return t.onmessage=x=>{x.data==="company-data-updated"&&w()},()=>{window.removeEventListener("company-data-updated",s),t.close()}},[w]);const U=a.useMemo(()=>{const s=[];return r?.canAccessEstoque&&s.push({id:"estoque",label:"Estoque"}),r?.canViewPurchases&&s.push({id:"compras",label:"Compras"}),s},[r]);a.useEffect(()=>{U.length>0&&!U.find(s=>s.id===n)&&u(U[0].id)},[U,n]);const qe=a.useMemo(()=>new Set(W.filter(s=>s.status==="Finalizada").flatMap(s=>s.items).map(s=>s.productId)),[W]),me=a.useMemo(()=>{const s=O.toLowerCase().trim(),t=s?new Set(p.filter(l=>(l.locatorId||"").toLowerCase().includes(s)).map(l=>l.id)):new Set;return[...c.filter(l=>{const f=s===""||(l.model||"").toLowerCase().includes(s)||(l.brand||"").toLowerCase().includes(s)||(l.serialNumber||"").toLowerCase().includes(s)||(l.imei1||"").toLowerCase().includes(s)||l.imei2&&(l.imei2||"").toLowerCase().includes(s)||l.barcodes&&l.barcodes.some(ge=>(ge||"").toLowerCase().includes(s))||l.purchaseOrderId&&t.has(l.purchaseOrderId),y=E.stock==="Todos"?!0:E.stock==="Em estoque"?l.stock>0:l.stock===0,A=E.condition==="Todos"?!0:l.condition===E.condition,pe=E.location==="Todos"?!0:l.storageLocation===E.location;return f&&y&&A&&pe})].sort((l,f)=>ce==="newest"?new Date(f.createdAt).getTime()-new Date(l.createdAt).getTime():new Date(l.createdAt).getTime()-new Date(f.createdAt).getTime())},[c,O,E,ce,p]),ms=a.useMemo(()=>c.reduce((s,t)=>({...s,[t.id]:t}),{}),[c]),$e=a.useMemo(()=>S.reduce((s,t)=>({...s,[t.id]:t}),{}),[S]),ue=(s,t)=>rs(x=>({...x,[s]:t})),us=(s=null)=>{es(s?{...s}:{}),Ce(!0)},Ue=()=>{Ce(!1)},hs=async s=>{try{if(Q&&"id"in Q)await mt({...Q,...s},d?.id,d?.name),o("Produto atualizado com sucesso!","success");else{const t={...s};await ut(t,d?.id,d?.name),o("Produto adicionado com sucesso!","success")}w(),Ue()}catch(t){o(t.message||"Erro ao salvar produto.","error")}},ps=s=>{if(qe.has(s.id)&&s.stock===0){o("Não é possível excluir um produto que já foi vendido e está com estoque zero. Você deve cancelar a venda primeiro para que o produto retorne ao estoque.","warning");return}Te(s),ae(!0)},gs=async()=>{if(J)try{await lt(J.id,d?.id,d?.name),o("Produto excluído com sucesso!","success"),w(),ae(!1),Te(null)}catch{o("Erro ao excluir produto.","error")}},bs=async s=>{ss(s);try{const t=await yt(s.id);as(t),ke(!0)}catch{o("Erro ao carregar histórico de vendas.","error")}},js=async s=>{try{await dt(s,d?.id,d?.name),o(`${s.length} produtos atualizados com sucesso!`,"success"),re(!1),w()}catch{o("Erro ao atualizar produtos em massa.","error")}},fs=s=>{ne(s),oe(!0)},ys=async(s,t)=>{try{await it(s.id,t),o("Estoque atualizado com sucesso!","success"),oe(!1),ne(null),w()}catch(x){o(x.message||"Erro ao atualizar o estoque.","error")}},Ns=s=>{switch(s){case"Novo":return"bg-blue-100 text-blue-800 border border-blue-200";case"Seminovo":return"bg-amber-100 text-amber-800 border border-amber-200";case"CPO":return"bg-purple-100 text-purple-800 border border-purple-200";case"Openbox":return"bg-teal-100 text-teal-800 border border-teal-200";default:return"bg-gray-100 text-gray-800 border border-gray-200"}},He=async s=>{try{const t=await xt(s);return D(x=>[...x,t]),o("Fornecedor adicionado com sucesso!","success"),t}catch{return o("Erro ao adicionar fornecedor.","error"),null}},he=s=>{xs(s);const t=new Date;if(t.setHours(0,0,0,0),s==="hoje"){const x=t.toISOString().split("T")[0];Z(x),ee(x)}else if(s==="semana"){const x=new Date(t.setDate(t.getDate()-t.getDay())),l=new Date(x);l.setDate(l.getDate()+6),Z(x.toISOString().split("T")[0]),ee(l.toISOString().split("T")[0])}else s==="mes"&&(Z(_e()),ee(Ke()))},ws=s=>{navigator.clipboard.writeText(s).then(()=>{o("Localizador copiado!","success")}).catch(t=>{o("Falha ao copiar.","error")})},Fe=a.useMemo(()=>[...p.filter(t=>{const x=X.toLowerCase(),l=x===""||(t.supplierName||"").toLowerCase().includes(x)||(t.displayId||"").toString().includes(x)||(t.locatorId||"").toLowerCase().includes(x),f=$==="Todos"||t.status===$||t.stockStatus===$||t.financialStatus===$,y=t.purchaseDate.split("T")[0],A=y>=V&&y<=_;return l&&f&&A})].sort((t,x)=>xe==="newest"?new Date(x.purchaseDate).getTime()-new Date(t.purchaseDate).getTime():new Date(t.purchaseDate).getTime()-new Date(x.purchaseDate).getTime()),[p,X,$,xe,V,_]),vs=s=>{Me(s),Y(!0)},Ss=s=>{Y(!1),Me(null),s&&(w(),u("compras"))},Cs=s=>{Le(null),s&&(w(),u("compras"))},Ps=async s=>{if(z)try{await ht(z.id),o("Compra excluída com sucesso!","success"),le(null),w()}catch(t){o(t.message||"Erro ao excluir compra.","error")}},ks=async()=>{if(q)try{await pt(q.id),o("Status financeiro atualizado!","success"),de(null),w()}catch{o("Erro ao atualizar status financeiro.","error")}},Ts=async()=>{if(B)try{await gt(B.id),o("Lançamento da compra revertido com sucesso!","success"),ie(null),w()}catch{o("Erro ao reverter o lançamento.","error")}},Ds=a.useMemo(()=>R?c.filter(s=>s.purchaseOrderId===R.id):[],[c,R]),Es=s=>{switch(s){case"Lançado":return"success";case"Pendente":return"warning";case"Parcialmente Lançado":return"warning";default:return"warning"}},Is=s=>s==="Pendente"?"warning":"success",Re=a.useMemo(()=>{const s=p.filter(t=>{const x=t.purchaseDate.split("T")[0];return x>=V&&x<=_});return{count:s.length,total:s.reduce((t,x)=>t+x.total,0)}},[p,V,_]),Ls=()=>e.jsxs("div",{className:"w-full space-y-6",children:[e.jsxs("div",{className:"bg-surface rounded-lg border border-border p-4 space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[r?.canCreatePurchase&&e.jsxs("button",{onClick:()=>Y(!0),className:"px-4 py-2 bg-gray-800 text-white rounded-md font-semibold flex items-center gap-2 text-sm hover:bg-gray-700 h-10",children:[e.jsx(fe,{className:"h-5 w-5"})," Nova compra"]}),e.jsxs(Nt,{to:"/company?tab=parametros",className:"px-3 py-2 bg-gray-200 text-secondary rounded-md hover:bg-gray-300 text-sm font-medium flex items-center gap-2",children:[e.jsx(Xs,{className:"h-5 w-5"})," Parâmetros"]}),r?.canEditProduct&&e.jsxs("button",{onClick:()=>re(!0),className:"px-3 py-2 bg-gray-200 text-secondary rounded-md hover:bg-gray-300 text-sm font-medium flex items-center gap-2",children:[e.jsx(Zs,{className:"h-5 w-5"})," Atualização de preço em massa"]}),e.jsxs("button",{className:"px-3 py-2 bg-gray-200 text-secondary rounded-md hover:bg-gray-300 text-sm font-medium flex items-center gap-2",children:[e.jsx(et,{className:"h-5 w-5"})," Etiquetas"]}),e.jsx("div",{className:"flex-grow"}),e.jsxs("p",{className:"text-sm font-semibold text-secondary whitespace-nowrap",children:["Total de registros: ",me.length]})]}),e.jsxs("div",{className:"flex flex-wrap items-end gap-4 justify-between",children:[e.jsxs("div",{className:"flex flex-wrap items-end gap-4 flex-grow",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-muted mb-1",children:"Status"}),e.jsxs("select",{value:E.stock,onChange:s=>ue("stock",s.target.value),className:"h-10 p-2 border rounded-md text-sm bg-transparent border-border",children:[e.jsx("option",{children:"Todos"}),e.jsx("option",{children:"Em estoque"}),e.jsx("option",{children:"Sem estoque"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-muted mb-1",children:"Condição"}),e.jsxs("select",{value:E.condition,onChange:s=>ue("condition",s.target.value),className:"h-10 p-2 border rounded-md text-sm bg-transparent border-border",children:[e.jsx("option",{value:"Todos",children:"Todos"}),e.jsx("option",{children:"Novo"}),e.jsx("option",{children:"Seminovo"}),e.jsx("option",{children:"CPO"}),e.jsx("option",{children:"Openbox"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-muted mb-1",children:"Local"}),e.jsxs("select",{value:E.location,onChange:s=>ue("location",s.target.value),className:"h-10 p-2 border rounded-md text-sm bg-transparent border-border",children:[e.jsx("option",{value:"Todos",children:"Todos"}),e.jsx("option",{children:"Loja"}),e.jsx("option",{children:"Caruaru"})]})]}),e.jsxs("div",{className:"relative flex-grow min-w-[250px]",children:[e.jsx("label",{className:"block text-xs font-medium text-muted mb-1",children:"Buscar produto"}),e.jsx("input",{type:"text",placeholder:"Digite aqui para buscar",value:O,onChange:s=>Se(s.target.value),className:"p-2 border rounded-md w-full bg-transparent border-border pr-8 h-10"}),O&&e.jsx("button",{onClick:()=>Se(""),className:"absolute right-2 bottom-2 text-muted hover:text-primary","aria-label":"Limpar busca",children:e.jsx(ye,{className:"h-5 w-5"})})]})]}),e.jsx("div",{className:"flex flex-wrap items-end gap-4",children:e.jsxs("button",{onClick:()=>os(s=>s==="newest"?"oldest":"newest"),className:"h-10 px-3 py-2 bg-gray-200 text-secondary rounded-md hover:bg-gray-300 flex items-center gap-2 text-sm font-medium",children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx("span",{children:ce==="newest"?"Mais Recentes":"Mais Antigos"})]})})]})]}),e.jsx("div",{className:"bg-surface rounded-lg border border-border",children:h?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(H,{})}):me.length===0?e.jsx("p",{className:"text-center text-muted p-6",children:"Nenhum produto encontrado."}):e.jsx("div",{className:"overflow-x-auto custom-scrollbar",children:e.jsxs("table",{className:"w-full text-sm text-left text-muted whitespace-nowrap",children:[e.jsx("thead",{className:"text-xs text-secondary uppercase bg-surface-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-1 py-2 text-center",children:"Qtd."}),e.jsx("th",{scope:"col",className:"px-1 py-2",children:"Descrição"}),e.jsx("th",{scope:"col",className:"px-1 py-2",children:"Local"}),e.jsx("th",{scope:"col",className:"px-1 py-2",children:"Fornec."}),e.jsx("th",{scope:"col",className:"px-1 py-2",children:"Venda"}),e.jsx("th",{scope:"col",className:"px-1 py-2",children:"ATC"}),e.jsx("th",{scope:"col",className:"px-1 py-2",children:"Custo"}),e.jsx("th",{scope:"col",className:"px-1 py-2",children:"Markup"}),e.jsx("th",{scope:"col",className:"px-1 py-2 text-center",children:"Garantia"}),e.jsx("th",{scope:"col",className:"px-1 py-2 text-center",children:"Cond."}),e.jsx("th",{scope:"col",className:"px-1 py-2 text-center",children:"Cadastro"}),e.jsx("th",{scope:"col",className:"px-1 py-2 text-center",children:"Ações"})]})}),e.jsx("tbody",{children:me.map(s=>{const t=s.costPrice&&s.costPrice>0?(s.price-s.costPrice)/s.costPrice*100:0,x=b.find(y=>y.id===s.supplierId),l=Ot(x);let f="bg-gray-100 text-gray-700 border-gray-200";return s.stock===0?f="bg-red-100 text-red-700 border-red-200":s.stock>=1&&(f="bg-green-100 text-green-700 border-green-200"),e.jsxs("tr",{className:"bg-surface border-b border-border last:border-0 hover:bg-surface-secondary",children:[e.jsx("td",{className:"px-2 py-2 text-center",children:e.jsx("span",{className:`px-2 py-0.5 text-sm font-bold rounded-md border ${f}`,children:s.stock})}),e.jsxs("td",{className:"px-2 py-2 font-medium text-primary whitespace-normal max-w-[200px]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-sm truncate",title:s.model,children:s.model}),s.variations&&s.variations.length>0&&e.jsx("div",{className:"flex gap-1 ml-1.5 flex-wrap",children:s.variations.slice(0,2).map((y,A)=>e.jsx("span",{className:"px-1 py-0.5 text-[9px] font-bold uppercase rounded bg-gray-100 text-gray-500 border border-gray-200",children:y.valueName},A))}),s.origin==="Troca"&&e.jsx("span",{className:"flex-shrink-0 px-1.5 py-0.5 text-[9px] font-semibold rounded-full bg-pink-100 text-pink-700 border border-pink-200",children:"Troca"})]}),e.jsxs("div",{className:"text-[10px] text-muted mt-0.5 leading-tight",children:[e.jsxs("span",{children:["SKU: ",s.sku]}),e.jsx("span",{className:"mx-1",children:"·"}),e.jsxs("span",{children:["IMEI: ",s.imei1]}),s.serialNumber&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-1",children:"·"}),e.jsxs("span",{children:["S/N: ",s.serialNumber]})]}),s.condition==="Seminovo"&&s.brand==="Apple"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-1",children:"·"}),e.jsxs("span",{className:"text-blue-600 font-bold",children:["Saúde: ",s.batteryHealth,"%"]})]})]})]}),e.jsx("td",{className:"px-1 py-2 text-xs text-muted",children:s.storageLocation||"-"}),e.jsx("td",{className:"px-1 py-2",children:s.origin==="Troca"?e.jsx("span",{className:"px-1.5 py-0.5 text-[9px] font-medium rounded-full bg-purple-100 text-purple-700 border border-purple-200",children:"Cliente"}):x?e.jsx("span",{className:`px-1.5 py-0.5 text-[9px] font-medium rounded-full ${l}`,children:x.name}):s.supplier?e.jsx("span",{className:"px-1.5 py-0.5 text-[9px] font-medium rounded-full bg-gray-100 text-gray-700 border border-gray-200",children:s.supplier}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{className:"px-1 py-2 font-bold text-primary text-sm",children:v(s.price)}),e.jsx("td",{className:"px-1 py-2 text-xs font-bold text-orange-500",children:v(s.wholesalePrice||0)}),e.jsx("td",{className:"px-1 py-2 text-xs text-muted",children:v(s.costPrice,"N/A")}),e.jsxs("td",{className:`px-1 py-2 text-sm font-bold ${t>=0?"text-success":"text-danger"}`,children:[t.toFixed(0),"%"]}),e.jsx("td",{className:"px-2 py-2 text-center text-xs",children:s.warranty||s.warranty_period||s.garantia||"-"}),e.jsx("td",{className:"px-2 py-2 text-center",children:e.jsx("span",{className:`px-2 py-0.5 text-[10px] font-bold rounded-full ${Ns(s.condition)}`,children:s.condition})}),e.jsx("td",{className:"px-2 py-2",children:e.jsxs("div",{className:"flex flex-col text-[10px] text-gray-700 leading-tight items-center font-medium",children:[e.jsx("span",{children:new Date(s.createdAt).toLocaleDateString("pt-BR")}),e.jsx("span",{children:new Date(s.createdAt).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}),e.jsx("span",{className:"font-bold text-gray-900 truncate max-w-[80px] mt-0.5",title:$e[s.createdBy]?.name||s.createdByName||(s.createdBy==="Admin User"?"Keiler":s.createdBy),children:s.createdBy==="Admin User"?"Keiler":$e[s.createdBy]?.name||s.createdByName||s.createdBy||"-"})]})}),e.jsx("td",{className:"px-2 py-2",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Mt,{permissions:r,onHistory:()=>bs(s),onUpdateStock:()=>fs(s),onEdit:()=>us(s),onDelete:()=>ps(s)})})})]},s.id)})})]})})})]}),As=()=>{const s=t=>`px-3 py-1 rounded-md text-sm font-medium transition-colors ${is===t?"bg-primary text-white":"hover:bg-gray-200"}`;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-surface p-4 rounded-lg border border-border space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:r?.canCreatePurchase&&e.jsxs("button",{onClick:()=>Y(!0),className:"px-4 py-2 bg-gray-800 text-white rounded-md font-semibold flex items-center gap-2 text-sm hover:bg-gray-700 h-10",children:[e.jsx(fe,{className:"h-5 w-5"})," Nova compra"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:V,onChange:t=>Z(t.target.value),className:"p-2 border rounded-md bg-surface border-border text-sm h-10"}),e.jsx("span",{className:"text-muted",children:"à"}),e.jsx("input",{type:"date",value:_,onChange:t=>ee(t.target.value),className:"p-2 border rounded-md bg-surface border-border text-sm h-10"}),e.jsxs("div",{className:"flex items-center gap-1 bg-gray-100 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>he("hoje"),className:s("hoje"),children:"Hoje"}),e.jsx("button",{onClick:()=>he("semana"),className:s("semana"),children:"Semana"}),e.jsx("button",{onClick:()=>he("mes"),className:s("mes"),children:"Mês"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-start gap-8 pt-4 border-t border-border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted",children:"Qtd de compras do mês"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(st,{className:"h-5 w-5 text-muted"}),e.jsx("p",{className:"text-xl font-bold text-primary",children:Re.count})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted",children:"Total de compras do mês"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(tt,{className:"h-5 w-5 text-muted"}),e.jsx("p",{className:"text-xl font-bold text-primary",children:v(Re.total)})]})]})]})]}),e.jsxs("div",{className:"bg-surface rounded-lg border border-border",children:[e.jsxs("div",{className:"p-3 flex items-center gap-4",children:[e.jsxs("select",{value:$,onChange:t=>ds(t.target.value),className:"p-2 border rounded-md bg-surface border-border text-sm h-10",children:[e.jsx("option",{value:"Todos",children:"Filtrar por Status"}),e.jsx("option",{value:"Pendente",children:"Pendente"}),e.jsx("option",{value:"Lançado",children:"Lançado"}),e.jsx("option",{value:"Cancelada",children:"Cancelada"}),e.jsx("option",{value:"Pago",children:"Pago"})]}),e.jsxs("div",{className:"relative flex-grow",children:[e.jsx("input",{type:"text",placeholder:"Digite para buscar...",value:X,onChange:t=>Oe(t.target.value),className:"w-full p-2 pl-3 border rounded-md bg-surface border-border text-sm pr-8 h-10"}),X&&e.jsx("button",{onClick:()=>Oe(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted hover:text-primary",children:e.jsx(ye,{className:"h-5 w-5"})})]}),e.jsxs("button",{onClick:()=>ls(t=>t==="newest"?"oldest":"newest"),className:"h-10 px-3 py-2 bg-gray-200 text-secondary rounded-md hover:bg-gray-300 flex items-center gap-2 text-sm font-medium flex-shrink-0",children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx("span",{children:xe==="newest"?"Recente":"Mais Antigo"})]})]}),e.jsx("div",{className:"overflow-x-auto custom-scrollbar",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-secondary uppercase bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-medium",children:"ID"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Data da compra"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Fornecedor"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Localizador no estoque"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Total da compra"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Estoque"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Financeiro"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Ações"})]})}),e.jsx("tbody",{className:"text-primary",children:Fe.map(t=>{const l=c.filter(y=>y.purchaseOrderId===t.id).map(y=>y.id).some(y=>qe.has(y)),f="Não é possível alterar pois contém produtos já vendidos.";return e.jsxs("tr",{className:"border-t border-border hover:bg-surface-secondary",children:[e.jsxs("td",{className:"px-4 py-3 font-semibold",children:["#",t.displayId]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-medium text-primary",children:new Date(t.purchaseDate).toLocaleString("pt-BR",{dateStyle:"short",timeStyle:"short"})}),e.jsxs("div",{className:"text-xs text-muted",children:["por ",t.createdBy]})]}),e.jsx("td",{className:"px-4 py-3",children:t.supplierName}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{onClick:()=>ws(t.locatorId),className:"text-blue-500 hover:text-blue-700 hover:underline font-mono",title:"Copiar Localizador",children:t.locatorId})}),e.jsx("td",{className:"px-4 py-3 font-semibold",children:v(t.total)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(Ve,{text:t.stockStatus,type:Es(t.stockStatus)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(Ve,{text:t.financialStatus,type:Is(t.financialStatus)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("button",{onClick:()=>Ae(t),title:"Visualizar",children:e.jsx(at,{className:"h-5 w-5 text-blue-500 hover:text-blue-700"})}),r?.canLaunchPurchase&&t.stockStatus==="Lançado"?e.jsx("button",{onClick:()=>ie(t),title:l?f:"Reverter Compra",disabled:l,children:e.jsx(rt,{className:`h-5 w-5 ${l?"text-gray-300":"text-yellow-500 hover:text-yellow-700"}`})}):r?.canEditPurchase&&e.jsx("button",{onClick:()=>vs(t),title:l?f:"Editar",disabled:l,children:e.jsx(We,{className:`h-5 w-5 ${l?"text-gray-300":"text-orange-400 hover:text-orange-600"}`})}),r?.canEditPurchase&&e.jsx("button",{onClick:()=>de(t),title:"Alterar Status Financeiro",children:e.jsx(ot,{className:`h-5 w-5 ${t.financialStatus==="Pago"?"text-green-600":"text-gray-400 hover:text-green-600"}`})}),r?.canLaunchPurchase&&e.jsx("button",{onClick:()=>Le(t),title:"Lançar no Estoque",disabled:t.stockStatus==="Lançado",children:t.stockStatus==="Parcialmente Lançado"?e.jsx("div",{className:"bg-indigo-500 text-white rounded-full p-0.5",children:e.jsx(Be,{className:"h-5 w-5"})}):e.jsx(Be,{className:`h-5 w-5 ${t.stockStatus==="Lançado"?"text-gray-300":"text-indigo-500 hover:text-indigo-700"}`})}),r?.canDeletePurchase&&e.jsx("button",{onClick:()=>le(t),title:l?f:"Excluir",disabled:l,children:e.jsx(Qe,{className:`h-5 w-5 ${l?"text-gray-300":"text-red-500 hover:text-red-700"}`})})]})})]},t.id)})})]})}),e.jsxs("div",{className:"p-4 flex justify-between items-center text-sm",children:[e.jsxs("p",{className:"font-semibold text-secondary",children:["Total de Registros: ",Fe.length]}),e.jsxs("div",{className:"flex items-center gap-2 text-secondary",children:[e.jsx("button",{className:"p-1 rounded-md hover:bg-gray-200 disabled:opacity-50",disabled:!0,children:e.jsx(nt,{className:"h-5 w-5"})}),e.jsx("span",{children:"1 de 1"}),e.jsx("button",{className:"p-1 rounded-md hover:bg-gray-200 disabled:opacity-50",disabled:!0,children:e.jsx(ct,{className:"h-5 w-5"})})]})]})]})]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-primary",children:"Estoque e Compras"}),e.jsx("div",{className:"inline-flex items-center gap-1 bg-surface-secondary p-1 rounded-lg",children:U.map(s=>e.jsx("button",{onClick:()=>u(s.id),className:`px-3 py-1.5 rounded-md text-sm font-medium whitespace-nowrap transition-colors ${n===s.id?"bg-primary text-white shadow-sm":"text-muted hover:text-primary"}`,children:s.label},s.id))}),h?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(H,{})}):e.jsxs(e.Fragment,{children:[n==="estoque"&&Ls(),n==="compras"&&As(),U.length===0&&e.jsx("p",{className:"text-center text-muted p-6",children:"Você não tem permissão para acessar esta seção."})]}),R&&e.jsx(vt,{purchase:R,onClose:()=>Ae(null),associatedProducts:Ds}),Pe&&J&&e.jsx(be,{isOpen:Pe,onClose:()=>ae(!1),onConfirm:gs,title:"Confirmar Exclusão",message:`Tem certeza que deseja excluir o produto "${J.model}"? Esta ação não pode ser desfeita.`}),Ye&&De&&e.jsx(Dt,{product:De,salesHistory:ts,customers:j,users:S,productMap:ms,onClose:()=>ke(!1)}),Xe&&e.jsx(Et,{allProducts:c,onClose:()=>re(!1),onBulkUpdate:js}),Ze&&Ee&&e.jsx(Ct,{product:Ee,onClose:()=>{oe(!1),ne(null)},onSave:ys}),e.jsxs(a.Suspense,{fallback:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx(H,{})}),children:[e.jsx(It,{isOpen:Je,product:Q,suppliers:b,brands:L,categories:G,productModels:M,grades:g,gradeValues:P,onClose:Ue,onSave:hs,customers:j,onAddNewSupplier:He}),ns&&e.jsx(Lt,{suppliers:b,customers:j,onClose:Ss,purchaseOrderToEdit:cs,brands:L,categories:G,productModels:M,grades:g,gradeValues:P,onAddNewSupplier:He}),Ie&&e.jsx(At,{purchaseOrder:Ie,onClose:Cs,allProducts:c,grades:g,gradeValues:P})]}),z&&e.jsx(St,{isOpen:!!z,onClose:()=>le(null),onConfirm:Ps,title:`Excluir Compra #${z.displayId}`,message:"Esta ação irá remover permanentemente a compra. Esta ação não pode ser desfeita."}),q&&e.jsx(be,{isOpen:!!q,onClose:()=>de(null),onConfirm:ks,title:"Alterar Status Financeiro",message:`Deseja marcar a compra #${q.displayId} como "${q.financialStatus==="Pendente"?"Paga":"Pendente"}"?`,variant:"success"}),B&&e.jsx(be,{isOpen:!!B,onClose:()=>ie(null),onConfirm:Ts,title:`Reverter Lançamento da Compra #${B.displayId}`,message:"Esta ação irá remover do estoque todos os produtos associados a esta compra e retornará o status para 'Pendente'. Deseja continuar?",variant:"danger"})]})};export{Vt as default};
