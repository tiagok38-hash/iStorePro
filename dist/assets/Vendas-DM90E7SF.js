const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/NewSaleModal-DvBy1O8A.js","assets/index-BMA--0RW.js","assets/react-vendor-Bv8thS0I.js","assets/supabase-C1Qlw3jS.js","assets/NewSaleView-B-0FMbxA.js","assets/SearchableDropdown-Cwt49rKC.js","assets/CurrencyInput-DaWIS5Fg.js","assets/CustomerModal-Cs-UW485.js","assets/Button-wK47DqCu.js","assets/ProductModal-D-J2CwZs.js"])))=>i.map(i=>d[i]);
import{c as $e,j as e,aG as ms,a1 as xs,f as v,u as ps,i as hs,b as gs,g as fs,a as bs,k as js,ap as ys,n as Ns,o as vs,p as Cs,q as ws,r as Ss,m as Ps,ao as Is,a8 as Ds,Q as Ts,aq as Vs,h as ks,S as Oe,X as _e,G as Es,H as Ms,Z as Rs,t as Ls,Y as Fs,E as As,z as Os,af as zs,_ as $s}from"./index-BMA--0RW.js";import{r as t,d as Be}from"./react-vendor-Bv8thS0I.js";import{C as _s}from"./CurrencyInput-DaWIS5Fg.js";import{S as Bs,a as qs}from"./SaleDetailModal-DuxgAQqk.js";import{D as Gs}from"./DeleteWithReasonModal-BnPkPZth.js";import"./supabase-C1Qlw3jS.js";const Hs=({onClose:g})=>{const[o,T]=t.useState([]),[j,k]=t.useState(""),[p,f]=t.useState("credit"),[S,P]=t.useState(0),[C,z]=t.useState("withInterest"),[y,E]=t.useState(1);t.useEffect(()=>{$e().then(r=>{const h=r.filter(c=>c.type==="card"&&c.active!==!1);T(h),h.length>0&&!j&&k(h[0].id)})},[]);const x=t.useMemo(()=>o.find(r=>r.id===j),[o,j])?.config,l=t.useMemo(()=>{if(!x||S<=0)return null;const r=S;let h=null;if(p==="debit"){const c=x.debitRate,d=r*(c/100);h={type:"debit",totalToPay:r+d,feeValue:d,feePercent:c,originalValue:r,installments:1,installmentValue:r+d}}else if(C==="noInterest"){const d=x.creditNoInterestRates.find(M=>M.installments===y)?.rate||0,D=r*(d/100);h={type:"creditNoInterest",totalToPay:r,feeValue:D,feePercent:d,originalValue:r,installments:y,installmentValue:r/y}}else{const d=x.creditWithInterestRates.find(M=>M.installments===y)?.rate||0,D=r*(1+d/100);h={type:"creditWithInterest",totalToPay:D,feeValue:D-r,feePercent:d,originalValue:r,installments:y,installmentValue:D/y}}return h},[x,p,C,S,y]);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-[70] p-4 font-sans text-gray-800",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center p-5 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ms,{className:"h-6 w-6 text-gray-700"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Simulador de Taxas"})]}),e.jsx("button",{onClick:g,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(xs,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto space-y-6 flex-1",children:[e.jsx("div",{className:"bg-gray-100 p-3 rounded text-sm text-gray-600 mb-4",children:"Simule o parcelamento e veja as taxas aplicadas."}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-800 mb-2",children:"1. Selecione o tipo de Transação:"}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"simTransactionType",className:"w-5 h-5 text-green-500 focus:ring-green-500 border-gray-300",checked:p==="credit",onChange:()=>f("credit")}),e.jsx("span",{children:"Crédito"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"simTransactionType",className:"w-5 h-5 text-green-500 focus:ring-green-500 border-gray-300",checked:p==="debit",onChange:()=>f("debit")}),e.jsx("span",{children:"Débito"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-800 mb-2",children:"2. Selecione a máquina/cartão:"}),e.jsxs("select",{value:j,onChange:r=>k(r.target.value),className:"w-full p-2 border border-gray-300 rounded-md bg-white focus:ring-2 focus:ring-green-500/20 outline-none",children:[o.length===0&&e.jsx("option",{value:"",children:"Nenhuma configuração encontrada"}),o.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-800 mb-2",children:"3. Insira o valor (R$)"}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsx(_s,{value:S,onChange:P,className:"w-48 p-2 border border-gray-300 rounded-md bg-white font-medium focus:ring-2 focus:ring-green-500/20 outline-none"}),l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-4 py-2 bg-gray-200 rounded text-sm font-medium text-gray-700",children:["Cobrar do Cliente = ",v(l.totalToPay)]}),e.jsxs("div",{className:"px-4 py-2 bg-gray-200 rounded text-sm font-medium text-gray-700",children:["Líquido (Você recebe) = ",v(p==="debit"||C==="withInterest"?l.totalToPay-l.feeValue:l.originalValue-l.feeValue)]})]})]})]}),p==="credit"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-800 mb-2",children:"4. Selecione o Tipo de Taxa:"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"simFeeType",className:"w-5 h-5 text-green-500 focus:ring-green-500 border-gray-300",checked:C==="noInterest",onChange:()=>z("noInterest")}),e.jsx("span",{children:"Sem Juros (Vendedor paga)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"simFeeType",className:"w-5 h-5 text-green-500 focus:ring-green-500 border-gray-300",checked:C==="withInterest",onChange:()=>z("withInterest")}),e.jsx("span",{children:"Com Juros (Cliente paga)"})]})]}),l&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"px-4 py-1.5 bg-gray-100 border border-gray-200 rounded text-xs text-gray-600",children:["Taxa: ",v(l.feeValue)," (",l.feePercent.toFixed(2),"%)"]})})]})]}),p==="credit"&&x&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-800 mb-2",children:"5. Resultados da Simulação:"}),e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 max-h-60 overflow-y-auto bg-gray-50/50",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-x-8 gap-y-2",children:(()=>{const r=C==="noInterest"?x.creditNoInterestRates:x.creditWithInterestRates;let h=1;for(let c=r.length-1;c>=0;c--)if(r[c].rate>0){h=r[c].installments;break}return r.filter(c=>c.installments===1||c.installments<=h).map(c=>{const d=c.installments,D=S,M=C==="withInterest"?D*(1+c.rate/100):D,ne=M/d;return e.jsxs("label",{className:`flex items-center gap-2 p-2 rounded cursor-pointer transition-colors ${y===d?"bg-blue-50":"hover:bg-gray-100"}`,children:[e.jsx("input",{type:"radio",name:"simInstallment",checked:y===d,onChange:()=>E(d),className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),e.jsxs("span",{className:"text-sm text-gray-700",children:[d,"x de ",v(ne)," ",C==="withInterest"&&d>1?`(Total: ${v(M)})`:""]})]},d)})})()})})]})]}),e.jsx("div",{className:"p-4 border-t border-gray-100 flex justify-center bg-gray-50",children:e.jsx("button",{onClick:g,className:"px-10 py-2.5 bg-primary text-on-primary rounded-md hover:bg-opacity-90 font-semibold",children:"Fechar Simulação"})})]})})},Ws=t.lazy(()=>$s(()=>import("./NewSaleModal-DvBy1O8A.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),U=g=>{const o=g.getFullYear(),T=(g.getMonth()+1).toString().padStart(2,"0"),j=g.getDate().toString().padStart(2,"0");return`${o}-${T}-${j}`},ze=g=>{const o=new Date;switch(g){case"hoje":return U(o);case"7dias":return o.setDate(o.getDate()-6),U(o);case"15dias":return o.setDate(o.getDate()-14),U(o);case"30dias":default:return o.setDate(o.getDate()-29),U(o)}},re=Be.memo(({title:g,value:o,bgColor:T,textColor:j="text-primary"})=>e.jsxs("div",{className:`p-4 rounded-lg ${T} ${j}`,children:[e.jsx("h3",{className:"text-sm font-medium opacity-80",children:g}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:o})]})),Us=Be.memo(({onEdit:g,onView:o,onReprint:T,onCancel:j,permissions:k})=>{const[p,f]=t.useState(!1),S=t.useRef(null),P=t.useRef(null),[C,z]=t.useState({}),y=x=>{if(x.stopPropagation(),p)f(!1);else{if(!P.current)return;const l=P.current.getBoundingClientRect(),r=window.innerHeight-l.bottom,h=160,c={position:"fixed",width:"12rem",zIndex:50};c.right=window.innerWidth-l.right,r<h&&l.top>h?c.bottom=window.innerHeight-l.top:c.top=l.bottom,z(c),f(!0)}};t.useEffect(()=>{const x=r=>{p&&S.current&&!S.current.contains(r.target)&&P.current&&!P.current.contains(r.target)&&f(!1)},l=()=>{p&&f(!1)};return document.addEventListener("mousedown",x),window.addEventListener("scroll",l,!0),window.addEventListener("resize",l),()=>{document.removeEventListener("mousedown",x),window.removeEventListener("scroll",l,!0),window.removeEventListener("resize",l)}},[p]);const E=x=>l=>{l.stopPropagation(),x(),f(!1)},L="w-full text-left flex items-center gap-3 px-4 py-2 text-sm";return e.jsxs("div",{className:"relative",children:[e.jsx("button",{ref:P,onClick:y,className:"p-1 rounded-full hover:bg-surface-secondary text-muted",children:e.jsx(Fs,{className:"h-5 w-5"})}),p&&e.jsx("div",{ref:S,style:C,className:"rounded-md shadow-lg bg-surface ring-1 ring-black ring-opacity-5",children:e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{onClick:E(o),className:`${L} text-secondary hover:bg-surface-secondary`,children:[e.jsx(As,{className:"h-4 w-4"})," Visualizar"]}),e.jsxs("button",{onClick:E(g),className:`${L} text-secondary hover:bg-surface-secondary`,children:[e.jsx(Os,{className:"h-4 w-4"})," Editar"]}),e.jsxs("button",{onClick:E(T),className:`${L} text-secondary hover:bg-surface-secondary`,children:[e.jsx(zs,{className:"h-4 w-4"})," Reimprimir"]}),k?.canCancelSale&&e.jsxs("button",{onClick:E(j),className:`${L} text-danger hover:bg-danger-light`,children:[e.jsx(_e,{className:"h-4 w-4"})," Cancelar"]})]})})]})}),st=()=>{const[g,o]=t.useState([]),[T,j]=t.useState([]),[k,p]=t.useState([]),[f,S]=t.useState([]),[P,C]=t.useState([]),[z,y]=t.useState([]),[E,L]=t.useState([]),[x,l]=t.useState([]),[r,h]=t.useState([]),[c,d]=t.useState([]),[D,M]=t.useState([]),[ne,qe]=t.useState([]),[Ge,He]=t.useState([]),[oe,pe]=t.useState(!0),[he,ge]=t.useState(null),[We,K]=t.useState(!1),[Ue,fe]=t.useState(!1),[be,je]=t.useState(null),[Je,ce]=t.useState(null),[$,le]=t.useState(null),[Q,ie]=t.useState(null),[Xe,Z]=t.useState(!1),[ye,de]=t.useState(null),[ee,Ne]=t.useState(ze("30dias")),[se,ve]=t.useState(U(new Date)),[Ye,Ce]=t.useState("30dias"),[J,we]=t.useState("todos"),[V,Se]=t.useState("todos"),[X,Pe]=t.useState(""),[_,Ie]=t.useState({}),[ue,Ke]=t.useState({}),[Qe,Ze]=t.useState({}),{showToast:N}=ps(),{permissions:De,user:Te}=hs(),[F,Ve]=t.useState(1),me=10,[es,xe]=t.useState(!1);t.useEffect(()=>{let s;return oe?(xe(!1),s=setTimeout(()=>xe(!0),5e3)):xe(!1),()=>clearTimeout(s)},[oe]);const A=t.useCallback(async()=>{console.log("Vendas: Iniciando carregamento de dados..."),pe(!0),ge(null);const s=new Promise((a,n)=>setTimeout(()=>n(new Error("Tempo limite excedido. Tente novamente.")),1e4));try{const a=Promise.all([gs(),fs(),bs(),js(),ys(),Ns(),vs(),Cs(),ws(),Ss(),Ps(),Is(),$e()]),[n,u,w,i,m,O,I,G,H,W,Y,ls,is]=await Promise.race([a,s]);console.log(`Vendas: Dados carregados. ${n.length} vendas encontradas.`);const ds=[...n].sort((b,Ae)=>{const us=b.date?new Date(b.date).getTime():0;return(Ae.date?new Date(Ae.date).getTime():0)-us});o(ds),j(u),p(w),S(i),C(m),y(O),L(I),l(G),h(H||[]),d(W),M(Y),qe(ls),He((is||[]).filter(b=>b.name&&!b.name.toLowerCase().includes("pagseguro")));const Re={};u.forEach(b=>{Re[b.id]=b}),Ie(Re);const Le={};w.forEach(b=>{Le[b.id]=b}),Ke(Le);const Fe={};i.forEach(b=>{Fe[b.id]=b}),Ze(Fe),console.log("Vendas: Mapas de dados gerados com sucesso.")}catch(a){console.error("Vendas: Erro ao carregar dados:",a);const n=a.message||"Erro ao carregar dados de vendas.";ge(n),N(n,"error")}finally{console.log("Vendas: Finalizando estado de loading."),pe(!1)}},[N]);t.useEffect(()=>{A();const s=new BroadcastChannel("app_cache_sync");return s.onmessage=a=>{a.data&&a.data.type==="CLEAR_CACHE"&&a.data.keys.includes("sales")&&A()},()=>{s.close()}},[A]),t.useEffect(()=>{const s=()=>{document.visibilityState==="visible"&&(console.log("Vendas: Aba visível novamente. Recarregando dados..."),A())};return document.addEventListener("visibilitychange",s),()=>{document.removeEventListener("visibilitychange",s)}},[A]);const B=t.useCallback(s=>{Ce(s),Ne(ze(s)),ve(U(new Date))},[]),ss=t.useCallback(()=>{B("30dias"),we("todos"),Se("todos"),Pe("")},[B]),ke=t.useCallback(s=>a=>{s(a.target.value),Ce("personalizado")},[]),R=t.useMemo(()=>g.filter(s=>{const a=new Date(s.date),n=new Date(ee+"T00:00:00"),u=new Date(se+"T23:59:59.999"),w=a>=n&&a<=u,i=J==="todos"||s.salespersonId===J;let m=!0;V==="Promissoria"?m=s.payments.some(Y=>Y.type==="pending"):V==="PDV"?m=s.origin==="PDV"&&(!!s.cashSessionDisplayId||!!s.cashSessionId):V!=="todos"&&(m=s.status===V);const O=ue[s.customerId]?.name||"",I=X.toLowerCase().trim().replace(/^#/,""),G=s.id.toLowerCase(),H=I!==""&&(G.includes(I)||G===`id-${I}`||s.id===I),W=X===""||O.toLowerCase().includes(I)||H;return V==="Promissoria"&&(m=m&&s.status!=="Cancelada"),w&&i&&m&&W}),[g,ee,se,J,V,X,ue]);t.useEffect(()=>{Ve(1)},[ee,se,J,V,X]);const te=Math.ceil(R.length/me),Ee=R.slice((F-1)*me,F*me),Me=s=>{s>0&&s<=te&&Ve(s)},ts=t.useMemo(()=>{const s=new Set(P.filter(a=>a.permissions.canCreateSale).map(a=>a.id));return f.filter(a=>s.has(a.permissionProfileId))},[f,P]),q=t.useMemo(()=>{const s=R.filter(i=>i.status!=="Cancelada"),a=s.reduce((i,m)=>i+m.total,0),n=s.length>0?a/s.length:0,u=R.reduce((i,m)=>{if(m.status==="Cancelada")return i;const O=(m.items||[]).reduce((G,H)=>{const W=_[H.productId],Y=(W?.costPrice||0)+(W?.additionalCostPrice||0);return G+Y*H.quantity},0),I=m.subtotal-m.discount;return i+(I-O)},0),w=R.reduce((i,m)=>m.status==="Cancelada"?i:i+(m.payments||[]).reduce((O,I)=>O+(I.fees||0),0),0);return{faturamento:a,lucro:u,taxas:w,ticketMedio:n}},[R,_]),as=t.useCallback(async s=>{try{const a=await Ds(s);return p(n=>[...n,a]),N("Cliente adicionado com sucesso!","success"),a}catch{return N("Erro ao salvar novo cliente.","error"),null}},[N]),rs=t.useCallback(async s=>{try{const a=await Ts(s);return j(n=>[...n,a]),Ie(n=>({...n,[a.id]:a})),a}catch(a){return N(a.message||"Erro ao adicionar novo produto de troca.","error"),null}},[N]),ns=t.useCallback(async s=>{if($)try{const a=await Vs($.id,s,Te?.id,Te?.name);N("Venda cancelada com sucesso!","success"),o(n=>n.map(u=>u.id===a.id?a:u))}catch{N("Erro ao cancelar a venda.","error")}finally{le(null)}},[$,N]),os=t.useCallback(async s=>{K(!1),N("Venda salva com sucesso!","success"),o(a=>{const n=a.findIndex(u=>u.id===s.id);if(n>-1){const u=[...a];return u[n]=s,u}return[s,...a]}),ce(null)},[N]),cs=s=>{switch(s){case"Finalizada":return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-700",children:"Finalizada"});case"Pendente":return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-orange-100 text-orange-700",children:"Pendente"});case"Cancelada":return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-700",children:"Cancelada"});case"Editada":return e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-purple-100 text-purple-700",children:"Editada"}),e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-700",children:"Finalizada"})]});default:return null}},ae=s=>`px-3 py-1 rounded-md text-sm font-medium transition-colors ${Ye===s?"bg-primary text-white":"bg-surface-secondary hover:bg-border"}`;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-primary",children:"Vendas"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(re,{title:"Faturamento",value:v(q.faturamento),bgColor:"bg-blue-100"}),e.jsx(re,{title:"Ticket Médio",value:v(q.ticketMedio),bgColor:"bg-purple-100"}),e.jsx(re,{title:"Taxas",value:v(q.taxas),bgColor:"bg-red-100"}),e.jsx(re,{title:"Lucro",value:v(q.lucro),bgColor:q.lucro>=0?"bg-green-100":"bg-red-100",textColor:q.lucro>=0?"text-green-700":"text-red-700"})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{type:"date",value:ee,onChange:ke(Ne),className:"p-2 border rounded-md bg-surface border-border h-10"})}),e.jsx("div",{className:"relative",children:e.jsx("input",{type:"date",value:se,onChange:ke(ve),className:"p-2 border rounded-md bg-surface border-border h-10"})}),e.jsxs("div",{className:"flex items-center gap-1 bg-surface-secondary p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>B("hoje"),className:ae("hoje"),children:"Hoje"}),e.jsx("button",{onClick:()=>B("7dias"),className:ae("7dias"),children:"7 dias"}),e.jsx("button",{onClick:()=>B("15dias"),className:ae("15dias"),children:"15 dias"}),e.jsx("button",{onClick:()=>B("30dias"),className:ae("30dias"),children:"30 dias"})]}),e.jsx("button",{onClick:ss,className:"px-4 py-2 text-muted hover:text-primary",children:"Limpar"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[De?.canCreateSale&&e.jsx("button",{onClick:()=>K(!0),className:"px-4 py-2 bg-success text-on-primary rounded-md font-semibold",children:"+ NOVA VENDA"}),e.jsx("button",{onClick:()=>fe(!0),className:"px-4 py-2 bg-secondary text-white rounded-md hover:bg-primary",children:"Simulador de cartão"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{value:J,onChange:s=>we(s.target.value),className:"p-2 border rounded-md bg-surface border-border w-64 h-10 text-sm",children:[e.jsx("option",{value:"todos",children:"Todos os vendedores"}),ts.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("select",{value:V,onChange:s=>Se(s.target.value),className:"p-2 border rounded-md bg-surface border-border h-10 text-sm",children:[e.jsx("option",{value:"todos",children:"Todos os status"}),e.jsx("option",{value:"Finalizada",children:"Finalizada"}),e.jsx("option",{value:"Pendente",children:"Pendente"}),e.jsx("option",{value:"Cancelada",children:"Cancelada"}),e.jsx("option",{value:"Editada",children:"Editada"}),e.jsx("option",{value:"Promissoria",children:"Promissória"}),e.jsx("option",{value:"PDV",children:"PDV"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:e.jsx(ks,{className:"h-5 w-5 text-muted"})}),e.jsx("input",{type:"text",placeholder:"Buscar por cliente ou ID da venda (ex: ID-10 ou 10)",value:X,onChange:s=>Pe(s.target.value),className:"w-[28rem] p-2 pl-10 border rounded-md bg-surface border-border h-10 text-sm"})]})]})]}),e.jsx("div",{className:"bg-surface rounded-lg border border-border",children:oe?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Oe,{}),es&&e.jsxs("div",{className:"mt-6 text-center animate-pulse",children:[e.jsx("p",{className:"text-gray-500 text-sm mb-3",children:"Isso está demorando mais que o normal..."}),e.jsx("button",{onClick:()=>A(),className:"px-4 py-1.5 bg-gray-100 text-primary text-sm font-medium rounded-md hover:bg-gray-200 transition-colors border border-gray-300",children:"Recarregar Agora"})]})]}):he?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(_e,{className:"h-12 w-12 text-red-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Erro ao carregar dados"}),e.jsx("p",{className:"text-gray-500 mb-6 max-w-md",children:he}),e.jsx("button",{onClick:()=>A(),className:"px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors shadow-sm",children:"Tentar Novamente"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"text-left text-xs text-muted bg-surface-secondary uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"ID"}),e.jsx("th",{className:"p-3",children:"Data"}),e.jsx("th",{className:"p-3",children:"Vendedor"}),e.jsx("th",{className:"p-3",children:"Cliente"}),e.jsx("th",{className:"p-3",children:"Status"}),e.jsx("th",{className:"p-3",children:"Origem"}),e.jsx("th",{className:"p-3",children:"Total"}),e.jsx("th",{className:"p-3",children:"Taxas"}),e.jsx("th",{className:"p-3",children:"Lucro"}),e.jsx("th",{className:"p-3 text-center",children:"Ações"})]})}),e.jsx("tbody",{children:Ee.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"px-6 py-12 text-center text-muted italic",children:"Nenhuma venda encontrada para os filtros selecionados."})}):Ee.map(s=>{const a=(s.items||[]).reduce((w,i)=>w+((_[i.productId]?.costPrice||0)+(_[i.productId]?.additionalCostPrice||0))*i.quantity,0),u=s.subtotal-s.discount-a;return e.jsxs("tr",{className:"border-b border-border hover:bg-surface-secondary",children:[e.jsx("td",{className:"p-3 font-medium text-primary",children:s.id}),e.jsxs("td",{className:"p-3 text-muted",children:[e.jsx("div",{children:new Date(s.date).toLocaleDateString("pt-BR")}),e.jsx("div",{className:"text-[11px]",children:new Date(s.date).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("td",{className:"p-3 text-primary",children:Qe[s.salespersonId]?.name||"N/A"}),e.jsx("td",{className:"p-3 text-primary",children:ue[s.customerId]?.name||"N/A"}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex gap-1 flex-wrap",children:[cs(s.status),s.payments.some(w=>w.type==="pending")&&e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-700",children:"Promissória"})]})}),e.jsxs("td",{className:"p-3 text-primary font-bold",children:[s.origin==="Balcão"||s.origin==="PDV"&&!s.cashSessionDisplayId&&!s.cashSessionId?"Vendas":s.origin,s.origin==="PDV"&&s.cashSessionDisplayId&&e.jsxs("span",{className:"text-xs text-gray-600 font-bold block mt-0.5",children:["Caixa #",s.cashSessionDisplayId]})]}),e.jsx("td",{className:"p-3 font-semibold text-primary",children:v(s.total)}),e.jsx("td",{className:"p-3 text-muted",children:v(s.payments.reduce((w,i)=>w+(i.fees||0),0))}),e.jsx("td",{className:`p-3 font-semibold ${u>=0?"text-success":"text-danger"}`,children:v(u)}),e.jsx("td",{className:"p-3",children:e.jsx("div",{className:"flex justify-center",children:e.jsx(Us,{permissions:De,onView:()=>je(s),onEdit:()=>{if(s.origin==="PDV"&&s.cashSessionId){N("Vendas feitas pelo PDV devem ser editadas no próprio PDV.","info");return}ce(s),K(!0)},onReprint:()=>{ie(s),Z(!0)},onCancel:()=>le(s)})})})]},s.id)})})]})}),e.jsxs("div",{className:"p-4 flex justify-between items-center text-sm",children:[e.jsxs("p",{className:"text-muted",children:["Total de Registros: ",R.length]}),te>1&&e.jsxs("div",{className:"flex items-center gap-2 text-secondary",children:[e.jsx("button",{onClick:()=>Me(F-1),disabled:F===1,className:"p-1 rounded-md hover:bg-gray-200 disabled:opacity-50",children:e.jsx(Es,{className:"h-5 w-5"})}),e.jsxs("span",{children:["Página ",F," de ",te]}),e.jsx("button",{onClick:()=>Me(F+1),disabled:F===te,className:"p-1 rounded-md hover:bg-gray-200 disabled:opacity-50",children:e.jsx(Ms,{className:"h-5 w-5"})})]})]})]})}),V==="Promissoria"&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex justify-between items-center",children:[e.jsx("span",{className:"font-bold text-red-800",children:"Total Pago em Promissória (nesta lista):"}),e.jsx("span",{className:"text-xl font-black text-red-700",children:v(R.reduce((s,a)=>s+a.payments.filter(n=>n.type==="pending").reduce((n,u)=>n+u.value,0),0))})]}),e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx(Oe,{})}),children:e.jsx(Ws,{isOpen:We,onClose:()=>{K(!1),ce(null)},onSaleSaved:os,customers:k,users:f,permissionProfiles:P,products:T,suppliers:D,onAddNewCustomer:as,onAddProduct:rs,brands:z,categories:E,productModels:x,grades:r,gradeValues:c,receiptTerms:ne,paymentMethods:Ge,saleToEdit:Je})}),Ue&&e.jsx(Hs,{onClose:()=>fe(!1)}),be&&e.jsx(Bs,{sale:be,productMap:_,customers:k,users:f,onClose:()=>je(null)}),Xe&&Q&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-[70]",children:e.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-xl w-full max-w-sm",children:[e.jsx("h3",{className:"text-lg font-bold mb-4 text-primary",children:"Escolha o Formato de Impressão"}),e.jsxs("p",{className:"text-sm text-muted mb-6",children:["Selecione o layout para o recibo da venda #",Q.id,"."]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("button",{onClick:()=>{de("A4"),Z(!1)},className:"w-full text-left flex items-center gap-4 p-4 border rounded-lg hover:bg-surface-secondary hover:border-accent",children:[e.jsx(Rs,{className:"h-8 w-8 text-accent"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Formato A4"}),e.jsx("p",{className:"text-xs text-muted",children:"Layout padrão para impressoras comuns."})]})]}),e.jsxs("button",{onClick:()=>{de("thermal"),Z(!1)},className:"w-full text-left flex items-center gap-4 p-4 border rounded-lg hover:bg-surface-secondary hover:border-accent",children:[e.jsx(Ls,{className:"h-8 w-8 text-accent"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Cupom 80mm"}),e.jsx("p",{className:"text-xs text-muted",children:"Layout para impressoras térmicas."})]})]})]}),e.jsx("button",{onClick:()=>{Z(!1),ie(null)},className:"mt-6 w-full px-4 py-2 bg-gray-200 text-secondary rounded-md hover:bg-gray-300",children:"Cancelar"})]})}),Q&&ye&&e.jsx(qs,{sale:Q,format:ye,productMap:_,customers:k,users:f,onClose:()=>{ie(null),de(null)}}),$&&e.jsx(Gs,{isOpen:!!$,onClose:()=>le(null),onConfirm:ns,title:"Cancelar Venda",message:`Você está prestes a cancelar a venda #${$.id}. Os produtos serão retornados ao estoque. Por favor, informe o motivo.`})]})};export{st as default};
