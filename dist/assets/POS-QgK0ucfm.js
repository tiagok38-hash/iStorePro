import{j as e,ae as U,X as ee,h as De,f as j,u as Ae,s as Re,Z as Ee,af as de,ag as Pe,ah as Te,a1 as ms,ai as xe,i as Ve,a5 as us,aj as hs,ak as ps,al as $e,P as Oe,E as Y,am as Le,w as Ie,M as gs,z as bs,F as fs,an as js,k as ys,g as Ns,b as ws,a as vs,ao as Ss,m as Cs,ap as ks,n as Is,o as Ms,p as Ds,q as As,r as Rs,c as Es,S as Ps,Q as Ts,a8 as Vs,aq as $s,ar as Me,as as Os,at as Ls}from"./index-BMA--0RW.js";import{r as a,d as H,u as Fe}from"./react-vendor-Bv8thS0I.js";import{S as Fs,a as _s}from"./SaleDetailModal-DuxgAQqk.js";import{S as Bs}from"./SearchableDropdown-Cwt49rKC.js";import{C as zs}from"./CurrencyInput-DaWIS5Fg.js";import{N as qs}from"./NewSaleView-B-0FMbxA.js";import"./supabase-C1Qlw3jS.js";import"./CustomerModal-Cs-UW485.js";import"./Button-wK47DqCu.js";import"./ProductModal-D-J2CwZs.js";const Us=({products:n,onClose:o})=>{const[h,p]=a.useState(""),c=a.useRef(null);a.useEffect(()=>{c.current&&c.current.focus()},[]);const y=n.filter(t=>{if(!h)return!1;const m=h.toLowerCase();return((t.model||"").toLowerCase().includes(m)||(t.imei1||"").toLowerCase().includes(m)||(t.imei2||"").toLowerCase().includes(m)||(t.serialNumber||"").toLowerCase().includes(m)||(t.brand||"").toLowerCase().includes(m)||(t.observations||"").toLowerCase().includes(m))&&t.stock>0});return e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in",onClick:o,children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden animate-scale-in",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(U,{className:"h-6 w-6 text-primary"}),"Consulta Rápida de Estoque"]}),e.jsx("p",{className:"text-sm text-muted mt-1",children:"Pesquise por descrição, IMEI ou Serial Number"})]}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-gray-200 rounded-full transition-colors text-gray-500",children:e.jsx(ee,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"p-6 bg-white border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center border-2 border-gray-200 rounded-xl bg-white focus-within:border-primary focus-within:ring-4 focus-within:ring-primary/10 transition-all",children:[e.jsx("div",{className:"pl-4",children:e.jsx(De,{className:"h-6 w-6 text-gray-400"})}),e.jsx("input",{ref:c,type:"text",value:h,onChange:t=>p(t.target.value),placeholder:"Pesquise por IMEI, Serial, Modelo (ou bipe)...",className:"flex-1 w-full py-4 px-4 text-lg font-medium outline-none bg-transparent border-none focus:ring-0"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-gray-50/50",children:h===""?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-muted",children:[e.jsx(U,{className:"h-16 w-16 text-gray-300 mb-4"}),e.jsx("p",{className:"font-medium",children:"Digite algo para pesquisar no estoque."})]}):y.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-64 text-muted",children:e.jsx("p",{className:"font-medium",children:"Nenhum produto encontrado em estoque."})}):e.jsx("div",{className:"grid grid-cols-1 gap-3",children:y.map(t=>e.jsx("div",{className:"bg-white p-4 rounded-xl border border-gray-200 shadow-sm hover:border-primary hover:shadow-md transition-all group",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-bold text-gray-900 text-lg",children:t.model}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-black uppercase ${t.condition==="Novo"?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700"}`,children:t.condition})]}),e.jsxs("div",{className:"text-xs text-muted flex flex-wrap gap-x-4 gap-y-1",children:[t.imei1&&e.jsxs("span",{children:[e.jsx("strong",{className:"text-gray-500",children:"IMEI:"})," ",t.imei1]}),t.serialNumber&&e.jsxs("span",{children:[e.jsx("strong",{className:"text-gray-500",children:"S/N:"})," ",t.serialNumber]}),t.storageLocation&&e.jsxs("span",{children:[e.jsx("strong",{className:"text-gray-500",children:"Local:"})," ",t.storageLocation]}),t.batteryHealth!==void 0&&t.batteryHealth>0&&e.jsxs("span",{children:[e.jsx("strong",{className:"text-gray-500",children:"Bateria:"})," ",t.batteryHealth,"%"]})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[10px] font-bold text-muted uppercase tracking-wider",children:"Estoque"}),e.jsx("p",{className:`text-lg font-black ${t.stock>0?"text-gray-800":"text-red-500"}`,children:t.stock})]}),e.jsxs("div",{className:"text-right min-w-[100px]",children:[e.jsx("p",{className:"text-[10px] font-bold text-muted uppercase tracking-wider",children:"Preço"}),e.jsx("p",{className:"text-xl font-black text-primary",children:j(t.price)})]})]})]})},t.id))})})]})})},Hs=({customers:n,receiptTerms:o,onUpdateReceiptFormat:h})=>{const{showToast:p}=Ae(),[c,y]=a.useState(localStorage.getItem("pos_default_customer_id")||""),[t,m]=a.useState(localStorage.getItem("pos_default_warranty_term")||""),[d,k]=a.useState(localStorage.getItem("pos_default_receipt_format")||null),v=()=>{c?localStorage.setItem("pos_default_customer_id",c):localStorage.removeItem("pos_default_customer_id"),t?localStorage.setItem("pos_default_warranty_term",t):localStorage.removeItem("pos_default_warranty_term"),d?(localStorage.setItem("pos_default_receipt_format",d),h(d)):localStorage.removeItem("pos_default_receipt_format"),p("Configurações salvas com sucesso!","success")};return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8 animate-fade-in p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 border-b pb-4 mb-6",children:"Configurações do PDV"}),e.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-sm border border-gray-200 space-y-8",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-4 border-b border-gray-100",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(Re,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Preferências de Venda"}),e.jsx("p",{className:"text-sm text-muted",children:"Personalize o comportamento padrão do seu caixa"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Cliente Padrão"}),e.jsx("p",{className:"text-xs text-muted mb-3 h-8",children:"Cliente pré-selecionado ao iniciar venda."}),e.jsx(Bs,{options:n.map(g=>({value:g.id,label:g.name})),value:c,onChange:g=>y(g),placeholder:"Buscar cliente..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Termo de Garantia Padrão"}),e.jsx("p",{className:"text-xs text-muted mb-3 h-8",children:"Termo aplicado automaticamente a novos produtos."}),e.jsxs("select",{className:"w-full p-3 bg-gray-50 border border-gray-300 rounded-xl outline-none focus:ring-2 focus:ring-primary/20 transition-all font-medium text-gray-700",value:t,onChange:g=>m(g.target.value),children:[e.jsx("option",{value:"",children:"-- Padrão do Sistema --"}),o.map(g=>e.jsx("option",{value:g.name,children:g.name},g.id))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Formato de Impressão Padrão"}),e.jsx("p",{className:"text-xs text-muted mb-3",children:"Escolha como os comprovantes serão impressos por padrão. Se nenhum for selecionado, o sistema perguntará a cada impressão."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{className:`p-4 rounded-xl border-2 transition-all flex flex-col items-center gap-3 ${d==="A4"?"border-primary bg-primary/5 text-primary shadow-sm":"border-gray-200 hover:bg-gray-50 text-gray-500"}`,onClick:()=>k(d==="A4"?null:"A4"),children:[e.jsx(Ee,{className:"h-8 w-8"}),e.jsx("span",{className:"font-bold",children:"Folha A4"})]}),e.jsxs("button",{className:`p-4 rounded-xl border-2 transition-all flex flex-col items-center gap-3 ${d==="thermal"?"border-primary bg-primary/5 text-primary shadow-sm":"border-gray-200 hover:bg-gray-50 text-gray-500"}`,onClick:()=>k(d==="thermal"?null:"thermal"),children:[e.jsx(de,{className:"h-8 w-8"}),e.jsx("span",{className:"font-bold",children:"Térmica 80mm"})]})]})]})]}),e.jsx("div",{className:"pt-6 border-t border-gray-100 flex justify-end",children:e.jsxs("button",{onClick:v,className:"px-6 py-2 bg-success text-white rounded-lg font-bold text-sm shadow-md shadow-success/20 hover:bg-success/90 transition-all flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),"SALVAR ALTERAÇÕES"]})})]})]})},Xs=({isOpen:n,onClose:o,onConfirm:h,type:p})=>{const[c,y]=a.useState(0),[t,m]=a.useState("");if(!n)return null;const d=p==="sangria",k=d?"Lançar Sangria":"Lançar Suprimento",v=g=>{g.preventDefault(),!(c<=0)&&h(c,t)};return e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden animate-scale-in",children:[e.jsxs("div",{className:`px-6 py-4 flex justify-between items-center ${d?"bg-red-50":"bg-green-50"} border-b ${d?"border-red-100":"border-green-100"}`,children:[e.jsxs("h3",{className:`font-bold text-lg ${d?"text-red-700":"text-green-700"} flex items-center gap-2`,children:[e.jsx(Te,{className:"h-6 w-6"}),k]}),e.jsx("button",{type:"button",onClick:o,className:"text-gray-400 hover:text-gray-600",children:e.jsx(ms,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:v,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:["Valor ",d?"(Saída)":"(Entrada)"]}),e.jsx(zs,{value:c,onChange:y,className:`w-full text-2xl font-black p-3 rounded-lg border focus:ring-2 outline-none ${d?"focus:ring-red-200 border-red-200 text-red-600":"focus:ring-green-200 border-green-200 text-green-600"}`,placeholder:"R$ 0,00",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Motivo / Observação"}),e.jsx("input",{type:"text",value:t,onChange:g=>m(g.target.value),className:"w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary/20 outline-none",placeholder:d?"Ex: Pagamento de fornecedor":"Ex: Reforço de caixa",required:!0})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:o,className:"flex-1 px-4 py-3 bg-gray-100 text-gray-700 font-bold rounded-lg hover:bg-gray-200 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:c<=0,className:`flex-1 px-4 py-3 text-white font-bold rounded-lg shadow-lg transition-all transform hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-50 disabled:cursor-not-allowed ${d?"bg-red-500 hover:bg-red-600 shadow-red-200":"bg-green-500 hover:bg-green-600 shadow-green-200"}`,children:"Confirmar"})]})]})]})})},Gs=({cashId:n,onOpenStockSearch:o})=>{const[h,p]=a.useState(new Date);return a.useEffect(()=>{const c=setInterval(()=>p(new Date),1e3);return()=>clearInterval(c)},[]),e.jsxs("header",{className:"bg-white h-16 border-b border-gray-200 flex items-center justify-between px-6 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(xe,{className:"h-6 w-6 text-primary"})," PDV iStore"]}),n&&e.jsxs("span",{className:"bg-success-light text-success px-3 py-1 rounded-full text-xs font-bold border border-success animate-pulse",children:["CAIXA #",n," ABERTO"]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("button",{onClick:o,className:"flex items-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-lg font-bold text-xs uppercase transition-colors",title:"Busca Rápida Estoque",children:[e.jsx(U,{className:"h-5 w-5 text-gray-500"}),e.jsx("span",{className:"hidden sm:inline",children:"Busca Rápida no Estoque"})]}),e.jsxs("div",{className:"text-right hidden sm:block",children:[e.jsx("p",{className:"text-xs text-muted font-medium uppercase tracking-wider",children:"Data e Hora"}),e.jsx("p",{className:"text-sm font-bold text-primary font-mono",children:h.toLocaleString("pt-BR")})]})]})]})},Ws=H.memo(Gs),Qs=({activeView:n,onViewChange:o})=>{const{logout:h,user:p}=Ve(),c=Fe(),y=()=>{h(),c("/login")},t=[{label:"Meu Caixa",view:"resumo",icon:e.jsx(ps,{})},{label:"PDV",view:"pdv",icon:e.jsx($e,{})},{label:"Caixas",view:"caixas",icon:e.jsx(U,{})},{label:"Config",view:"config",icon:e.jsx(Re,{})}];return e.jsxs("aside",{className:"w-20 bg-gray-900 flex flex-col items-center py-6 gap-6 text-white shrink-0 shadow-2xl z-20",children:[e.jsx("div",{className:"mb-4 animate-pulse-slow",children:e.jsx(xe,{className:"h-10 w-10 text-success"})}),e.jsx("nav",{className:"flex flex-col gap-4 w-full px-2",children:t.map(m=>e.jsxs("button",{onClick:()=>o(m.view),className:`p-3 rounded-xl flex flex-col items-center gap-1 transition-all group ${n===m.view?"bg-success text-white shadow-lg shadow-success/20 scale-105":"text-gray-400 hover:text-white hover:bg-white/5"}`,title:m.label,children:[H.cloneElement(m.icon,{className:`h-6 w-6 transition-transform group-hover:scale-110 ${n===m.view?"animate-bounce-subtle":""}`}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-tighter",children:m.label})]},m.view))}),e.jsxs("div",{className:"mt-auto w-full px-2 flex flex-col items-center gap-4 pb-2",children:[e.jsx("div",{className:"w-full h-px bg-white/10 mb-2"}),e.jsxs("div",{className:"flex flex-col items-center gap-1 group cursor-default",children:[e.jsx("div",{className:"h-10 w-10 rounded-full border-2 border-white/20 overflow-hidden bg-gray-800 flex items-center justify-center transition-all group-hover:border-success/50",children:p?.avatarUrl?e.jsx("img",{src:p.avatarUrl,alt:p.name,className:"h-full w-full object-cover"}):e.jsx(us,{className:"h-8 w-8 text-gray-500"})}),e.jsx("span",{className:"text-[9px] font-bold text-gray-400 truncate max-w-[64px] transition-colors group-hover:text-white uppercase tracking-tighter",children:p?.name?.split(" ")[0]||"Usuário"})]}),e.jsx("button",{onClick:y,className:"p-3 w-12 h-12 rounded-xl text-gray-400 hover:text-danger hover:bg-danger/10 transition-all flex items-center justify-center group",title:"Sair do PDV",children:e.jsx(hs,{className:"h-6 w-6 transition-transform group-hover:scale-110"})})]})]})},Zs=H.memo(Qs),Js=({sessions:n,userMap:o,onReopen:h,onCloseSession:p,onViewDetails:c,startDate:y,setStartDate:t,endDate:m,setEndDate:d,userOptions:k,userFilter:v,setUserFilter:g,currentUserOpenSession:P,currentUserId:A,onNewSession:X,searchTerm:T,setSearchTerm:N})=>e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Gerenciamento de Caixas"}),P&&e.jsxs("button",{onClick:()=>c(P),className:"px-5 py-2.5 bg-success text-white rounded-lg font-bold flex items-center gap-2 shadow-lg shadow-success/20 hover:bg-success/90 transition-all transform hover:-translate-y-0.5 active:translate-y-0 uppercase text-xs",children:[e.jsx(Oe,{className:"h-5 w-5"})," IR PARA MEU CAIXA"]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-200 flex flex-wrap items-end gap-5",children:[e.jsxs("div",{className:"w-auto",children:[e.jsx("label",{className:"block text-xs font-black text-gray-600 mb-1.5 uppercase tracking-wider",children:"Período de Abertura"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:y,onChange:i=>t(i.target.value),className:"p-2 border rounded-lg text-sm bg-gray-50 border-gray-300 w-36 focus:ring-2 focus:ring-success/20 outline-none"}),e.jsx("span",{className:"text-gray-400 font-bold",children:"à"}),e.jsx("input",{type:"date",value:m,onChange:i=>d(i.target.value),className:"p-2 border rounded-lg text-sm bg-gray-50 border-gray-300 w-36 focus:ring-2 focus:ring-success/20 outline-none"})]})]}),e.jsxs("div",{className:"flex-grow min-w-[300px]",children:[e.jsx("label",{className:"block text-xs font-black text-gray-600 mb-1.5 uppercase tracking-wider",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:e.jsx(De,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Buscar por operador, ID do caixa ou ID da venda (ex: ID-10 ou 10)",value:T,onChange:i=>N(i.target.value),className:"w-full p-2.5 pl-10 border rounded-lg text-sm bg-gray-50 border-gray-300 focus:ring-2 focus:ring-success/20 outline-none"})]})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:e.jsxs("table",{className:"w-full text-base text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 uppercase text-xs font-black tracking-widest border-b border-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"ID / Status"}),e.jsx("th",{className:"px-6 py-4",children:"Operador"}),e.jsx("th",{className:"px-6 py-4",children:"Datas"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Abertura"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Movimentação"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Saldo Atual"}),e.jsx("th",{className:"px-6 py-4 text-center",children:"Ações"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 text-gray-700",children:n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-12 text-center text-muted italic",children:"Nenhum caixa encontrado para os filtros selecionados."})}):n.map(i=>e.jsxs("tr",{className:"hover:bg-gray-50/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-bold text-primary",children:["#",i.displayId]}),e.jsx("span",{className:`px-2 py-0.5 rounded-md text-[9px] font-black uppercase border ${i.status==="aberto"?"bg-green-100 text-green-700 border-green-200":"bg-red-100 text-red-700 border-red-200"}`,children:i.status})]})}),e.jsx("td",{className:"px-6 py-4 font-semibold text-gray-800",children:o[i.userId]}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsxs("span",{children:[e.jsx("span",{className:"text-muted",children:"Aberto:"})," ",new Date(i.openTime).toLocaleString("pt-BR")]}),i.closeTime&&e.jsxs("span",{children:[e.jsx("span",{className:"text-muted",children:"Fechado:"})," ",new Date(i.closeTime).toLocaleString("pt-BR")]})]})}),e.jsx("td",{className:"px-6 py-4 text-right font-semibold",children:j(i.openingBalance)}),e.jsx("td",{className:"px-6 py-4 text-right font-bold text-success",children:j(i.transactionsValue)}),e.jsx("td",{className:"px-6 py-4 text-right font-black text-gray-900",children:j(i.cashInRegister)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>c(i),title:"Ver Detalhes",className:"p-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors",children:e.jsx(Y,{className:"h-5 w-5"})}),i.status==="aberto"&&e.jsx("button",{onClick:()=>p(i),title:"Fechar Caixa",className:"p-2 rounded-lg bg-red-50 text-red-600 hover:bg-red-100 transition-colors",children:e.jsx(ee,{className:"h-5 w-5"})}),i.status==="fechado"&&e.jsx("button",{onClick:()=>h(i),title:"Reabrir Caixa",className:"p-2 rounded-lg bg-blue-50 text-blue-600 hover:bg-blue-100 transition-colors",children:e.jsx(Le,{className:"h-5 w-5"})})]})})]},i.id))})]})})]}),Ks=H.memo(Js),Ys=({viewSession:n,currentUserOpenSession:o,sessionSales:h,customers:p,handleNewSession:c,setActiveView:y,handleOpenCashMovement:t,handleCloseSession:m,handleReopenSession:d,handleEditSale:k,handleViewClick:v,handlePrintClick:g,cancelSale:P,showToast:A,fetchData:X,users:T})=>{const[N,i]=a.useState(null),x=n||o;x?.id,o?.id;const S=x?.status==="aberto",V={};(h||[]).forEach(l=>{l.status!=="Cancelada"&&(l.payments||[]).forEach(b=>{V[b.method]=(V[b.method]||0)+(b.value||0)})});let F=0;Object.entries(V).forEach(([l,b])=>{l.trim().toLowerCase()==="dinheiro"&&(F+=Number(b||0))});const se=Number(x?.openingBalance||0)+F+Number(x?.deposits||0)-Number(x?.withdrawals||0);return x?e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:n?"Detalhes do Caixa":"Meu Caixa"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-4 items-stretch",children:[e.jsxs("div",{className:"lg:col-span-8 bg-white p-5 rounded-xl shadow-sm border border-primary/20 flex flex-col justify-between relative overflow-hidden h-full",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1.5 h-full bg-success"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"p-1 px-1.5 bg-success/10 rounded text-success",children:e.jsx(Ie,{className:"h-5 w-5"})}),e.jsx("span",{className:"text-xs font-bold text-gray-700 uppercase tracking-widest",children:"Total do Caixa"})]}),e.jsx("div",{className:"text-4xl font-black text-gray-800",children:j(x.transactionsValue)})]}),e.jsx("div",{className:"pt-4 border-t border-gray-100",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:Object.entries(V).sort((l,b)=>l[0].trim().toLowerCase()==="dinheiro"?-1:1).map(([l,b])=>{const $=l.trim().toLowerCase()==="dinheiro";return e.jsxs("div",{className:`p-2.5 px-4 rounded-xl border flex items-center justify-between gap-2 transition-all ${$?"bg-success/5 border-success/30 ring-1 ring-success/10":"bg-white border-gray-200 shadow-sm"}`,children:[e.jsxs("span",{className:`text-[10px] font-bold uppercase tracking-wider ${$?"text-success":"text-gray-500"}`,children:[l," ",$&&"★"]}),e.jsx("span",{className:`text-base font-black ${$?"text-success":"text-gray-800"}`,children:j(b)})]},l)})})})]})]}),e.jsx("div",{className:"lg:col-span-4 flex flex-col gap-3 h-full",children:e.jsxs("div",{className:`bg-white p-5 rounded-xl shadow-sm border ${S?"border-success/30":"border-red-500/30"} relative overflow-hidden flex flex-col justify-between gap-6 h-full text-gray-700`,children:[e.jsx("div",{className:`absolute top-0 left-0 w-1.5 h-full ${S?"bg-success":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest",children:"Dinheiro espécie na gaveta"}),e.jsx("span",{className:`px-2 py-1 ${S?"bg-success":"bg-red-500"} text-white text-[10px] font-black uppercase rounded shrink-0`,children:x.status==="aberto"?"ABERTO":"FECHADO"})]}),e.jsx("div",{className:"text-4xl font-black text-gray-800 leading-none cursor-help",title:`Abertura: ${j(x?.openingBalance||0)} + Vendas: ${j(F)} + Suprim.: ${j(x?.deposits||0)} - Sangrias: ${j(x?.withdrawals||0)}`,children:j(se)})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs font-bold text-red-500 uppercase tracking-widest",children:"Sangria (-)"}),e.jsx("span",{className:"text-xl font-black text-gray-800 tracking-tight",children:j(x.withdrawals||0)})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("button",{onClick:()=>i("sangria"),title:"Visualizar Sangrias",className:"p-2 bg-gray-50 text-gray-400 hover:bg-primary/10 hover:text-primary rounded-lg transition-all border border-gray-100 shadow-sm",children:e.jsx(Y,{className:"h-4 w-4"})}),S&&e.jsx("button",{onClick:()=>t("sangria"),title:"Nova Sangria",className:"p-2 bg-danger/5 text-danger hover:bg-danger hover:text-white rounded-lg border border-danger/30 transition-all shadow-sm",children:e.jsx(gs,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs font-bold text-green-600 uppercase tracking-widest",children:"Suprimento (+)"}),e.jsx("span",{className:"text-xl font-black text-gray-800 tracking-tight",children:j(x.deposits||0)})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("button",{onClick:()=>i("suprimento"),title:"Visualizar Suprimentos",className:"p-2 bg-gray-50 text-gray-400 hover:bg-primary/10 hover:text-primary rounded-lg transition-all border border-gray-100 shadow-sm",children:e.jsx(Y,{className:"h-4 w-4"})}),S&&e.jsx("button",{onClick:()=>t("suprimento"),title:"Novo Suprimento",className:"p-2 bg-success/5 text-success hover:bg-success hover:text-white rounded-lg border border-success/30 transition-all shadow-sm",children:e.jsx(Oe,{className:"h-4 w-4"})})]})]})]})]})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[S&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>y("pdv"),className:"flex-1 min-w-[200px] px-8 py-4 bg-success text-white rounded-xl font-black shadow-lg shadow-success/20 hover:bg-success/90 transition-all flex items-center justify-center gap-3 text-lg uppercase tracking-tight transform hover:-translate-y-0.5 active:translate-y-0",children:[e.jsx($e,{className:"h-7 w-7"}),"NOVA VENDA"]}),e.jsxs("button",{onClick:()=>m(x),className:"px-8 py-4 bg-white text-danger border-2 border-danger rounded-xl font-black shadow-sm hover:bg-danger hover:text-white transition-all flex items-center gap-3 text-lg uppercase tracking-tight transform hover:-translate-y-0.5 active:translate-y-0",children:[e.jsx(ee,{className:"h-7 w-7"}),"FECHAR CAIXA"]})]}),x.status==="fechado"&&e.jsxs("button",{onClick:()=>d(x),className:"px-8 py-4 bg-blue-500 text-white rounded-xl font-black shadow-lg shadow-blue-500/20 hover:bg-blue-600 transition-all flex items-center gap-3 text-lg uppercase tracking-tight",children:[e.jsx(Le,{className:"h-7 w-7"}),"REABRIR CAIXA"]}),e.jsxs("div",{className:"flex-1 flex flex-wrap items-center gap-6 bg-white p-4 rounded-xl border border-gray-100 ml-auto",children:[e.jsxs("div",{className:"px-4 border-r border-gray-100",children:[e.jsx("p",{className:"text-[10px] text-muted uppercase font-bold tracking-wider",children:"Aberto em"}),e.jsx("p",{className:"font-bold text-gray-700",children:new Date(x.openTime).toLocaleString("pt-BR")})]}),x.closeTime&&e.jsxs("div",{className:"px-4 border-r border-gray-100",children:[e.jsx("p",{className:"text-[10px] text-muted uppercase font-bold tracking-wider",children:"Fechado em"}),e.jsx("p",{className:"font-bold text-gray-700",children:new Date(x.closeTime).toLocaleString("pt-BR")})]}),e.jsxs("div",{className:"px-4",children:[e.jsx("p",{className:"text-[10px] text-muted uppercase font-bold tracking-wider",children:"Operador"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-success"}),e.jsx("p",{className:"font-bold text-gray-700",children:T.find(l=>l.id===x.userId)?.name||"Sistema"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-100 flex justify-between items-center",children:e.jsxs("h3",{className:"font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Ie,{className:"h-5 w-5 text-primary"}),"Vendas desta Sessão"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-base text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 uppercase text-xs font-black tracking-widest border-b border-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"ID Venda"}),e.jsx("th",{className:"px-6 py-3",children:"Hora"}),e.jsx("th",{className:"px-6 py-3",children:"Cliente"}),e.jsx("th",{className:"px-6 py-3 text-right",children:"Valor"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"Ações"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 text-gray-700",children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-muted italic",children:"Nenhuma venda realizada nesta sessão ainda."})}):h.map(l=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4 font-black text-primary",children:["#",l.id]}),e.jsx("td",{className:"px-6 py-4 text-sm font-semibold text-gray-600",children:new Date(l.date).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{className:"px-6 py-4 font-semibold text-gray-800",children:p.find(b=>b.id===l.customerId)?.name||"Cliente"}),e.jsx("td",{className:"px-6 py-4 text-right font-bold text-success",children:j(l.total)}),e.jsx("td",{className:"px-6 py-4 text-center",children:l.status==="Editada"?e.jsxs("div",{className:"flex gap-1 justify-center items-center",children:[e.jsx("span",{className:"px-2 py-1 rounded text-[10px] font-black uppercase bg-purple-100 text-purple-700",children:"Editada"}),e.jsx("span",{className:"px-2 py-1 rounded text-[10px] font-black uppercase bg-green-100 text-green-700",children:"Finalizada"})]}):e.jsx("span",{className:`px-2 py-1 rounded text-[10px] font-black uppercase ${l.status==="Cancelada"?"bg-red-100 text-red-600":l.status==="Pendente"?"bg-orange-100 text-orange-600":"bg-green-100 text-green-600"}`,children:l.status})}),e.jsx("td",{className:"px-6 py-4 text-center",children:l.status!=="Cancelada"&&e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{title:"Editar Venda",className:"p-1.5 text-blue-500 hover:bg-blue-50 rounded transition-colors",onClick:()=>{if(!S){A("Você precisa abrir este caixa para poder fazer a modificação.","error");return}k(l)},children:e.jsx(bs,{className:"h-4 w-4"})}),e.jsx("button",{title:"Visualizar Venda",className:"p-1.5 text-gray-500 hover:bg-gray-100 rounded transition-colors",onClick:()=>v(l),children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx("button",{title:"Reimprimir Comprovante",className:"p-1.5 text-blue-500 hover:bg-blue-50 rounded transition-colors",onClick:()=>g(l),children:e.jsx(de,{className:"h-4 w-4"})}),e.jsx("button",{title:"Cancelar Venda",onClick:()=>{if(!S){A("Você precisa abrir este caixa para poder fazer a modificação.","error");return}confirm("Tem certeza que deseja cancelar esta venda?")&&P(l.id,"Cancelamento rápido pelo caixa").then(()=>{A("Venda cancelada com sucesso.","success"),X()}).catch(()=>A("Erro ao cancelar venda.","error"))},className:"p-1.5 text-red-500 hover:bg-red-50 rounded transition-colors",children:e.jsx(fs,{className:"h-4 w-4"})})]})})]},l.id))})]})})]}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden animate-scale-in",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50/50",children:[e.jsxs("h3",{className:"font-black text-gray-800 flex items-center gap-2 uppercase tracking-tight",children:[e.jsx(Te,{className:`h-5 w-5 ${N==="sangria"?"text-red-500":"text-green-600"}`}),"Detalhamento de ",N==="sangria"?"Sangrias (Saídas)":"Suprimentos (Entradas)"]}),e.jsx("button",{onClick:()=>i(null),className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(ee,{className:"h-6 w-6 text-gray-400"})})]}),e.jsx("div",{className:"max-h-[60vh] overflow-y-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 uppercase text-[10px] font-bold tracking-widest sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"Data/Hora"}),e.jsx("th",{className:"px-6 py-3",children:"Operador"}),e.jsx("th",{className:"px-6 py-3",children:"Motivo"}),e.jsx("th",{className:"px-6 py-3 text-right",children:"Valor"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 text-gray-700",children:!x.movements||x.movements.filter(l=>l.type===N).length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:4,className:"px-6 py-8 text-center text-muted italic",children:["Nenhuma ",N," realizada nesta sessão."]})}):x.movements.filter(l=>l.type===N).sort((l,b)=>new Date(b.timestamp).getTime()-new Date(l.timestamp).getTime()).map(l=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 text-xs font-medium text-gray-500",children:new Date(l.timestamp).toLocaleString("pt-BR")}),e.jsx("td",{className:"px-6 py-4 font-medium",children:T.find(b=>b.id===l.userId)?.name||"Usuário"}),e.jsx("td",{className:"px-6 py-4",children:l.reason}),e.jsxs("td",{className:`px-6 py-4 text-right font-black ${N==="sangria"?"text-red-500":"text-green-600"}`,children:[N==="sangria"?"-":"+"," ",j(l.amount)]})]},l.id))})]})}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-100 flex justify-between items-center text-sm",children:[e.jsx("span",{className:"font-bold text-gray-500 uppercase tracking-wider",children:"Total Acumulado:"}),e.jsx("span",{className:`text-xl font-black ${N==="sangria"?"text-red-500":"text-green-600"}`,children:j(N==="sangria"?x.withdrawals||0:x.deposits||0)})]})]})})]}):e.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-sm border border-gray-200 text-center flex flex-col items-center gap-6",children:[e.jsx("div",{className:"p-4 bg-gray-100 rounded-full",children:e.jsx(xe,{className:"h-16 w-16 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-700",children:"Seu caixa está fechado"}),e.jsx("p",{className:"text-muted",children:"Abra seu caixa para começar a realizar vendas."})]}),e.jsxs("button",{onClick:c,className:"px-8 py-4 bg-success text-white rounded-xl font-black text-lg shadow-xl shadow-success/20 hover:bg-success/90 transition-all transform hover:-translate-y-1 active:translate-y-0 flex items-center gap-3",children:[e.jsx(Pe,{className:"h-6 w-6"}),"ABRIR MEU CAIXA"]})]})},ea=H.memo(Ys),xa=()=>{const{user:n}=Ve(),{showToast:o}=Ae();Fe();const[h,p]=a.useState([]),[c,y]=a.useState([]),[t,m]=a.useState([]),[d,k]=a.useState([]),[v,g]=a.useState([]),[P,A]=a.useState([]),[X,T]=a.useState([]),[N,i]=a.useState([]),[x,S]=a.useState([]),[V,F]=a.useState([]),[se,l]=a.useState([]),[b,$]=a.useState([]),[me,_e]=a.useState([]),[Be,ze]=a.useState([]),[qe,ue]=a.useState(!0),[_,C]=a.useState("resumo"),[Ue,he]=a.useState(!1),[He,ae]=a.useState(!1),[pe,ge]=a.useState("0"),[Xe,G]=a.useState(!1),[be,Ge]=a.useState("sangria"),[R,O]=a.useState(null),[fe,te]=a.useState(null),[je,ye]=a.useState(null),[We,re]=a.useState(null),[Qe,W]=a.useState("thermal"),[Ne,B]=a.useState(!1),[le,Ze]=a.useState(()=>{const s=new Date;return s.setDate(s.getDate()-7),s.toISOString().split("T")[0]}),[ne,Je]=a.useState(()=>new Date().toISOString().split("T")[0]),[Q,Ke]=a.useState(null),[oe,Ye]=a.useState(""),z=a.useCallback(async(s=!1)=>{s||ue(!0);try{const[r,u,f,w,I,q,E,K,ie,ke,D,cs,is,ds]=await Promise.all([js(),ys(),Ns(),ws(),vs(),Ss(),Cs(),ks(),Is(),Ms(),Ds(),As(),Rs(),Es()]);p(r),y(u),m(f),k(w),g(I),_e(q),A(E),T(K),i(ie),S(ke),F(D),l(cs),$(is),ze(ds.filter(xs=>!xs.name.toLowerCase().includes("pagseguro")))}catch(r){console.error("POS: Error fetching data:",r),o("Erro ao carregar dados do PDV.","error")}finally{s||ue(!1)}},[o]);a.useEffect(()=>{z()},[z]);const L=a.useMemo(()=>h.map(s=>{const r=d.filter(w=>w.cashSessionId===s.id&&w.status!=="Cancelada"),u=r.reduce((w,I)=>w+(I.total||0),0),f=r.reduce((w,I)=>{const q=(I.payments||[]).filter(E=>E.method==="Dinheiro").reduce((E,K)=>E+(K.value||0),0);return w+q},0);return{...s,transactionsValue:u,cashInRegister:(s.cashInRegister||0)+f}}),[h,d]),M=a.useMemo(()=>L.find(s=>s.status==="aberto"&&s.userId===n?.id),[L,n]),Z=a.useMemo(()=>R&&L.find(s=>s.id===R.id)||null,[R,L]),J=a.useMemo(()=>Z?.status==="aberto"?Z:M,[Z,M]),es=s=>{s==="resumo"&&O(null),C(s)},we=()=>{if(M){o("Você já possui um caixa aberto.","warning");return}ge("0"),ae(!0)},ss=async()=>{try{const s=await Ls({userId:n?.id||"system",openingBalance:parseFloat(pe)||0},n?.id,n?.name);p(r=>[s,...r]),ae(!1),o("Caixa aberto com sucesso!","success"),C("pdv")}catch{o("Erro ao abrir o caixa.","error")}},ve=async s=>{try{const r=await Me({id:s.id,status:"fechado",closeTime:new Date().toISOString()},n?.id,n?.name);p(u=>u.map(f=>f.id===r.id?r:f)),R?.id===r.id&&O(r),o("Caixa fechado com sucesso!","success"),C("caixas")}catch{o("Erro ao fechar o caixa.","error")}},Se=async s=>{if(h.find(u=>u.status==="aberto")){o("Feche os outros caixas que estão em aberto para reabrir este.","warning");return}try{const u=await Me({id:s.id,status:"aberto",closeTime:null},n?.id,n?.name);await z(!0),u.userId===n?.id?O(null):O(u),o("Caixa reaberto com sucesso!","success"),C("resumo")}catch{o("Erro ao reabrir o caixa.","error")}},as=async(s,r)=>{const u=J?.id;if(!u){o("Nenhum caixa selecionado para a movimentação.","error");return}try{G(!1);const f=await Os(u,{type:be,amount:Number(s),reason:r,userId:n?.id||"system"},n?.id,n?.name);p(w=>w.map(I=>I.id===f.id?f:I)),R?.id===f.id&&O(f),o("Movimentação registrada com sucesso!","success")}catch(f){o(f.message||"Erro ao registrar movimentação.","error"),G(!0)}},ts=s=>{te(s);const r=localStorage.getItem("pos_default_receipt_format");r?(W(r),B(!1)):B(!0)},rs=s=>{re(null),C("resumo"),z()},ce=a.useMemo(()=>c.reduce((s,r)=>({...s,[r.id]:r.name}),{}),[c]),Ce=a.useMemo(()=>t.reduce((s,r)=>({...s,[r.id]:r}),{}),[t]),ls=a.useMemo(()=>c.map(s=>({value:s.id,label:s.name})),[c]),ns=a.useMemo(()=>{const s=oe.toLowerCase().trim().replace(/^#/,"");return L.filter(r=>{const u=new Date(r.openTime).toISOString().split("T")[0],f=u>=le&&u<=ne,w=Q?r.userId===Q:!0;if(s){const q=(ce[r.userId]||"").toLowerCase().includes(s),E=r.displayId.toString()===s||r.displayId.toString().includes(s),ie=d.filter(D=>D.cashSessionId===r.id).map(D=>D.id.toLowerCase()).some(D=>D.includes(s)||D===`id-${s}`);return f&&w&&(q||E||ie)}return f&&w})},[L,le,ne,Q,oe,ce,d]),os=a.useMemo(()=>{const s=(R||M)?.id;return s?d.filter(r=>r.cashSessionId===s).sort((r,u)=>new Date(u.date).getTime()-new Date(r.date).getTime()):[]},[d,R,M]);return qe?e.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-100",children:e.jsx(Ps,{})}):e.jsxs("div",{className:"flex h-screen bg-gray-100 overflow-hidden",children:[e.jsx(Zs,{activeView:_,onViewChange:es}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsx(Ws,{cashId:M?.displayId,onOpenStockSearch:()=>he(!0)}),e.jsxs("main",{className:"flex-1 overflow-auto p-6",children:[_==="caixas"&&e.jsx(Ks,{sessions:ns,userMap:ce,onReopen:Se,onCloseSession:ve,onViewDetails:s=>{O(s),C("resumo")},startDate:le,setStartDate:Ze,endDate:ne,setEndDate:Je,userOptions:ls,userFilter:Q,setUserFilter:Ke,currentUserOpenSession:M,currentUserId:n?.id,onNewSession:we,searchTerm:oe,setSearchTerm:Ye}),_==="pdv"&&(J?e.jsx(qs,{onCancel:()=>{C("caixas"),re(null)},onSaleSaved:rs,customers:v,paymentMethods:Be,users:c,products:t,suppliers:P,permissionProfiles:X,brands:N,categories:x,productModels:V,grades:se,gradeValues:b,receiptTerms:me,onAddNewCustomer:async s=>{const r=await Vs(s);return g(u=>[...u,r]),r},onAddProduct:async s=>{const r=await Ts(s);return m(u=>[...u,r]),r},openCashSessionId:J.id,openCashSessionDisplayId:J.displayId,saleToEdit:We}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center space-y-4",children:[e.jsx(U,{className:"h-16 w-16 text-gray-300"}),e.jsx("h3",{className:"text-xl font-bold text-gray-600",children:"Nenhum caixa aberto"}),e.jsx("button",{onClick:()=>C("caixas"),className:"px-6 py-2 bg-primary text-white rounded-lg",children:"Ir para Caixas"})]})),_==="resumo"&&e.jsx(ea,{viewSession:Z,currentUserOpenSession:M,sessionSales:os,customers:v,handleNewSession:we,setActiveView:C,handleOpenCashMovement:s=>{Ge(s),G(!0)},handleCloseSession:ve,handleReopenSession:Se,handleEditSale:s=>{re(s),C("pdv")},handleViewClick:ye,handlePrintClick:ts,cancelSale:$s,showToast:o,fetchData:z,users:c}),_==="config"&&e.jsx(Hs,{customers:v,receiptTerms:me,onUpdateReceiptFormat:W})]}),Ue&&e.jsx(Us,{products:t,onClose:()=>he(!1)}),e.jsx(Xs,{isOpen:Xe,onClose:()=>G(!1),onConfirm:as,type:be}),Ne&&e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 w-full max-w-sm animate-scale-in",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4 text-center",children:"Selecionar Formato"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>{W("A4"),B(!1)},className:"flex flex-col items-center gap-2 p-4 rounded-xl border-2 border-gray-100 hover:border-primary transition-all group",children:[e.jsx(Ee,{className:"h-8 w-8 text-gray-400 group-hover:text-primary"}),e.jsx("span",{className:"font-bold text-sm",children:"Folha A4"})]}),e.jsxs("button",{onClick:()=>{W("thermal"),B(!1)},className:"flex flex-col items-center gap-2 p-4 rounded-xl border-2 border-gray-100 hover:border-primary transition-all group",children:[e.jsx(de,{className:"h-8 w-8 text-gray-400 group-hover:text-primary"}),e.jsx("span",{className:"font-bold text-sm",children:"Térmica 80mm"})]})]}),e.jsx("button",{onClick:()=>{B(!1),te(null)},className:"mt-6 w-full py-3 bg-gray-100 rounded-lg text-gray-500 font-bold",children:"Cancelar"})]})}),je&&e.jsx(Fs,{sale:je,productMap:Ce,customers:v,users:c,onClose:()=>ye(null)}),fe&&!Ne&&e.jsx(_s,{sale:fe,productMap:Ce,customers:v,users:c,onClose:()=>te(null),format:Qe}),He&&e.jsx("div",{className:"fixed inset-0 z-[80] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 w-full max-w-sm animate-scale-in",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4 text-center",children:"Abrir Caixa"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Valor Inicial (Fundo de Troco)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 font-bold",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:pe,onChange:s=>ge(s.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg text-lg font-bold outline-none",placeholder:"0,00",autoFocus:!0})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>ae(!1),className:"flex-1 py-3 bg-gray-100 text-gray-600 rounded-lg font-bold",children:"Cancelar"}),e.jsx("button",{onClick:ss,className:"flex-1 py-3 bg-success text-white rounded-lg font-bold shadow-lg shadow-success/20",children:"ABRIR CAIXA"})]})]})})]})]})};export{xa as default};
