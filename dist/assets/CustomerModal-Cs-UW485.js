import{u as Y,j as e,a5 as B,ag as D,z as J,aI as Z,aJ as _,h as ee,aw as se}from"./index-BMA--0RW.js";import{r as o}from"./react-vendor-Bv8thS0I.js";import{B as ae,C as re}from"./Button-wK47DqCu.js";const te=r=>r.replace(/\D/g,"").substring(0,11).replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})/,"$1-$2"),le=r=>r.replace(/\D/g,"").substring(0,14).replace(/(\d{2})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1/$2").replace(/(\d{4})(\d)/,"$1-$2"),ne=r=>{const i=r.replace(/\D/g,"").substring(0,8);return i.length<=2?i:i.length<=4?`${i.slice(0,2)}/${i.slice(2)}`:`${i.slice(0,2)}/${i.slice(2,4)}/${i.slice(4)}`},ce=["AC","AL","AP","AM","BA","CE","DF","ES","GO","MA","MT","MS","MG","PA","PB","PR","PE","PI","RJ","RN","RS","RO","RR","SC","SP","SE","TO"],he=({entity:r,initialType:i,onClose:L,onSave:U,isSaving:q})=>{const[C,R]=o.useState("dados"),[c,h]=o.useState({address:{}}),[g,f]=o.useState(i),[u,y]=o.useState("Pessoa Física"),[j,A]=o.useState({}),[oe,T]=o.useState(!1),[w,b]=o.useState(null),N=o.useRef(null),{showToast:I}=Y(),[G,P]=o.useState(!1),[E,v]=o.useState(!1),F=o.useRef(null),$=o.useRef(null);o.useEffect(()=>{const s=a=>{E&&F.current&&!F.current.contains(a.target)&&$.current&&!$.current.contains(a.target)&&v(!1)};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[E]),o.useEffect(()=>{const s={zip:"",street:"",number:"",complement:"",neighborhood:"",city:"",state:""};r?.address&&typeof r.address!="string"&&Object.assign(s,r.address);const a={name:r?.name||"",email:r?.email||"",phone:r?.phone||"",cpf:r?.cpf||"",rg:r?.rg||"",birthDate:r?.birthDate||"",cnpj:r?.cnpj||"",address:s,id:r?.id,avatarUrl:r?.avatarUrl};h(a),b(r?.avatarUrl||null),f(r?.cnpj?"Fornecedor":i),y(r?.cnpj?"Pessoa Jurídica":"Pessoa Física")},[r,i]);const W=(s,a)=>s==="zip"&&a&&a.replace(/\D/g,"").length<8?"CEP inválido (precisa ter 8 caracteres)":s==="cpf"&&u==="Pessoa Física"&&a&&a.replace(/\D/g,"").length<11?"CPF inválido (precisa ter 11 caracteres)":"",d=s=>{const{name:a,value:t}=s.target,m={...j},x=W(a,t);if(x?m[a]=x:delete m[a],A(m),a.includes(".")){const[p,S]=a.split(".");h(O=>({...O,[p]:{...O[p],[S]:t}}))}else{let p=t;a==="cpf"?p=te(t):a==="cnpj"?p=le(t):a==="phone"&&(p=se(t)),h(S=>({...S,[a]:p}))}},V=async s=>{const a=s.target.value.replace(/\D/g,"");if(h(t=>({...t,address:{...t.address,zip:a}})),A(t=>({...t,zip:a.length>0&&a.length<8?"CEP inválido (precisa ter 8 caracteres)":""})),a.length===8){T(!0);try{const t=await fetch(`https://viacep.com.br/ws/${a}/json/`);if(!t.ok)throw new Error("CEP API request failed");const m=await t.json();m.erro?I("CEP não encontrado.","warning"):h(x=>({...x,address:{...x.address,street:m.logradouro,city:m.localidade,state:m.uf,zip:a,neighborhood:m.bairro}}))}catch{I("Erro ao buscar CEP.","error")}finally{T(!1)}}},H=()=>{h(s=>({...s,address:{zip:"",street:"",number:"",complement:"",neighborhood:"",city:"",state:""}}))},K=s=>{if(s.target.files&&s.target.files[0]){const a=s.target.files[0],t=new FileReader;t.onloadend=()=>{const m=t.result;b(m),h(x=>({...x,avatarUrl:m}))},t.readAsDataURL(a)}},Q=()=>{b(null),h(s=>({...s,avatarUrl:void 0})),N.current&&(N.current.value="")},X=s=>{s.preventDefault(),U(c,g,u)},l="p-2 border rounded-md bg-white border-border focus:ring-1 focus:ring-green-500 focus:border-green-500 w-full text-sm h-10",n="block text-sm font-medium text-gray-700 mb-1",k=s=>`flex items-center gap-2 p-3 border rounded-lg cursor-pointer transition-colors ${g===s?"bg-green-100 border-green-300 text-green-800 font-semibold":""}`,M=s=>`flex items-center gap-2 p-3 border rounded-lg cursor-pointer transition-colors ${u===s?"bg-green-100 border-green-300 text-green-800 font-semibold":""}`,z=({name:s,icon:a,label:t})=>e.jsxs("button",{type:"button",onClick:()=>R(s),className:`flex items-center gap-2 px-4 py-2 rounded-md font-semibold transition-colors ${C===s?"bg-green-100 text-green-700":"text-gray-500 hover:bg-gray-100"}`,children:[a,t]});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4 transition-opacity animate-fade-in",children:e.jsxs("div",{className:"bg-gray-50 rounded-lg shadow-2xl w-full max-w-4xl max-h-[95vh] flex flex-col overflow-y-auto animate-fade-in-up",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-green-100 p-2 rounded-full",children:e.jsx(B,{className:"h-6 w-6 text-green-600"})}),e.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"Cadastro de Cliente ou Fornecedor"})]}),e.jsx("button",{type:"button",onClick:L,className:"p-2 rounded-full hover:bg-gray-200",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:X,className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{name:"dados",icon:e.jsx(D,{className:"h-5 w-5"}),label:"Dados"}),e.jsx(z,{name:"endereco",icon:e.jsx(D,{className:"h-5 w-5"}),label:"Endereço"})]})}),e.jsxs("div",{className:"p-6 space-y-6 bg-white",children:[C==="dados"&&e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsxs("div",{className:"w-full md:w-1/4 flex flex-col items-center space-y-2 pt-4",children:[e.jsx("input",{type:"file",ref:N,onChange:K,className:"hidden",accept:"image/*"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-32 h-32 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden border-2 border-white shadow-md",children:w?e.jsx("img",{src:w,alt:"Preview",className:"w-full h-full object-cover"}):e.jsx(B,{className:"w-24 h-24 text-gray-400"})}),e.jsx("button",{ref:$,type:"button",onClick:()=>v(s=>!s),className:"absolute bottom-1 right-1 bg-white p-1.5 rounded-full shadow-lg hover:bg-gray-100 transition-colors",title:"Adicionar ou alterar foto",children:e.jsx(J,{className:"w-4 h-4 text-primary"})}),E&&e.jsxs("div",{ref:F,className:"absolute bottom-0 right-12 mb-1 w-40 bg-white rounded-md shadow-lg border border-border z-10",children:[e.jsxs("button",{type:"button",onClick:()=>{N.current?.click(),v(!1)},className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-left hover:bg-gray-100",children:[e.jsx(Z,{className:"h-4 w-4"}),"Enviar foto"]}),e.jsxs("button",{type:"button",onClick:()=>{P(!0),v(!1)},className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-left hover:bg-gray-100",children:[e.jsx(_,{className:"h-4 w-4"}),"Tirar foto"]})]})]}),w&&e.jsx("button",{type:"button",onClick:Q,className:"text-xs text-red-600 hover:text-red-800",children:"Remover foto"})]}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("label",{className:k("Cliente"),children:[e.jsx("input",{type:"radio",name:"entityType",value:"Cliente",checked:g==="Cliente",onChange:()=>f("Cliente"),className:"form-radio text-green-600"})," Cliente"]}),e.jsxs("label",{className:k("Fornecedor"),children:[e.jsx("input",{type:"radio",name:"entityType",value:"Fornecedor",checked:g==="Fornecedor",onChange:()=>f("Fornecedor"),className:"form-radio text-green-600"})," Fornecedor"]}),e.jsxs("label",{className:k("Ambos"),children:[e.jsx("input",{type:"radio",name:"entityType",value:"Ambos",checked:g==="Ambos",onChange:()=>f("Ambos"),className:"form-radio text-green-600"})," Ambos"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("label",{className:M("Pessoa Física"),children:[e.jsx("input",{type:"radio",name:"personType",value:"Pessoa Física",checked:u==="Pessoa Física",onChange:()=>y("Pessoa Física"),className:"form-radio text-green-600"})," Pessoa Física"]}),e.jsxs("label",{className:M("Pessoa Jurídica"),children:[e.jsx("input",{type:"radio",name:"personType",value:"Pessoa Jurídica",checked:u==="Pessoa Jurídica",onChange:()=>y("Pessoa Jurídica"),className:"form-radio text-green-600"})," Pessoa Jurídica"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:n,children:"Nome*"}),e.jsx("input",{name:"name",value:c.name||"",onChange:d,className:l,required:!0})]}),u==="Pessoa Física"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:n,children:"CPF"}),e.jsx("input",{name:"cpf",value:c.cpf||"",onChange:d,className:`${l} ${j.cpf?"border-red-500":""}`}),e.jsx("p",{className:"text-red-600 text-xs mt-1",children:j.cpf})]}),e.jsxs("div",{children:[e.jsx("label",{className:n,children:"RG"}),e.jsx("input",{name:"rg",value:c.rg||"",onChange:d,className:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:n,children:"Data Nascimento"}),e.jsx("input",{name:"birthDate",type:"text",placeholder:"dd/mm/aaaa",value:c.birthDate||"",onChange:s=>h(a=>({...a,birthDate:ne(s.target.value)})),className:l})]})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:n,children:"CNPJ"}),e.jsx("input",{name:"cnpj",value:c.cnpj||"",onChange:d,className:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:n,children:"Inscrição Estadual"}),e.jsx("input",{name:"ie",className:l})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:n,children:"WhatsApp*"}),e.jsx("input",{name:"phone",value:c.phone||"",onChange:d,className:l,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:n,children:"Telefone"}),e.jsx("input",{className:l})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:n,children:"Email"}),e.jsx("input",{name:"email",type:"email",value:c.email||"",onChange:d,className:l})]}),e.jsx("div",{className:"text-right pt-4",children:e.jsx("button",{type:"button",onClick:()=>R("endereco"),className:"px-4 py-2 bg-gray-700 text-white rounded-md text-sm",children:"Endereço →"})})]})]}),C==="endereco"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:n,children:"CEP"}),e.jsx("input",{name:"zip",value:c.address?.zip||"",onChange:V,className:`${l} ${j.zip?"border-red-500":""}`,maxLength:8}),e.jsx("p",{className:"text-red-600 text-xs mt-1",children:j.zip})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",className:"px-4 py-2 w-full bg-green-500 text-white rounded-md text-sm flex items-center justify-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4"})," Buscar"]}),e.jsxs("button",{type:"button",onClick:H,className:"px-4 py-2 w-full bg-gray-200 text-gray-700 rounded-md text-sm flex items-center justify-center gap-2",children:[e.jsx(J,{className:"h-4 w-4"})," Limpar endereço"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:n,children:"Logradouro"}),e.jsx("input",{name:"address.street",value:c.address?.street||"",onChange:d,className:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:n,children:"Número"}),e.jsx("input",{name:"address.number",value:c.address?.number||"",onChange:d,className:l})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:n,children:"Bairro"}),e.jsx("input",{name:"address.neighborhood",value:c.address?.neighborhood||"",onChange:d,className:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:n,children:"Complemento"}),e.jsx("input",{name:"address.complement",value:c.address?.complement||"",onChange:d,className:l})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:n,children:"Cidade"}),e.jsx("input",{name:"address.city",value:c.address?.city||"",onChange:d,className:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:n,children:"Estado"}),e.jsxs("select",{name:"address.state",value:c.address?.state||"",onChange:d,className:l,children:[e.jsx("option",{value:"",children:"UF"}),ce.map(s=>e.jsx("option",{value:s,children:s},s))]})]})]})]})]}),e.jsx("div",{className:"flex justify-end p-4 bg-gray-50 border-t",children:e.jsx(ae,{type:"submit",variant:"success",loading:q,icon:e.jsx(D,{className:"h-5 w-5"}),children:"Salvar"})})]})]})}),e.jsx(re,{isOpen:G,onClose:()=>P(!1),onCapture:s=>{b(s),h(a=>({...a,avatarUrl:s})),P(!1)}})]})};export{he as C};
