import{u as _,i as W,k as Le,ap as Ge,j as e,S as Y,au as Be,av as ze,aw as xe,ax as Fe,F as ee,ay as $e,z as H,ag as le,az as we,aA as qe,aB as Ve,aC as _e,aD as We,aE as He,aF as Je,E as Xe,P as oe,a1 as Ce,aG as Ke,aH as Ye,a5 as ce,aI as ue,aJ as Qe,ae as V,D as ge,aK as Ze,I as es,e as ss,b as as,l as ts,g as rs,c as ns,aL as ls,aM as os,aN as cs,ao as is,aO as ds,aP as ms,aQ as us,aR as xs,aS as hs,aT as ps,aU as gs,aV as bs,aW as fs,n as js,o as ys,p as Ns,q as vs,r as ws,aX as Cs,aY as Ss,aZ as Es,A as $,ak as ne,a_ as Z,X as ks,w as Ps,a$ as Is,b0 as Ms,b1 as Rs,b2 as Ts,b3 as Ds,b4 as As,b5 as be,b6 as Os,b7 as Us,b8 as Ls,b9 as Gs,ba as Bs,bb as zs,bc as Fs,bd as $s,be as qs,bf as Vs,bg as _s,bh as Ws,bi as Hs,bj as Js}from"./index-BMA--0RW.js";import{r as s,j as Xs,d as Ks}from"./react-vendor-Bv8thS0I.js";import{C as se}from"./ConfirmationModal-CVAza7gk.js";import{B,C as Ys}from"./Button-wK47DqCu.js";import"./supabase-C1Qlw3jS.js";const fe=[{title:"Acesso às Seções",permissions:[{key:"canAccessDashboard",label:"Acessar Dashboard"},{key:"canAccessEstoque",label:"Acessar Estoque"},{key:"canViewPurchases",label:"Acessar Compras"},{key:"canAccessVendas",label:"Acessar Vendas"},{key:"canAccessPOS",label:"Acessar PDV (Frente de Caixa)"},{key:"canAccessClientes",label:"Acessar Clientes"},{key:"canAccessFornecedores",label:"Acessar Fornecedores"},{key:"canAccessRelatorios",label:"Acessar Relatórios"},{key:"canAccessEmpresa",label:"Acessar Configurações da Empresa"}]},{title:"Produtos e Estoque",permissions:[{key:"canCreateProduct",label:"Criar/Lançar Novos Produtos"},{key:"canEditProduct",label:"Editar Produtos"},{key:"canDeleteProduct",label:"Excluir Produtos"},{key:"canEditStock",label:"Fazer Ajustes Manuais de Estoque"}]},{title:"Vendas",permissions:[{key:"canCreateSale",label:"Realizar Novas Vendas"},{key:"canCancelSale",label:"Cancelar Vendas"}]},{title:"Compras",permissions:[{key:"canCreatePurchase",label:"Criar Novas Compras"},{key:"canEditPurchase",label:"Editar Compras"},{key:"canDeletePurchase",label:"Excluir Compras"},{key:"canLaunchPurchase",label:"Lançar Compras no Estoque"}]},{title:"Administração da Empresa",permissions:[{key:"canManageCompanyData",label:"Gerenciar Dados da Empresa"},{key:"canManageUsers",label:"Gerenciar Usuários"},{key:"canManagePermissions",label:"Gerenciar Perfis de Permissão"},{key:"canViewAudit",label:"Visualizar Log de Auditoria"},{key:"canEditOwnProfile",label:"Acessar e Editar Perfil"},{key:"canManageMarcasECategorias",label:"Gerenciar Marcas e Categorias"}]}],Qs=({isOpen:l,onClose:v,onSave:N,profile:m})=>{const[a,u]=s.useState(""),[d,h]=s.useState({}),[t,b]=s.useState(!1);s.useEffect(()=>{const p=fe.reduce((n,x)=>(x.permissions.forEach(o=>{n[o.key]=!1}),n),{});m?(u(m.name||""),h({...p,...m.permissions||{}})):(u(""),h(p))},[m]);const i=(p,n)=>{h(x=>({...x,[p]:n}))},f=async()=>{b(!0),await N({...m,name:a,permissions:d}),b(!1)};return l?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] flex flex-col",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:[m?.id?"Editar":"Criar"," Perfil de Permissão"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nome do Perfil"}),e.jsx("input",{type:"text",value:a,onChange:p=>u(p.target.value),className:"w-full p-2 border rounded-md"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-4 pr-2",children:fe.map(p=>e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-primary mb-2 border-b pb-1",children:p.title}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2",children:p.permissions.map(n=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!d[n.key],onChange:x=>i(n.key,x.target.checked),className:"form-checkbox h-4 w-4 text-accent rounded focus:ring-accent"}),e.jsx("span",{className:"text-sm",children:n.label})]},n.key))})]},p.title))}),e.jsxs("div",{className:"flex justify-end gap-4 mt-6 pt-4 border-t",children:[e.jsx(B,{onClick:v,variant:"secondary",children:"Cancelar"}),e.jsx(B,{onClick:f,variant:"success",loading:t,icon:e.jsx(le,{className:"h-5 w-5"}),children:"Salvar"})]})]})}):null},Zs=({isOpen:l,onClose:v,onSave:N,user:m,profiles:a})=>{const[u,d]=s.useState({}),[h,t]=s.useState(!1),{showToast:b}=_();s.useEffect(()=>{d(m||{})},[m]);const i=n=>{const{name:x,value:o}=n.target;d(j=>({...j,[x]:o}))},f=async()=>{if(!u.name||!u.email||!u.permissionProfileId){b("Preencha os campos obrigatórios.","warning");return}if(!m?.id&&!u.password){b("A senha é obrigatória para novos usuários.","warning");return}t(!0);const n={...u};m?.id&&!n.password&&delete n.password,await N(n),t(!1)};if(!l)return null;const p="w-full p-2 border rounded-md bg-surface text-primary border-border focus:ring-1 focus:ring-success focus:border-success";return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-xl w-full max-w-lg",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:[m?.id?"Editar":"Novo"," Usuário"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Nome*"}),e.jsx("input",{type:"text",name:"name",value:u.name||"",onChange:i,className:p,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Email (Login)*"}),e.jsx("input",{type:"email",name:"email",value:u.email||"",onChange:i,className:p,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Senha ",m?.id&&"(Deixe em branco para manter)","*"]}),e.jsx("input",{type:"password",name:"password",value:u.password||"",onChange:i,className:p,placeholder:m?.id?"••••••••":"Senha obrigatória"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Telefone"}),e.jsx("input",{type:"text",name:"phone",value:u.phone||"",onChange:n=>d(x=>({...x,phone:xe(n.target.value)})),className:p})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Perfil de Permissão*"}),e.jsxs("select",{name:"permissionProfileId",value:u.permissionProfileId||"",onChange:i,className:p,required:!0,children:[e.jsx("option",{value:"",children:"Selecione um perfil"}),a.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-6",children:[e.jsx(B,{onClick:v,variant:"secondary",children:"Cancelar"}),e.jsx(B,{onClick:f,variant:"success",loading:h,icon:e.jsx(le,{className:"h-5 w-5"}),children:"Salvar"})]})]})})},ea=()=>{const[l,v]=s.useState([]),[N,m]=s.useState([]),[a,u]=s.useState(!0),{showToast:d}=_(),{refreshPermissions:h,user:t}=W(),[b,i]=s.useState(!1),[f,p]=s.useState(!1),[n,x]=s.useState(null),[o,j]=s.useState(null),[C,M]=s.useState(null),[c,r]=s.useState(null),w=s.useCallback(async()=>{u(!0);try{const[y,O]=await Promise.all([Le(),Ge()]);v(y),m(O)}catch{d("Erro ao carregar usuários e perfis.","error")}finally{u(!1)}},[d]);s.useEffect(()=>{w()},[w]);const k=s.useMemo(()=>N.reduce((y,O)=>(y[O.id]=O.name,y),{}),[N]),P=()=>{x({}),i(!0)},S=y=>{x(y),i(!0)},A=async y=>{try{"id"in y&&y.id?(await we(y),d("Usuário atualizado com sucesso!","success")):(await qe(y),d("Usuário criado com sucesso!","success")),w(),i(!1),x(null)}catch(O){console.error(O),d(O.message||"Erro ao salvar usuário.","error")}},E=y=>M(y),L=async()=>{if(C)try{await We(C.id,t?.id,t?.name),d("Usuário excluído com sucesso!","success"),w()}catch{d("Erro ao excluir usuário.","error")}finally{M(null)}},R=()=>{j({}),p(!0)},G=y=>{j(y),p(!0)},U=async y=>{try{let O;"id"in y&&y.id?(O=await Ve(y),d("Perfil atualizado com sucesso!","success")):(O=await _e(y),d("Perfil criado com sucesso!","success")),t&&O.id===t.permissionProfileId&&h(),w(),p(!1),j(null)}catch(O){console.error(O),d(typeof O=="string"?O:O.message||"Erro ao salvar perfil.","error")}},J=y=>r(y),q=async()=>{if(c)try{await He(c.id),d("Perfil excluído com sucesso!","success"),w()}catch(y){d(y.message||"Erro ao excluir perfil.","error")}finally{r(null)}};return a?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(Y,{})}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-primary",children:"Cadastre usuários e perfis de permissões"}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-red-50 text-red-600 border border-red-200 rounded-md font-semibold text-sm hover:bg-red-100",children:[e.jsx(Be,{className:"h-5 w-5"}),"Assistir Tutorial"]})]}),e.jsxs("div",{className:"w-full lg:max-w-5xl space-y-8",children:[e.jsxs("div",{className:"bg-surface rounded-lg border border-border p-6 space-y-4",children:[e.jsx("div",{className:"flex justify-end items-center",children:e.jsxs("button",{onClick:P,className:"flex items-center gap-2 px-3 py-2 bg-primary text-on-primary rounded-md font-semibold text-sm hover:bg-opacity-90",children:[e.jsx(ze,{className:"h-5 w-5"}),"Novo Usuário"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-secondary uppercase bg-surface-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-medium",children:"Login do Usuário"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Nome"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Telefone"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Permissão"}),e.jsx("th",{className:"px-4 py-3 font-medium text-right",children:"Ações"})]})}),e.jsx("tbody",{className:"text-primary",children:l.map(y=>e.jsxs("tr",{className:"border-t border-border",children:[e.jsx("td",{className:"px-4 py-3",children:y.email}),e.jsx("td",{className:"px-4 py-3",children:y.name}),e.jsx("td",{className:"px-4 py-3",children:xe(y.phone)}),e.jsx("td",{className:"px-4 py-3",children:k[y.permissionProfileId]||"N/A"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:()=>S(y),title:"Editar Usuário",className:"text-muted hover:text-primary",children:e.jsx(Fe,{})}),e.jsx("button",{onClick:()=>E(y),title:"Excluir Usuário",className:"text-on-primary bg-danger rounded-full p-0.5 hover:bg-opacity-80",children:e.jsx(ee,{className:"h-4 w-4"})})]})})]},y.id))})]})})]}),e.jsxs("div",{className:"bg-surface rounded-lg border border-border p-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-primary",children:"Perfil de permissões para usuários"}),e.jsx("p",{className:"text-sm text-muted",children:"Crie perfis de permissões para seus colaboradores e defina quais permissões cada perfil terá acesso."})]}),e.jsxs("button",{onClick:R,className:"flex items-center gap-2 px-4 py-2 bg-secondary text-on-primary rounded-md font-semibold text-sm hover:bg-opacity-90",children:[e.jsx($e,{className:"h-5 w-5"}),"Criar perfil"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-secondary uppercase bg-surface-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-medium",children:"Nome do Perfil"}),e.jsx("th",{className:"px-4 py-3 font-medium text-right",children:"Ações"})]})}),e.jsx("tbody",{className:"text-primary",children:N.map(y=>e.jsxs("tr",{className:"border-t border-border",children:[e.jsx("td",{className:"px-4 py-3",children:y.name}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:()=>G(y),title:"Editar Perfil",className:"text-muted hover:text-primary",children:e.jsx(H,{})}),e.jsx("button",{onClick:()=>J(y),title:"Excluir Perfil",className:"text-on-primary bg-danger rounded-full p-0.5 hover:bg-opacity-80",children:e.jsx(ee,{className:"h-4 w-4"})})]})})]},y.id))})]})})]})]}),e.jsx(Zs,{isOpen:b,user:n,profiles:N,onClose:()=>{i(!1),x(null)},onSave:A}),e.jsx(Qs,{isOpen:f,profile:o,onClose:()=>{p(!1),j(null)},onSave:U}),e.jsx(se,{isOpen:!!C,onClose:()=>M(null),onConfirm:L,title:"Excluir Usuário",message:`Tem certeza que deseja excluir o usuário "${C?.name}"?`}),e.jsx(se,{isOpen:!!c,onClose:()=>r(null),onConfirm:q,title:"Excluir Perfil de Permissão",message:`Tem certeza que deseja excluir o perfil "${c?.name}"?`})]})},sa=[{brand:"Xiaomi",category:"Smartphone",subcategory:"Redmi Note 13 Pro 8GB/256GB - Azul"},{brand:"Xiaomi",category:"Tablet",subcategory:"Redmi Pad SE 4GB/128GB"},{brand:"DJI",category:"Drone",subcategory:"Mini 2 SE Fly More Combo 2.7K"},{brand:"TP-Link",category:"Roteador",subcategory:"Archer AX72"},{brand:"Samsung",category:"Smartphone",subcategory:"A72 6GB/128GB - Branco"},{brand:"Samsung",category:"Smart TV",subcategory:'UN43T5300 43" Full HD'}],aa=({item:l,brandName:v,categoryName:N,onSave:m,onClose:a,isSaving:u})=>{const[d,h]=s.useState(""),[t,b]=s.useState(!0);s.useEffect(()=>{l&&h(l.name||"")},[l]);const i=f=>{f.preventDefault(),m({...l,name:d})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4",children:e.jsxs("form",{onSubmit:i,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b",children:[e.jsxs("h3",{className:"flex items-center gap-2 font-bold text-lg text-primary",children:[e.jsx(H,{className:"h-5 w-5"}),"Editor de Subcategoria"]}),e.jsxs("button",{type:"button",onClick:()=>b(!t),className:"px-3 py-1.5 bg-blue-500 text-white text-xs font-semibold rounded-md flex items-center gap-2 hover:bg-blue-600",children:[t?e.jsx(Je,{className:"h-4 w-4"}):e.jsx(Xe,{className:"h-4 w-4"}),t?"OCULTAR ORIENTAÇÃO":"MOSTRAR ORIENTAÇÃO"]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[t&&e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"p-3 bg-blue-50 border border-blue-200 text-blue-800 text-sm rounded-md",children:["A Subcategoria poderá ser tratada como o ",e.jsx("b",{children:"Modelo"})," do produto que pretende incluir no estoque. Por exemplo:"]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:sa.map((f,p)=>e.jsxs("div",{className:"p-3 border border-border rounded-md bg-surface-secondary text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Marca:"})," ",f.brand]}),e.jsxs("p",{className:"text-blue-600 font-medium",children:[e.jsx("span",{className:"font-semibold text-primary",children:"Categoria:"})," ",f.category]}),e.jsxs("p",{className:"text-blue-600 font-medium",children:[e.jsx("span",{className:"font-semibold text-primary",children:"Subcategoria:"})," ",f.subcategory]})]},p))})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-bold",children:"Marca:"})," ",v]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-bold",children:"Categoria:"})," ",N]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary mb-1",children:"Nome da Subcategoria"}),e.jsx("input",{type:"text",value:d,onChange:f=>h(f.target.value),className:"w-full p-2 border rounded bg-transparent border-border",autoFocus:!0,required:!0})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 p-4 bg-gray-50 border-t",children:[e.jsx(B,{type:"button",onClick:a,variant:"secondary",children:"Fechar"}),e.jsx(B,{type:"submit",variant:"primary",loading:u,children:"Salvar"})]})]})})},ta=({item:l,onSave:v,onClose:N,isSaving:m})=>{const[a,u]=s.useState({name:"",warrantyTerm:{content:"",showOnReceipt:!0},warrantyExclusions:{content:"",showOnReceipt:!0},imageRights:{content:"",showOnReceipt:!0}});s.useEffect(()=>{u({id:l?.id,name:l?.name||"",warrantyTerm:l?.warrantyTerm?{...l.warrantyTerm}:{content:"",showOnReceipt:!0},warrantyExclusions:l?.warrantyExclusions?{...l.warrantyExclusions}:{content:"",showOnReceipt:!0},imageRights:l?.imageRights?{...l.imageRights}:{content:"",showOnReceipt:!0}})},[l]);const d=b=>{u(i=>({...i,name:b.target.value}))},h=(b,i,f)=>{u(p=>({...p,[b]:{...p[b]||{content:"",showOnReceipt:!0},[i]:f}}))},t=b=>{b.preventDefault(),v(a)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-[60] p-4",children:e.jsxs("form",{onSubmit:t,className:"bg-surface rounded-lg shadow-xl w-full max-w-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b",children:[e.jsxs("h3",{className:"flex items-center gap-2 font-bold text-lg text-primary",children:[e.jsx(oe,{className:"h-5 w-5"}),l?.id?"Editar":"Cadastrar"," Termo de Garantia"]}),e.jsx("button",{type:"button",onClick:N,children:e.jsx(Ce,{className:"h-6 w-6 text-muted hover:text-danger"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary mb-1",children:"Nome de identificação do seu termo:"}),e.jsx("input",{type:"text",name:"name",value:a.name||"",onChange:d,className:"w-full p-2 border rounded bg-transparent border-border",placeholder:"Insira o nome",autoFocus:!0,required:!0})]}),e.jsxs("div",{className:"border border-border rounded-lg",children:[e.jsxs("div",{className:`flex justify-between items-center p-3 bg-surface-secondary ${a.warrantyTerm?.showOnReceipt?"rounded-t-lg":"rounded-lg"}`,children:[e.jsx("h4",{className:"font-semibold text-primary",children:"Termo de Garantia"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsx("span",{children:"Exibir no recibo"}),e.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"warrantyTerm-show",checked:a.warrantyTerm?.showOnReceipt===!0,onChange:()=>h("warrantyTerm","showOnReceipt",!0),className:"form-radio w-4 h-4"})," sim"]}),e.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"warrantyTerm-show",checked:a.warrantyTerm?.showOnReceipt===!1,onChange:()=>h("warrantyTerm","showOnReceipt",!1),className:"form-radio w-4 h-4"})," não"]})]})]}),a.warrantyTerm?.showOnReceipt&&e.jsx("textarea",{value:a.warrantyTerm?.content||"",onChange:b=>h("warrantyTerm","content",b.target.value),rows:4,className:"w-full p-3 bg-surface rounded-b-lg focus:ring-0 focus:outline-none border-t border-border",placeholder:"Digite os termos aqui..."})]}),e.jsxs("div",{className:"border border-border rounded-lg",children:[e.jsxs("div",{className:`flex justify-between items-center p-3 bg-surface-secondary ${a.warrantyExclusions?.showOnReceipt?"rounded-t-lg":"rounded-lg"}`,children:[e.jsx("h4",{className:"font-semibold text-primary",children:"A garantia não cobre"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsx("span",{children:"Exibir no recibo"}),e.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"warrantyExclusions-show",checked:a.warrantyExclusions?.showOnReceipt===!0,onChange:()=>h("warrantyExclusions","showOnReceipt",!0),className:"form-radio w-4 h-4"})," sim"]}),e.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"warrantyExclusions-show",checked:a.warrantyExclusions?.showOnReceipt===!1,onChange:()=>h("warrantyExclusions","showOnReceipt",!1),className:"form-radio w-4 h-4"})," não"]})]})]}),a.warrantyExclusions?.showOnReceipt&&e.jsx("textarea",{value:a.warrantyExclusions?.content||"",onChange:b=>h("warrantyExclusions","content",b.target.value),rows:4,className:"w-full p-3 bg-surface rounded-b-lg focus:ring-0 focus:outline-none border-t border-border",placeholder:"Digite os termos aqui..."})]}),e.jsxs("div",{className:"border border-border rounded-lg",children:[e.jsxs("div",{className:`flex justify-between items-center p-3 bg-surface-secondary ${a.imageRights?.showOnReceipt?"rounded-t-lg":"rounded-lg"}`,children:[e.jsx("h4",{className:"font-semibold text-primary",children:"Direito de Imagem"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsx("span",{children:"Exibir no recibo"}),e.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"imageRights-show",checked:a.imageRights?.showOnReceipt===!0,onChange:()=>h("imageRights","showOnReceipt",!0),className:"form-radio w-4 h-4"})," sim"]}),e.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"imageRights-show",checked:a.imageRights?.showOnReceipt===!1,onChange:()=>h("imageRights","showOnReceipt",!1),className:"form-radio w-4 h-4"})," não"]})]})]}),a.imageRights?.showOnReceipt&&e.jsx("textarea",{value:a.imageRights?.content||"",onChange:b=>h("imageRights","content",b.target.value),rows:4,className:"w-full p-3 bg-surface rounded-b-lg focus:ring-0 focus:outline-none border-t border-border",placeholder:"Digite os termos aqui..."})]})]}),e.jsx("div",{className:"flex justify-center p-4 bg-gray-50 border-t",children:e.jsx(B,{type:"submit",variant:"primary",loading:m,className:"px-10",children:"Salvar"})})]})})},je=({value:l,onChange:v,className:N})=>{const[m,a]=s.useState("0"),[u,d]=s.useState(!1);s.useEffect(()=>{u||a(l.toString().replace(".",","))},[l,u]);const h=b=>{let i=b.target.value;if(i=i.replace(/[^0-9,]/g,""),(i.match(/,/g)||[]).length>1)return;a(i);const f=parseFloat(i.replace(",","."))||0;v(f)},t=()=>{d(!1),a(l.toString().replace(".",","))};return e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:m,onChange:h,onFocus:()=>d(!0),onBlur:t,className:N}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none text-sm",children:"%"})]})},ye={debitRate:0,creditNoInterestRates:Array.from({length:21},(l,v)=>({installments:v+1,rate:0})),creditWithInterestRates:Array.from({length:21},(l,v)=>({installments:v+1,rate:0}))},ra=({item:l,onSave:v,onClose:N,isSaving:m})=>{const[a,u]=s.useState({name:"",type:"cash",active:!0,config:ye});s.useEffect(()=>{l&&u({id:l.id,name:l.name||"",type:l.type||"cash",active:l.active!==void 0?l.active:!0,config:l.config?{debitRate:l.config.debitRate,creditNoInterestRates:d(l.config.creditNoInterestRates),creditWithInterestRates:d(l.config.creditWithInterestRates)}:ye})},[l]);const d=n=>{const x=new Map(n.map(j=>[j.installments,j])),o=[];for(let j=1;j<=21;j++)x.has(j)?o.push(x.get(j)):o.push({installments:j,rate:0});return o},h=n=>{const{name:x,value:o,type:j}=n.target;u(C=>({...C,[x]:j==="checkbox"?n.target.checked:x==="active"?o==="true":o}))},t=(n,x)=>{u(o=>({...o,config:{...o.config,[n]:x}}))},b=(n,x,o)=>{if(!a.config)return;const j=a.config[n].map(C=>C.installments===x?{...C,rate:o}:C);t(n,j)},i=n=>{n.preventDefault(),v(a)},f="w-full p-2 border rounded bg-transparent border-border focus:ring-2 focus:ring-primary/20 outline-none transition-all",p="block text-sm font-medium text-primary mb-1";return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-[70] p-4",children:e.jsxs("div",{className:"bg-surface rounded-lg shadow-xl w-full max-w-lg max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-5 w-5 text-primary"}),e.jsxs("h3",{className:"font-bold text-lg text-primary",children:[l?.id?"Editar":"Nova"," Forma de Pagamento"]})]}),e.jsx("button",{type:"button",onClick:N,children:e.jsx(Ce,{className:"h-6 w-6 text-muted hover:text-danger"})})]}),e.jsxs("form",{onSubmit:i,className:"flex-1 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 overflow-y-auto space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Nome:"}),e.jsx("input",{type:"text",name:"name",value:a.name||"",onChange:h,className:f,placeholder:"Ex: Cartão de Crédito",required:!0,autoFocus:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Status:"}),e.jsxs("select",{name:"active",value:a.active?"true":"false",onChange:n=>u(x=>({...x,active:n.target.value==="true"})),className:f,children:[e.jsx("option",{value:"true",children:"Ativo"}),e.jsx("option",{value:"false",children:"Inativo"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Tipo:"}),e.jsxs("select",{name:"type",value:a.type||"cash",onChange:h,className:f,children:[e.jsx("option",{value:"cash",children:"A vista / Geral"}),e.jsx("option",{value:"card",children:"Cartão"}),e.jsx("option",{value:"pending",children:"Valor Pendente"})]})]})]}),a.type==="card"&&a.config&&e.jsxs("div",{className:"mt-6 border-t border-border pt-4",children:[e.jsx("h4",{className:"font-bold text-base mb-3 text-primary",children:"Taxas da Maquininha"}),e.jsxs("div",{className:"space-y-3 bg-gray-50 p-4 rounded-lg border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 w-24",children:"Débito"}),e.jsx("div",{className:"w-32",children:e.jsx(je,{value:a.config.debitRate,onChange:n=>t("debitRate",n),className:`${f} text-right pr-8 bg-white`})})]}),e.jsx("div",{className:"border-t border-gray-200 my-2"}),e.jsx("p",{className:"text-xs text-muted font-medium uppercase tracking-wider mb-2",children:"Crédito (Com Juros)"}),a.config.creditWithInterestRates.map(n=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-sm text-gray-600 w-24",children:[n.installments,"x"]}),e.jsx("div",{className:"w-32",children:e.jsx(je,{value:n.rate,onChange:x=>b("creditWithInterestRates",n.installments,x),className:`${f} text-right pr-8 bg-white`})})]},n.installments))]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 border-t border-border flex justify-end gap-3",children:[e.jsx(B,{type:"button",onClick:N,variant:"secondary",children:"Cancelar"}),e.jsx(B,{type:"submit",variant:"primary",loading:m,icon:e.jsx(le,{className:"h-4 w-4"}),children:"Salvar"})]})]})]})})},Ne=()=>{const{showToast:l}=_(),{permissions:v,user:N}=W(),[m,a]=s.useState({}),[u,d]=s.useState(!0),h=Ks.useRef(null);s.useEffect(()=>{d(!0),Ye().then(C=>{a(C)}).finally(()=>d(!1))},[]);const t=v?.canManageCompanyData,b=C=>{if(C.target.files&&C.target.files[0]){const M=new FileReader;M.onloadend=()=>{a(c=>({...c,logoUrl:M.result})),l("Logo atualizada. Lembre-se de salvar as alterações.","info")},M.readAsDataURL(C.target.files[0])}},i=C=>{const{name:M,value:c}=C.target;a(M==="whatsapp"?r=>({...r,[M]:xe(c)}):r=>({...r,[M]:c}))},f=()=>{a(C=>({...C,cep:"",address:"",numero:"",complemento:"",bairro:"",city:"",state:""}))},[p,n]=s.useState(!1),x=async()=>{n(!0);try{await Cs(m),l("Dados da empresa salvos com sucesso!","success")}catch{l("Erro ao salvar os dados da empresa.","error")}finally{n(!1)}},o="w-full p-2 border rounded bg-transparent border-border focus:ring-success focus:border-success text-sm h-10 disabled:bg-gray-100",j="block text-sm font-medium text-primary mb-1";return u?e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx(Y,{})}):e.jsxs("div",{className:"bg-surface rounded-lg border border-border p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[e.jsxs("div",{className:"flex-1 space-y-6",children:[e.jsxs("div",{className:"p-4 border rounded-lg space-y-4",children:[e.jsx("h3",{className:"font-semibold text-primary",children:"Dados Principais"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:j,children:"Nome Fantasia"}),e.jsx("input",{name:"name",value:m.name||"",onChange:i,className:o,disabled:!t})]}),e.jsxs("div",{children:[e.jsx("label",{className:j,children:"Razão Social"}),e.jsx("input",{name:"razaoSocial",value:m.razaoSocial||"",onChange:i,className:o,disabled:!t})]}),e.jsxs("div",{children:[e.jsx("label",{className:j,children:"CNPJ / CPF"}),e.jsx("input",{name:"cnpj",value:m.cnpj||"",onChange:i,className:o,disabled:!t})]}),e.jsxs("div",{children:[e.jsx("label",{className:j,children:"Inscrição Estadual"}),e.jsx("input",{name:"inscricaoEstadual",value:m.inscricaoEstadual||"",onChange:i,className:o,disabled:!t})]})]})]}),e.jsxs("div",{className:"p-4 border rounded-lg space-y-4",children:[e.jsx("h3",{className:"font-semibold text-primary",children:"Contato"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:j,children:"WhatsApp"}),e.jsx("input",{name:"whatsapp",value:m.whatsapp||"",onChange:i,className:o,maxLength:15,disabled:!t})]}),e.jsxs("div",{children:[e.jsx("label",{className:j,children:"Email"}),e.jsx("input",{name:"email",type:"email",value:m.email||"",onChange:i,className:o,disabled:!t})]})]})]}),e.jsxs("div",{className:"p-4 border rounded-lg space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-semibold text-primary",children:"Endereço"}),t&&e.jsx("button",{onClick:f,className:"text-sm text-accent p-1 rounded-md hover:bg-accent-light",children:"Limpar"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{className:j,children:"CEP"}),e.jsx("input",{name:"cep",value:m.cep||"",onChange:i,className:o,disabled:!t})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{className:j,children:"Logradouro"}),e.jsx("input",{name:"address",value:m.address||"",onChange:i,className:o,disabled:!t})]}),e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{className:j,children:"Número"}),e.jsx("input",{name:"numero",value:m.numero||"",onChange:i,className:o,disabled:!t})]}),e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{className:j,children:"Complemento"}),e.jsx("input",{name:"complemento",value:m.complemento||"",onChange:i,className:o,disabled:!t})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:j,children:"Bairro"}),e.jsx("input",{name:"bairro",value:m.bairro||"",onChange:i,className:o,disabled:!t})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{className:j,children:"Cidade"}),e.jsx("input",{name:"city",value:m.city||"",onChange:i,className:o,disabled:!t})]}),e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{className:j,children:"UF"}),e.jsx("select",{name:"state",value:m.state||"",onChange:i,className:o,disabled:!t,children:e.jsx("option",{children:"PE"})})]})]})]})]}),e.jsx("div",{className:"w-full lg:w-52 flex-shrink-0",children:e.jsxs("div",{className:"p-4 border rounded-lg text-center sticky top-8",children:[e.jsx("h3",{className:"font-semibold text-primary mb-4",children:"Logo"}),e.jsx("input",{type:"file",ref:h,onChange:b,className:"hidden",accept:"image/*",disabled:!t}),e.jsxs("div",{className:"relative w-40 h-40 mx-auto",children:[m.logoUrl?e.jsx("img",{src:m.logoUrl,alt:m.name,className:"w-full h-full object-contain border border-border rounded-md p-2"}):e.jsx("div",{className:"w-full h-full border-2 border-dashed border-border rounded-md flex items-center justify-center text-center",children:e.jsx("span",{className:"text-muted text-sm",children:"Adicionar Logo"})}),t&&e.jsx("button",{type:"button",onClick:()=>h.current?.click(),className:"absolute -bottom-2 -right-2 bg-white p-2 rounded-full shadow-lg hover:bg-gray-100 transition-colors",title:"Adicionar ou alterar logo",children:e.jsx(H,{className:"w-5 h-5 text-primary"})})]}),m.logoUrl&&t&&e.jsx("button",{onClick:()=>a(C=>({...C,logoUrl:""})),className:"mt-4 text-sm text-danger hover:underline",children:"Remover Logo"})]})})]}),t&&e.jsx("div",{className:"flex justify-end pt-4 border-t mt-6",children:e.jsx(B,{onClick:x,variant:"success",loading:p,icon:e.jsx(le,{className:"h-5 w-5"}),children:"Salvar Alterações"})})]})},na=()=>{const[l,v]=s.useState([]),[N,m]=s.useState([]),[a,u]=s.useState([]),[d,h]=s.useState(!1),[t,b]=s.useState(null),[i,f]=s.useState(null),[p,n]=s.useState(null),[x,o]=s.useState(null),[j,C]=s.useState(!1),[M,c]=s.useState(null),r=s.useRef(null),[w,k]=s.useState(null),[P,S]=s.useState([]),[A,E]=s.useState([]),[L,R]=s.useState(!1),[G,U]=s.useState(null),[J,q]=s.useState(null),[y,O]=s.useState(null),{showToast:z}=_(),{user:I,permissions:Se}=W(),ie=Se?.canManageMarcasECategorias,X=s.useCallback(async()=>{h(!0),R(!0);try{const[g,D,T,K,ae]=await Promise.all([js(),ys(),Ns(),vs(),ws()]);v(g),m(D),u(T),S(K),E(ae)}catch{z("Erro ao carregar dados.","error")}finally{h(!1),R(!1)}},[z]);s.useEffect(()=>{X()},[X]);const Ee=s.useMemo(()=>N.filter(g=>g.brandId===t),[N,t]),ke=s.useMemo(()=>a.filter(g=>g.categoryId===i),[a,i]),Pe=s.useMemo(()=>A.filter(g=>g.gradeId===G),[A,G]),Ie=g=>{b(g),f(null)},de=(g,D=null)=>n({type:g,item:D}),Me=async(g,D)=>{h(!0);try{D.id?g==="brand"?await Os(D,I?.id,I?.name):g==="category"&&await Us(D,I?.id,I?.name):g==="brand"?await Ls(D,I?.id,I?.name):g==="category"&&await Gs({...D,brandId:t},I?.id,I?.name),z(`${g} salvo(a) com sucesso!`,"success"),X(),window.dispatchEvent(new Event("company-data-updated"));const T=new BroadcastChannel("app-updates");T.postMessage("company-data-updated"),T.close()}catch{z(`Erro ao salvar ${g}.`,"error")}finally{h(!1),n(null)}},Re=async()=>{if(x){h(!0);try{x.type==="brand"?await Bs(x.item.id,I?.id,I?.name):x.type==="category"?await zs(x.item.id,I?.id,I?.name):x.type==="model"&&await Fs(x.item.id,I?.id,I?.name),z(`${x.type} excluído(a) com sucesso!`,"success"),X(),window.dispatchEvent(new Event("company-data-updated"));const g=new BroadcastChannel("app-updates");g.postMessage("company-data-updated"),g.close()}catch{z(`Erro ao excluir ${x.type}.`,"error")}finally{h(!1),o(null)}}},he=g=>{c(g),C(!0)},Te=async g=>{h(!0);try{g.id?await be(g,I?.id,I?.name):await $s({...g,categoryId:i},I?.id,I?.name),z("Subcategoria salva com sucesso!","success"),X(),window.dispatchEvent(new Event("company-data-updated"));const D=new BroadcastChannel("app-updates");D.postMessage("company-data-updated"),D.close()}catch{z("Erro ao salvar subcategoria.","error")}finally{h(!1),C(!1),c(null)}},De=g=>{k(g),r.current?.click()},Ae=async g=>{if(g.target.files&&g.target.files[0]&&w){const D=g.target.files[0],T=new FileReader;T.onloadend=async()=>{const K=T.result,ae=a.find(Q=>Q.id===w);if(ae)try{h(!0),await be({...ae,imageUrl:K},I?.id,I?.name),z("Foto da subcategoria atualizada!","success"),await X(),window.dispatchEvent(new Event("company-data-updated"));const Q=new BroadcastChannel("app-updates");Q.postMessage("company-data-updated"),Q.close()}catch{z("Erro ao salvar a foto.","error")}finally{h(!1),k(null)}},T.readAsDataURL(D)}g.target&&(g.target.value="")},Oe=async(g,D)=>{R(!0);try{D.id?g==="grade"?await qs(D,I?.id,I?.name):await Vs(D,I?.id,I?.name):g==="grade"?await _s(D,I?.id,I?.name):await Ws({...D,gradeId:G},I?.id,I?.name),z(`${g} salvo com sucesso!`,"success"),X(),window.dispatchEvent(new Event("company-data-updated"));const T=new BroadcastChannel("app-updates");T.postMessage("company-data-updated"),T.close()}catch{z(`Erro ao salvar ${g}.`,"error")}finally{R(!1),q(null)}},Ue=async()=>{if(y){R(!0);try{y.type==="grade"?await Hs(y.item.id,I?.id,I?.name):await Js(y.item.id,I?.id,I?.name),z(`${y.type} excluído com sucesso!`,"success"),X(),window.dispatchEvent(new Event("company-data-updated"));const g=new BroadcastChannel("app-updates");g.postMessage("company-data-updated"),g.close()}catch{z(`Erro ao excluir ${y.type}.`,"error")}finally{R(!1),O(null)}}},te=(g,D,T,K,ae,Q,pe=!1)=>e.jsxs("div",{className:`border border-border rounded-lg ${pe?"bg-gray-50":""}`,children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-surface-secondary border-b border-border",children:[e.jsx("h3",{className:"font-semibold text-primary",children:g}),ie&&e.jsx("button",{onClick:Q,disabled:pe,className:"p-1 text-success disabled:text-muted",children:e.jsx(oe,{className:"h-5 w-5"})})]}),e.jsx("ul",{className:"p-2 space-y-1 h-64 overflow-y-auto",children:D.map(F=>e.jsxs("li",{onClick:()=>K&&K(F.id),className:`flex justify-between items-center p-2 rounded-md ${K?"cursor-pointer":""} ${ae===F.id?"bg-accent-light text-accent":K?"hover:bg-gray-100":""}`,children:[e.jsxs("div",{className:"flex items-center gap-3 flex-grow min-w-0",children:[T==="model"&&F.imageUrl?e.jsx("img",{src:F.imageUrl,alt:F.name,className:"h-8 w-8 rounded object-cover flex-shrink-0"}):T==="model"?e.jsx("div",{className:"h-8 w-8 rounded bg-gray-200 flex items-center justify-center flex-shrink-0",children:e.jsx(ue,{className:"h-4 w-4 text-gray-400"})}):null,e.jsx("span",{className:"truncate",children:F.name})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[T==="model"&&ie&&e.jsx("button",{onClick:re=>{re.stopPropagation(),De(F.id)},className:"text-muted hover:text-primary",children:e.jsx(ue,{className:"h-4 w-4"})}),ie&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:re=>{re.stopPropagation(),T.includes("grade")?q({type:T,item:F}):T==="model"?he(F):de(T,F)},className:"text-muted hover:text-primary",children:e.jsx(H,{className:"h-4 w-4"})}),e.jsx("button",{onClick:re=>{re.stopPropagation(),T.includes("grade")?O({type:T,item:F}):o({type:T,item:F})},className:"text-muted hover:text-danger",children:e.jsx(ee,{className:"h-4 w-4"})})]})]})]},F.id))})]});return e.jsxs("div",{className:"space-y-8",children:[e.jsx("input",{type:"file",ref:r,onChange:Ae,className:"hidden",accept:"image/*"}),e.jsxs("div",{className:"bg-surface rounded-lg border border-border p-6",children:[e.jsx("h3",{className:"font-semibold text-lg text-primary mb-4",children:"Marcas, Categorias e Subcategorias"}),d?e.jsx(Y,{}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[te("Marcas",l,"brand",Ie,t,()=>de("brand")),te("Categorias",Ee,"category",g=>f(g),i,()=>de("category"),!t),te("Subcategorias/Modelos",ke,"model",()=>{},null,()=>he(null),!i)]})]}),e.jsxs("div",{className:"bg-surface rounded-lg border border-border p-6",children:[e.jsx("h3",{className:"font-semibold text-lg text-primary mb-4",children:"Grades e Variações"}),L?e.jsx(Y,{}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[te("Grades (Ex: Cor, Armazenamento)",P,"grade",g=>U(g),G,()=>q({type:"grade",item:null})),te("Valores da Grade (Ex: Azul, 256GB)",Pe,"gradeValue",null,null,()=>q({type:"gradeValue",item:null}),!G)]})]}),p&&e.jsx(ve,{type:p.type,item:p.item,onSave:Me,onClose:()=>n(null),loading:d}),e.jsx(se,{isOpen:!!x,onClose:()=>o(null),onConfirm:Re,title:`Excluir ${x?.type}`,message:`Tem certeza que deseja excluir "${x?.item.name}"? A exclusão em cascata pode remover itens associados.`}),j&&e.jsx(aa,{item:M,brandName:l.find(g=>g.id===t)?.name||"",categoryName:N.find(g=>g.id===i)?.name||"",onSave:Te,onClose:()=>{C(!1),c(null)},isSaving:d}),J&&e.jsx(ve,{type:J.type,item:J.item,onSave:Oe,onClose:()=>q(null),loading:L}),e.jsx(se,{isOpen:!!y,onClose:()=>O(null),onConfirm:Ue,title:`Excluir ${y?.type}`,message:`Tem certeza que deseja excluir "${y?.item.name}"?`})]})},la=()=>{const[l,v]=s.useState([]),[N,m]=s.useState([]),[a,u]=s.useState([]),[d,h]=s.useState([]),[t,b]=s.useState(!0),i=s.useCallback(async()=>{b(!0);try{const[c,r,w,k]=await Promise.all([ss().catch(()=>[]),as().catch(()=>[]),ts().catch(()=>[]),rs().catch(()=>[])]);v(c||[]),m(r||[]),u(w||[]),h(k||[])}catch(c){console.error("AuditoriaTab fetch error:",c)}finally{b(!1)}},[]);s.useEffect(()=>{i()},[i]);const f=s.useMemo(()=>d.reduce((c,r)=>({...c,[r.id]:r}),{}),[d]),p=s.useMemo(()=>N.reduce((c,r)=>({...c,[r.id]:r}),{}),[N]),n=s.useMemo(()=>a.reduce((c,r)=>({...c,[r.id]:r}),{}),[a]),x=c=>{if(c.action===$.DELETE)return{Icon:ee,color:"text-red-600",bg:"bg-red-100"};if(c.action===$.CREATE)return{Icon:oe,color:"text-green-600",bg:"bg-green-100"};if(c.action===$.UPDATE)return{Icon:H,color:"text-blue-600",bg:"bg-blue-100"};if(c.action===$.LOGIN)return{Icon:ce,color:"text-green-600",bg:"bg-green-100"};if(c.action===$.LOGOUT)return{Icon:ce,color:"text-gray-600",bg:"bg-gray-100"};if(c.action===$.CASH_OPEN)return{Icon:ne,color:"text-green-600",bg:"bg-green-100"};if(c.action===$.CASH_CLOSE)return{Icon:ne,color:"text-red-600",bg:"bg-red-100"};if(c.action===$.CASH_WITHDRAWAL)return{Icon:ne,color:"text-orange-600",bg:"bg-orange-100"};if(c.action===$.CASH_SUPPLY)return{Icon:ne,color:"text-blue-600",bg:"bg-blue-100"};switch(c.entity){case Z.SALE:return c.action===$.SALE_CANCEL?{Icon:ks,color:"text-red-600",bg:"bg-red-100"}:{Icon:Ps,color:"text-purple-600",bg:"bg-purple-100"};case Z.PRODUCT:return c.action===$.STOCK_ADJUST?{Icon:V,color:"text-orange-600",bg:"bg-orange-100"}:c.action===$.STOCK_LAUNCH?{Icon:V,color:"text-teal-600",bg:"bg-teal-100"}:{Icon:V,color:"text-indigo-500",bg:"bg-indigo-100"};case Z.CUSTOMER:return{Icon:ce,color:"text-pink-500",bg:"bg-pink-100"};case Z.SUPPLIER:return{Icon:V,color:"text-cyan-500",bg:"bg-cyan-100"};default:return{Icon:ne,color:"text-gray-500",bg:"bg-gray-100"}}},o=c=>{if(!c.entityId)return null;if(c.entity===Z.SALE){const r=p[c.entityId];if(r&&r.items.length>0){const w=r.items[0],k=f[w.productId],P=k?k.model:"Produto desconhecido",S=r.items.length-1;return e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-sm text-gray-500 bg-gray-50 p-2 rounded border border-gray-100",children:[e.jsx(V,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:[P,S>0&&e.jsxs("span",{className:"text-xs ml-1 bg-gray-200 px-1.5 py-0.5 rounded-full",children:["+",S]})]})]})}}if(c.entity===Z.PRODUCT){const r=f[c.entityId];if(r)return e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-sm text-gray-500 bg-gray-50 p-2 rounded border border-gray-100",children:[e.jsx(V,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:r.model})]})}if(c.entity===Z.PURCHASE_ORDER){const r=n[c.entityId];if(r&&r.items.length>0){const k=r.items[0].productDetails.model,P=r.items.length-1;return e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-sm text-gray-500 bg-gray-50 p-2 rounded border border-gray-100",children:[e.jsx(V,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:[k,P>0&&e.jsxs("span",{className:"text-xs ml-1 bg-gray-200 px-1.5 py-0.5 rounded-full",children:["+",P]})]})]})}}return null},j=s.useMemo(()=>l.reduce((c,r)=>{const w=new Date(r.timestamp).toISOString().split("T")[0];return c[w]||(c[w]=[]),c[w].push(r),c},{}),[l]),C=s.useMemo(()=>Object.keys(j).sort((c,r)=>new Date(r).getTime()-new Date(c).getTime()),[j]),M=c=>{const r=new Date,w=new Date;w.setDate(r.getDate()-1);const k=new Date(c+"T00:00:00");return k.toDateString()===r.toDateString()?"Hoje":k.toDateString()===w.toDateString()?"Ontem":k.toLocaleDateString("pt-BR",{day:"numeric",month:"long",year:"numeric"})};return t?e.jsx("div",{className:"flex justify-center items-center h-full p-8",children:e.jsx(Y,{})}):e.jsx("div",{className:"bg-surface rounded-lg border border-border p-6",children:e.jsxs("div",{className:"relative pl-8",children:[e.jsx("div",{className:"absolute left-[23px] top-0 bottom-0 w-0.5 bg-gray-200"}),C.map(c=>e.jsxs("div",{children:[e.jsx("div",{className:"relative -ml-8 mb-6 mt-8 first:mt-0",children:e.jsx("div",{className:"bg-surface pr-4 inline-block relative z-10",children:e.jsx("h3",{className:"font-bold text-lg text-primary",children:M(c)})})}),j[c].map(r=>{const{Icon:w,color:k,bg:P}=x(r);return e.jsxs("div",{className:"relative mb-3 pl-2 group hover:bg-gray-50 rounded -ml-2 p-1 transition-colors",children:[e.jsx("div",{className:`absolute left-0 top-2 transform -translate-x-1/2 w-6 h-6 rounded-full flex items-center justify-center ${P} ring-4 ring-surface shadow-sm`,children:e.jsx(w,{className:`w-3.5 h-3.5 ${k}`})}),e.jsxs("div",{className:"ml-6",children:[e.jsxs("div",{className:"text-sm leading-snug flex flex-wrap items-baseline gap-1",children:[e.jsx("span",{className:"font-mono text-gray-400 text-xs tracking-tight",children:new Date(r.timestamp).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}),e.jsx("span",{className:"font-medium text-gray-800",children:(()=>{const S=r.details;if(S.includes("Alterações: {")||S.includes("Dados: {"))try{const A=S.includes("Alterações: {")?"Alterações: ":"Dados: ",[E,L]=S.split(A),R=JSON.parse(L);if(S.includes("payment_methods")){const U=R.name||(R.config?"Configuração":"Item");return E.includes("atualizado")?`Atualizado método: ${U}`:E.includes("criado")?`Novo método: ${U}`:E.includes("removido")?`Removido método: ${U}`:`Método de Pagamento: ${U}`}const G=Object.keys(R).filter(U=>U!=="id"&&U!=="_meta_type"&&U!=="_meta_active").join(", ");return`${E} ${G?`(${G})`:""}`}catch{return S}return S})()}),e.jsxs("span",{className:"text-xs text-gray-400 opacity-60 ml-auto sm:ml-0",children:["- ",r.userName]})]}),o(r)]})]},r.id)})]},c))]})})},me=({permissions:l,title:v,items:N,fields:m,api:a,fetchData:u})=>{const[d,h]=s.useState(!1),[t,b]=s.useState(null),[i,f]=s.useState(null),{showToast:p}=_(),{user:n}=W(),x=(r=null)=>{b(r||{}),h(!0)},[o,j]=s.useState(!1),C=async r=>{j(!0);try{"id"in r&&r.id?(await a.update(r,n?.id,n?.name),p("Item atualizado com sucesso!","success")):(await a.add(r,n?.id,n?.name),p("Item adicionado com sucesso!","success")),u(),h(!1),b(null)}catch{p("Erro ao salvar item.","error")}finally{j(!1)}},M=async()=>{if(i)try{await a.del(i.id,n?.id,n?.name),p("Item excluído com sucesso!","success"),u(),f(null)}catch{p("Erro ao excluir item.","error")}},c=({item:r,onSave:w,onClose:k,isSaving:P})=>{const[S,A]=s.useState(r||{}),E=R=>{const{name:G,value:U,type:J}=R.target;A(q=>({...q,[G]:J==="number"?Number(U):U}))},L=R=>{R.preventDefault(),w(S)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50",children:e.jsxs("form",{onSubmit:L,className:"bg-surface rounded-lg shadow-xl p-6 w-full max-w-sm",children:[e.jsxs("h3",{className:"font-bold text-lg mb-4",children:[r?.id?"Editar":"Novo"," Item"]}),m.map(R=>e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:R.label}),e.jsx("input",{type:R.type,name:String(R.name),value:S[R.name]||(R.type==="number",""),onChange:E,className:"w-full p-2 border rounded bg-transparent border-border",required:!0})]},String(R.name))),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(B,{type:"button",onClick:k,variant:"secondary",children:"Cancelar"}),e.jsx(B,{type:"submit",variant:"success",loading:P,children:"Salvar"})]})]})})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center bg-gray-100 p-4 rounded-t-lg",children:[e.jsx("div",{children:e.jsx("h4",{className:"text-lg font-semibold text-primary",children:v})}),l?.canManageCompanyData&&e.jsx("button",{onClick:()=>x(),className:"p-2 bg-gray-300 rounded-full hover:bg-gray-400",children:e.jsx(oe,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"border border-gray-200 rounded-b-lg",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[m.map(r=>e.jsx("th",{className:"p-3 font-semibold text-left",children:r.label},String(r.name))),e.jsx("th",{className:"p-3 font-semibold text-right",children:"Ações"})]})}),e.jsx("tbody",{children:N.map(r=>e.jsxs("tr",{className:"border-t",children:[m.map(w=>e.jsx("td",{className:"p-3",children:r[w.name]},String(w.name))),e.jsx("td",{className:"p-3",children:e.jsx("div",{className:"flex justify-end items-center gap-2",children:l?.canManageCompanyData&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>x(r),children:e.jsx(H,{className:"h-5 w-5 text-muted hover:text-primary"})}),e.jsx("button",{onClick:()=>f(r),children:e.jsx(ee,{className:"h-5 w-5 text-muted hover:text-danger"})})]})})})]},r.id))})]})}),d&&e.jsx(c,{item:t,onSave:C,onClose:()=>{h(!1),b(null)},isSaving:o}),e.jsx(se,{isOpen:!!i,onClose:()=>f(null),onConfirm:M,title:`Excluir ${i?.name}`,message:"Tem certeza que deseja excluir este item?"})]})},oa=()=>{const{showToast:l}=_(),{user:v}=W(),[N,m]=s.useState(!1),[a,u]=s.useState(!1),d=s.useRef(null),h=async()=>{m(!0);try{const i=await Ss(),f=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),p=URL.createObjectURL(f),n=document.createElement("a"),x=new Date().toISOString().split("T")[0];n.href=p,n.download=`istore_backup_${x}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(p),l("Backup realizado com sucesso!","success")}catch(i){console.error(i),l("Erro ao realizar backup.","error")}finally{m(!1)}},t=()=>{d.current?.click()},b=async i=>{const f=i.target.files?.[0];if(!f)return;if(!window.confirm("ATENÇÃO: Restaurar um backup irá SUBSTITUIR todos os dados atuais do sistema. Esta ação não pode ser desfeita. Deseja continuar?")){i.target.value="";return}u(!0);try{const n=new FileReader;n.onload=async x=>{try{const o=JSON.parse(x.target?.result);await Es(o,v?.id||"system",v?.name||"Sistema"),l("Dados restaurados com sucesso! A página será recarregada.","success"),setTimeout(()=>window.location.reload(),2e3)}catch(o){console.error(o),l(o.message||"Erro ao processar arquivo de backup.","error"),u(!1)}},n.readAsText(f)}catch(n){console.error(n),l("Erro ao ler arquivo.","error"),u(!1)}};return e.jsx("div",{className:"bg-surface rounded-lg border border-border p-8 space-y-8",children:e.jsxs("div",{className:"max-w-2xl",children:[e.jsx("h3",{className:"text-xl font-bold text-primary mb-2",children:"Backup e Restauração"}),e.jsx("p",{className:"text-muted text-sm mb-6",children:"Gerencie a segurança dos seus dados. Você pode exportar todas as informações do sistema para um arquivo em seu computador ou restaurar o sistema a partir de um backup anterior."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"p-6 border border-border rounded-xl bg-gray-50 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-primary mb-2",children:[e.jsx(V,{className:"h-6 w-6"}),e.jsx("h4",{className:"font-bold",children:"Realizar Backup"})]}),e.jsx("p",{className:"text-xs text-muted leading-relaxed",children:"Gera um arquivo .json contendo todos os produtos, vendas, clientes, fornecedores e configurações. Recomendado fazer diariamente."}),e.jsx("button",{onClick:h,disabled:N||a,className:"w-full flex items-center justify-center gap-2 py-3 bg-primary text-white font-semibold rounded-lg hover:bg-opacity-90 disabled:opacity-50 transition-all",children:N?e.jsx(Y,{className:"h-5 w-5"}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-5 w-5"})," Baixar Backup"]})})]}),e.jsxs("div",{className:"p-6 border border-border rounded-xl bg-orange-50 border-orange-100 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-orange-700 mb-2",children:[e.jsx(ge,{className:"h-6 w-6"}),e.jsx("h4",{className:"font-bold",children:"Restaurar Dados"})]}),e.jsxs("p",{className:"text-xs text-orange-600 leading-relaxed font-medium",children:[e.jsxs("span",{className:"flex items-center gap-1 text-orange-800 font-bold mb-1",children:[e.jsx(Ze,{className:"h-4 w-4"})," AVISO CRÍTICO"]}),"Isso apagará todos os dados atuais e os substituirá pelas informações do arquivo de backup."]}),e.jsx("input",{type:"file",ref:d,onChange:b,accept:".json",className:"hidden"}),e.jsx("button",{onClick:t,disabled:N||a,className:"w-full flex items-center justify-center gap-2 py-3 bg-orange-600 text-white font-semibold rounded-lg hover:bg-orange-700 disabled:opacity-50 transition-all shadow-sm",children:a?e.jsx(Y,{className:"h-5 w-5"}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"h-5 w-5"})," Importar e Restaurar"]})})]})]}),e.jsxs("div",{className:"mt-8 p-4 bg-blue-50 border border-blue-100 rounded-lg flex items-start gap-3",children:[e.jsx(es,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-xs text-blue-800 space-y-1",children:[e.jsx("p",{className:"font-bold",children:"Informações Importantes:"}),e.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[e.jsx("li",{children:"O arquivo de backup é criptografado apenas se o seu sistema de arquivos o for."}),e.jsx("li",{children:"Não altere o nome das tabelas dentro do arquivo JSON."}),e.jsx("li",{children:"A restauração pode levar alguns segundos dependendo do volume de dados."}),e.jsx("li",{children:"Após a restauração, o sistema será reiniciado automaticamente."})]})]})]})]})})},ca=()=>{const[l,v]=s.useState("condicao"),[N,m]=s.useState([]),[a,u]=s.useState([]),[d,h]=s.useState([]),[t,b]=s.useState([]),[i,f]=s.useState(!1),[p,n]=s.useState(null),[x,o]=s.useState(null),{showToast:j}=_(),{permissions:C,user:M}=W(),c=s.useCallback(async()=>{const[E,L,R,G]=await Promise.all([ls(),os(),cs(),is()]);m(E),u(L),h(R),b(G)},[]);s.useEffect(()=>{c()},[c]);const r=(E=null)=>{n(E||{}),f(!0)},[w,k]=s.useState(!1),P=async E=>{k(!0);try{E.id?(await Ts(E,M?.id,M?.name),j("Termo atualizado!","success")):(await Ds(E,M?.id,M?.name),j("Termo adicionado!","success")),c(),f(!1),n(null)}catch{j("Erro ao salvar termo.","error")}finally{k(!1)}},S=async()=>{if(x)try{await As(x.id,M?.id,M?.name),j("Termo excluído!","success"),c(),o(null)}catch(E){j(E.message||"Erro ao excluir.","error")}},A=E=>`px-3 py-1 rounded-md text-sm font-medium ${l===E?"bg-primary text-white":"hover:bg-gray-200"}`;return e.jsxs("div",{className:"bg-surface rounded-lg border border-border p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("button",{onClick:()=>v("condicao"),className:A("condicao"),children:"Condição"}),e.jsx("button",{onClick:()=>v("local"),className:A("local"),children:"Local de estoque"}),e.jsx("button",{onClick:()=>v("garantia"),className:A("garantia"),children:"Garantia"}),e.jsx("button",{onClick:()=>v("termos"),className:A("termos"),children:"Termos de Garantia"})]}),l==="condicao"&&e.jsx(me,{permissions:C,title:"Condições de Produto",items:N,fields:[{name:"name",label:"Nome",type:"text"}],api:{add:us,update:ms,del:ds},fetchData:c}),l==="local"&&e.jsx(me,{permissions:C,title:"Locais de Estoque",items:a,fields:[{name:"name",label:"Nome",type:"text"}],api:{add:ps,update:hs,del:xs},fetchData:c}),l==="garantia"&&e.jsx(me,{permissions:C,title:"Garantias",items:d,fields:[{name:"name",label:"Nome",type:"text"},{name:"days",label:"Dias",type:"number"}],api:{add:fs,update:bs,del:gs},fetchData:c}),l==="termos"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center bg-gray-100 p-4 rounded-t-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-primary",children:"Termos de Garantia"}),e.jsx("p",{className:"text-sm text-muted",children:"Crie termos personalizados para cada tipo de situação. Ex: Termos para vendas de Apple, Xiaomi, etc."})]}),C?.canManageCompanyData&&e.jsx("button",{onClick:()=>r(),className:"p-2 bg-gray-300 rounded-full hover:bg-gray-400",children:e.jsx(oe,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"border border-gray-200 rounded-b-lg",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 font-semibold text-left",children:"Nome"}),e.jsx("th",{className:"p-3 font-semibold text-right",children:"Ações"})]})}),e.jsx("tbody",{children:t.map(E=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-3",children:E.name}),e.jsx("td",{className:"p-3",children:e.jsx("div",{className:"flex justify-end items-center gap-2",children:C?.canManageCompanyData&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>r(E),children:e.jsx(H,{className:"h-5 w-5 text-muted hover:text-primary"})}),E.name!=="Padrão"&&e.jsx("button",{onClick:()=>o(E),children:e.jsx(ee,{className:"h-5 w-5 text-muted hover:text-danger"})})]})})})]},E.id))})]})})]}),i&&e.jsx(ta,{item:p,onClose:()=>{f(!1),n(null)},onSave:P,isSaving:w}),e.jsx(se,{isOpen:!!x,onClose:()=>o(null),onConfirm:S,title:"Excluir Termo",message:`Deseja excluir o termo "${x?.name}"?`})]})},ia=()=>{const[l,v]=s.useState([]),[N,m]=s.useState(null),[a,u]=s.useState(null),{showToast:d}=_(),{permissions:h,user:t}=W(),b=s.useCallback(async()=>{v(await ns())},[]);s.useEffect(()=>{b()},[b]);const i=o=>{m(o)},[f,p]=s.useState(!1),n=async o=>{p(!0);try{o.id?(await Is(o,t?.id,t?.name),d("Atualizado!","success")):(await Ms(o,t?.id,t?.name),d("Adicionado!","success")),b(),m(null)}catch{d("Erro ao salvar.","error")}finally{p(!1)}},x=async()=>{if(a)try{await Rs(a.id,t?.id,t?.name),d("Excluído!","success"),b(),u(null)}catch{d("Erro ao excluir.","error")}};return e.jsxs("div",{className:"bg-surface rounded-lg border border-border p-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("div",{children:e.jsx("h4",{className:"text-xl font-bold text-primary",children:"Meios de Pagamentos"})}),h?.canManageCompanyData&&e.jsx("button",{onClick:()=>m({active:!0,type:"cash"}),className:"px-4 py-2 bg-gray-700 text-white text-sm font-medium rounded-md hover:bg-gray-800 flex items-center gap-2",children:"Cadastrar"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 text-xs uppercase font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 border-b border-gray-200",children:"ID"}),e.jsx("th",{className:"px-6 py-3 border-b border-gray-200 w-full",children:"Nome"}),e.jsx("th",{className:"px-6 py-3 border-b border-gray-200",children:"Tipo"}),e.jsx("th",{className:"px-6 py-3 border-b border-gray-200",children:"Status"}),h?.canManageCompanyData&&e.jsx("th",{className:"px-6 py-3 border-b border-gray-200 text-right",children:"Ações"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:l.map(o=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4 text-sm text-gray-500",children:[o.id.substring(0,4),"..."]}),e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-900",children:o.name}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:o.type==="card"?"Cartão":"Geral"}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${o.active!==!1?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:o.active!==!1?"ativo":"inativo"})}),h?.canManageCompanyData&&e.jsxs("td",{className:"px-6 py-4 text-right flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>i(o),className:"p-1.5 text-gray-500 border border-gray-300 rounded hover:bg-gray-50 hover:text-primary transition-colors",title:"Editar",children:e.jsx(H,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>u(o),className:"p-1.5 text-gray-500 border border-gray-300 rounded hover:bg-gray-50 hover:text-danger transition-colors",title:"Excluir",children:e.jsx(ee,{className:"h-4 w-4"})})]})]},o.id))})]}),l.length===0&&e.jsx("div",{className:"p-8 text-center text-muted",children:"Nenhum meio de pagamento cadastrado."})]}),N&&e.jsx(ra,{item:N,onClose:()=>m(null),onSave:n,isSaving:f}),e.jsx(se,{isOpen:!!a,onClose:()=>u(null),onConfirm:x,title:"Excluir",message:`Deseja excluir "${a?.name}"?`})]})},da=()=>{const{user:l,refreshPermissions:v,loading:N,permissions:m}=W(),[a,u]=s.useState({}),d=s.useRef(null),{showToast:h}=_(),[t,b]=s.useState(!1),[i,f]=s.useState(!1),p=s.useRef(null),n=s.useRef(null);s.useEffect(()=>{const P=S=>{i&&p.current&&!p.current.contains(S.target)&&n.current&&!n.current.contains(S.target)&&f(!1)};return document.addEventListener("mousedown",P),()=>{document.removeEventListener("mousedown",P)}},[i]),s.useEffect(()=>{l&&u(l)},[l]);const x=P=>{const{name:S,value:A}=P.target;u(E=>({...E,[S]:A}))},o=P=>{const{name:S,value:A}=P.target;u(E=>({...E,address:{...E.address||{},[S]:A}}))},j=P=>{if(P.target.files&&P.target.files[0]){const S=new FileReader;S.onloadend=()=>{const A=S.result;u(E=>({...E,avatarUrl:A})),h("Foto atualizada. Lembre-se de salvar as alterações.","info")},S.readAsDataURL(P.target.files[0])}},[C,M]=s.useState(!1),c=async()=>{if(!l)return;const{currentPassword:P,newPassword:S,confirmPassword:A,...E}=a;if(S&&S!==A){h("As novas senhas não coincidem.","error");return}M(!0);try{const L={...E};S&&(L.password=S),await we({...l,...L}),v(),h("Perfil atualizado com sucesso!","success"),u(R=>{const{currentPassword:G,newPassword:U,confirmPassword:J,...q}=R;return q})}catch{h("Erro ao atualizar o perfil.","error")}finally{M(!1)}};if(N)return e.jsx(Y,{});const r=m?.canEditOwnProfile,w=`w-full p-2 border rounded bg-transparent border-border focus:ring-success focus:border-success text-sm h-10 ${r?"":"bg-gray-100 opacity-70 cursor-not-allowed"}`,k="block text-sm font-medium text-primary mb-1";return e.jsxs("div",{children:[e.jsxs("div",{className:"bg-surface rounded-lg border border-border p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[e.jsx("div",{className:"w-full lg:w-52 flex-shrink-0",children:e.jsxs("div",{className:"p-4 border rounded-lg text-center sticky top-8",children:[e.jsx("h3",{className:"font-semibold text-primary mb-4",children:"Foto de Perfil"}),e.jsx("input",{type:"file",ref:d,onChange:j,className:"hidden",accept:"image/*"}),e.jsxs("div",{className:"relative w-40 h-40 mx-auto",children:[e.jsx("div",{className:"w-full h-full rounded-full bg-gray-200 flex items-center justify-center overflow-hidden",children:a.avatarUrl?e.jsx("img",{src:a.avatarUrl,alt:"User Avatar",className:"w-full h-full object-cover"}):e.jsx(ce,{className:"w-32 h-32 text-gray-400"})}),e.jsx("button",{ref:n,type:"button",onClick:()=>f(P=>!P),className:"absolute -bottom-2 -right-2 bg-white p-2 rounded-full shadow-lg hover:bg-gray-100",title:"Alterar foto",children:e.jsx(H,{className:"w-5 h-5 text-primary"})}),i&&r&&e.jsxs("div",{ref:p,className:"absolute bottom-0 right-10 mb-2 w-40 bg-white rounded-md shadow-lg border border-border z-10",children:[e.jsxs("button",{type:"button",onClick:()=>{d.current?.click(),f(!1)},className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-left hover:bg-gray-100",children:[e.jsx(ue,{className:"h-4 w-4"}),"Enviar foto"]}),e.jsxs("button",{type:"button",onClick:()=>{b(!0),f(!1)},className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-left hover:bg-gray-100",children:[e.jsx(Qe,{className:"h-4 w-4"}),"Tirar foto"]})]})]}),a.avatarUrl&&e.jsx("button",{onClick:()=>{u(P=>({...P,avatarUrl:void 0})),d.current&&(d.current.value="")},className:"mt-4 text-sm text-danger hover:underline",children:"Remover Foto"})]})}),e.jsxs("div",{className:"flex-1 space-y-6",children:[e.jsxs("div",{className:"p-4 border rounded-lg space-y-4",children:[e.jsx("h3",{className:"font-semibold text-primary",children:"Dados Pessoais"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:k,children:"Nome"}),e.jsx("input",{name:"name",value:a.name||"",onChange:x,className:w,disabled:!r})]}),e.jsxs("div",{children:[e.jsx("label",{className:k,children:"Email"}),e.jsx("input",{name:"email",type:"email",value:a.email||"",onChange:x,className:w,disabled:!r})]})]})]}),e.jsxs("div",{className:"p-4 border rounded-lg space-y-4",children:[e.jsx("h3",{className:"font-semibold text-primary",children:"Endereço"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{className:k,children:"CEP"}),e.jsx("input",{name:"zip",value:a.address?.zip||"",onChange:o,className:w,disabled:!r})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{className:k,children:"Logradouro"}),e.jsx("input",{name:"street",value:a.address?.street||"",onChange:o,className:w,disabled:!r})]}),e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{className:k,children:"Número"}),e.jsx("input",{name:"number",value:a.address?.number||"",onChange:o,className:w,disabled:!r})]}),e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{className:k,children:"Complemento"}),e.jsx("input",{name:"complement",value:a.address?.complement||"",onChange:o,className:w,disabled:!r})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:k,children:"Bairro"}),e.jsx("input",{name:"neighborhood",value:a.address?.neighborhood||"",onChange:o,className:w,disabled:!r})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{className:k,children:"Cidade"}),e.jsx("input",{name:"city",value:a.address?.city||"",onChange:o,className:w,disabled:!r})]}),e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx("label",{className:k,children:"UF"}),e.jsx("input",{name:"state",value:a.address?.state||"",onChange:o,className:w,disabled:!r})]})]})]}),e.jsxs("div",{className:"p-4 border rounded-lg space-y-4",children:[e.jsx("h3",{className:"font-semibold text-primary",children:"Alterar Senha"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:k,children:"Senha Atual"}),e.jsx("input",{name:"currentPassword",type:"password",onChange:x,value:a.currentPassword||"",className:w,placeholder:"••••••••",disabled:!r})]}),e.jsxs("div",{children:[e.jsx("label",{className:k,children:"Nova Senha"}),e.jsx("input",{name:"newPassword",type:"password",onChange:x,value:a.newPassword||"",className:w,placeholder:"••••••••",disabled:!r})]}),e.jsxs("div",{children:[e.jsx("label",{className:k,children:"Confirmar Nova Senha"}),e.jsx("input",{name:"confirmPassword",type:"password",onChange:x,value:a.confirmPassword||"",className:w,placeholder:"••••••••",disabled:!r})]})]})]})]})]}),r&&e.jsx("div",{className:"flex justify-end pt-4 border-t mt-6",children:e.jsx(B,{onClick:c,variant:"success",loading:C,icon:e.jsx(le,{className:"h-5 w-5"}),children:"Salvar Alterações"})})]}),e.jsx(Ys,{isOpen:t,onClose:()=>b(!1),onCapture:P=>{u(S=>({...S,avatarUrl:P})),b(!1)}})]})},ga=()=>{const[l,v]=Xs(),{permissions:N,user:m}=W(),a=l.get("tab")||"dados",u=s.useMemo(()=>[{id:"dados",label:"Dados da Empresa",permission:"canManageCompanyData"},{id:"usuarios",label:"Usuários e Permissões",permission:"canManageUsers"},{id:"marcas",label:"Marcas e Categorias",permission:"canManageMarcasECategorias"},{id:"perfil",label:"Perfil",permission:"canEditOwnProfile"},{id:"parametros",label:"Parâmetros",permission:"canManageCompanyData"},{id:"meios_pagamento",label:"Meios de Pagamento",permission:"canManageCompanyData"},{id:"auditoria",label:"Auditoria",permission:"canViewAudit"},{id:"backup",label:"Backup e Restauração",permission:"canManageCompanyData"}],[]),d=s.useMemo(()=>N?u.filter(t=>t.permission===!0?!0:t.id==="usuarios"?N.canManageUsers||N.canManagePermissions:N[t.permission]):u.filter(t=>t.id==="perfil"),[N,u]);s.useEffect(()=>{d.length>0&&!d.find(t=>t.id===a)&&v({tab:d[0].id})},[d,a,v]);const h=()=>{if(!d.find(b=>b.id===a))return e.jsx("div",{className:"text-center p-8 text-muted",children:"Acesso negado."});let t;switch(a){case"dados":t=e.jsx(Ne,{});break;case"usuarios":t=e.jsx(ea,{});break;case"marcas":t=e.jsx(na,{});break;case"parametros":t=e.jsx(ca,{});break;case"meios_pagamento":t=e.jsx(ia,{});break;case"auditoria":t=e.jsx(la,{});break;case"backup":t=e.jsx(oa,{});break;case"perfil":t=e.jsx(da,{});break;default:t=e.jsx(Ne,{});break}return a==="usuarios"?t:e.jsx("div",{className:"max-w-5xl",children:t})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-primary",children:"Empresa"}),e.jsx("div",{className:"flex items-center gap-1 bg-surface-secondary p-1 rounded-lg overflow-x-auto",children:d.map(t=>e.jsx("button",{onClick:()=>v({tab:t.id}),className:`px-3 py-1.5 rounded-md text-sm font-medium whitespace-nowrap transition-colors flex-shrink-0 ${a===t.id?"bg-primary text-white shadow-sm":"text-muted hover:text-primary"}`,children:t.label},t.id))}),h()]})},ve=({type:l,item:v,onSave:N,onClose:m,loading:a})=>{const[u,d]=s.useState(v?.name||""),h=t=>{t.preventDefault(),N(l,{...v,name:u})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50",children:e.jsxs("form",{onSubmit:h,className:"bg-surface rounded-lg shadow-xl p-6 w-full max-w-sm",children:[e.jsxs("h3",{className:"font-bold text-lg mb-4",children:[v?.id?"Editar":"Adicionar"," ",l==="gradeValue"?"Valor da Grade":l]}),e.jsx("input",{type:"text",value:u,onChange:t=>d(t.target.value),className:"w-full p-2 border rounded bg-transparent border-border mb-4",autoFocus:!0,required:!0}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(B,{type:"button",onClick:m,variant:"secondary",children:"Cancelar"}),e.jsx(B,{type:"submit",variant:"success",loading:a,children:"Salvar"})]})]})})};export{ga as default};
