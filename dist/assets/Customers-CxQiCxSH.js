import{j as e,a1 as $e,f as v,E as Ue,u as ze,i as Ye,a as qe,g as We,m as Je,l as Ge,k as Ke,b as Qe,S as q,h as ie,v as Xe,a2 as Ze,a3 as me,a4 as _e,P as xe,a5 as pe,a6 as ue,z as he,F as fe,a7 as es,a8 as ss,a9 as ts,N as as,aa as rs,ab as ns,ac as ls,ad as os}from"./index-BMA--0RW.js";import{r as t}from"./react-vendor-Bv8thS0I.js";import{C as be}from"./ConfirmationModal-CVAza7gk.js";import{C as cs}from"./CustomerModal-Cs-UW485.js";import{P as ds}from"./PurchaseOrderDetailModal-B9r54sPu.js";import{S as is}from"./SaleDetailModal-DuxgAQqk.js";import"./supabase-C1Qlw3jS.js";import"./Button-wK47DqCu.js";const ms=o=>new Date(o).toLocaleString("pt-BR",{dateStyle:"short",timeStyle:"short"}),xs={Lançado:"bg-green-100 text-green-600",Pendente:"bg-orange-100 text-orange-600","Parcialmente Lançado":"bg-yellow-100 text-yellow-600"},ps={Pago:"bg-green-100 text-green-600",Pendente:"bg-orange-100 text-orange-600"},us=({supplier:o,purchases:u,onClose:l,users:d=[],products:x=[]})=>{const[m,f]=t.useState(null),h=r=>{if(!r)return"Sistema";const i=d.find(j=>j.id===r);if(i)return i.name;const p=d.find(j=>j.name===r);if(p)return p.name;if(r==="Admin User"){const j=d.find(y=>y.permissionProfileId==="profile-admin");return j?j.name:"Administrador"}return r},a=t.useMemo(()=>m?x.filter(r=>r.purchaseOrderId===m.id):[],[m,x]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4",children:e.jsxs("div",{className:"bg-surface rounded-lg shadow-xl w-full max-w-5xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[e.jsxs("h2",{className:"text-2xl font-bold text-primary",children:["Histórico de Compras - ",o.name]}),e.jsx("button",{onClick:l,className:"p-1 text-muted hover:text-danger",children:e.jsx($e,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"p-6 flex-1 overflow-y-auto",children:u.length===0?e.jsx("p",{className:"text-muted text-center py-8",children:"Nenhuma compra encontrada para este fornecedor."}):e.jsx("div",{className:"border border-border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left text-muted",children:[e.jsx("thead",{className:"text-xs text-secondary uppercase bg-surface-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-3",children:"ID"}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:"Localizador"}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:"Data"}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:"Responsável"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-right",children:"Total"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-center",children:"Estoque"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-center",children:"Financeiro"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-center",children:"Ações"})]})}),e.jsx("tbody",{children:u.map(r=>e.jsxs("tr",{className:"bg-surface border-b border-border last:border-b-0 hover:bg-surface-secondary",children:[e.jsxs("td",{className:"px-4 py-3 font-medium text-primary",children:["#",r.displayId]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-mono text-xs bg-gray-100 px-2 py-1 rounded",children:r.locatorId||"-"})}),e.jsx("td",{className:"px-4 py-3 text-xs",children:ms(r.purchaseDate)}),e.jsx("td",{className:"px-4 py-3 text-xs",children:h(r.createdBy)}),e.jsx("td",{className:"px-4 py-3 text-right font-semibold text-primary",children:v(r.total)}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${xs[r.stockStatus]}`,children:r.stockStatus})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${ps[r.financialStatus]}`,children:r.financialStatus})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("button",{onClick:()=>f(r),className:"p-1.5 text-secondary hover:text-primary hover:bg-gray-100 rounded-md transition-colors",title:"Ver detalhes da compra",children:e.jsx(Ue,{className:"w-5 h-5"})})})]},r.id))})]})})}),e.jsx("div",{className:"flex justify-end items-center p-4 border-t border-border mt-auto",children:e.jsx("button",{onClick:l,className:"px-6 py-2 bg-danger text-white rounded-md hover:bg-danger/90",children:"Fechar"})})]})}),m&&e.jsx(ds,{purchase:m,onClose:()=>f(null),associatedProducts:a})]})},hs=({customer:o,sales:u,users:l,onClose:d,productMap:x,onViewSale:m})=>{const[f,h]=t.useState("purchases");return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-surface rounded-lg shadow-xl p-8 w-full max-w-3xl mx-4",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 text-primary",children:["Histórico de ",o.name]}),(()=>{const a=u.reduce((i,p)=>{if(p.status==="Cancelada")return i;const j=p.payments.filter(y=>y.type==="pending").reduce((y,D)=>y+D.value,0);if(j>0){const y=l.find(D=>D.id===p.salespersonId)?.name||"Desconhecido";i.push({id:p.cashSessionDisplayId?`${p.cashSessionDisplayId}`:p.id.substring(0,8),fullId:p.id,date:p.date,amount:j,salesperson:y})}return i},[]),r=a.reduce((i,p)=>i+p.amount,0);return r>0?e.jsxs("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"p-4 flex items-center justify-between border-b border-red-200 bg-red-100/30",children:[e.jsxs("span",{className:"text-red-800 font-bold flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-red-600"}),"Valor em Aberto (Dívida)"]}),e.jsx("span",{className:"text-xl font-black text-red-700",children:v(r)})]}),e.jsx("div",{className:"max-h-40 overflow-y-auto custom-scrollbar bg-white/50",children:a.map((i,p)=>e.jsxs("div",{className:"flex justify-between items-start p-3 border-b border-red-100 last:border-0 hover:bg-red-50 transition-colors",children:[e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsxs("span",{className:"font-bold text-red-900 text-sm",children:["Venda #",i.id]}),e.jsxs("span",{className:"text-red-700 text-xs flex flex-col sm:flex-row sm:gap-2",children:[e.jsxs("span",{children:[new Date(i.date).toLocaleDateString("pt-BR")," às ",new Date(i.date).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]}),e.jsx("span",{className:"hidden sm:inline text-red-300",children:"•"}),e.jsxs("span",{children:["Vend: ",e.jsx("span",{className:"font-semibold",children:i.salesperson})]})]})]}),e.jsx("span",{className:"font-bold text-red-700 text-sm whitespace-nowrap",children:v(i.amount)})]},p))})]}):null})(),e.jsx("div",{className:"border-b border-border mb-4",children:e.jsxs("nav",{className:"-mb-px flex space-x-6",children:[e.jsx("button",{onClick:()=>h("purchases"),className:`py-2 px-1 border-b-2 text-sm font-medium ${f==="purchases"?"border-primary text-primary":"border-transparent text-muted hover:text-primary"}`,children:"Compras"}),e.jsx("button",{onClick:()=>h("tradeins"),className:`py-2 px-1 border-b-2 text-sm font-medium ${f==="tradeins"?"border-primary text-primary":"border-transparent text-muted hover:text-primary"}`,children:"Trocas / Vendas para Loja"})]})}),e.jsxs("div",{className:"max-h-96 overflow-y-auto",children:[f==="purchases"&&(u.length===0?e.jsx("p",{className:"text-muted",children:"Nenhuma compra encontrada."}):e.jsx("ul",{className:"space-y-4",children:u.map(a=>e.jsx("li",{className:"border border-border p-4 rounded-md bg-surface-secondary",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-4 font-semibold text-sm",children:[e.jsxs("span",{className:"text-primary",children:["Data: ",new Date(a.date).toLocaleString("pt-BR")]}),e.jsxs("span",{className:"text-success",children:["Total: ",v(a.total)]})]}),e.jsx("ul",{className:"mt-2 text-sm text-muted",children:a.items.map((r,i)=>e.jsxs("li",{children:["- ",x[r.productId]?.model||"Produto desconhecido"," (x",r.quantity,")"]},i))}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-border/50 text-xs text-muted",children:[e.jsx("span",{className:"font-semibold",children:"Pagamento: "}),a.payments.map(r=>`${r.method} (${v(r.value)})`).join(", ")]})]}),e.jsx("button",{onClick:()=>m(a),className:"px-3 py-1 bg-gray-200 text-secondary text-xs font-semibold rounded-md hover:bg-gray-300",children:"Ver"})]})},a.id))})),f==="tradeins"&&(!o.tradeInHistory||o.tradeInHistory.length===0?e.jsx("p",{className:"text-muted text-center py-8",children:"Nenhuma troca/venda encontrada para este cliente."}):e.jsx("ul",{className:"space-y-4",children:o.tradeInHistory.map(a=>e.jsxs("li",{className:"border border-border p-4 rounded-md bg-surface-secondary shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block font-bold text-primary text-base mb-1",children:a.model}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-xs text-muted",children:[e.jsxs("span",{className:"flex items-center gap-1 font-medium bg-gray-100 px-1.5 py-0.5 rounded text-gray-700",children:["ID Venda: #",a.saleId]}),e.jsxs("span",{className:"flex items-center gap-1",children:["Data: ",new Date(a.date).toLocaleString("pt-BR")]}),e.jsxs("span",{className:"flex items-center gap-1",children:["Vendedor: ",a.salespersonName]})]})]}),e.jsx("span",{className:"text-success font-black text-lg",children:v(a.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mt-3 pt-3 border-t border-border/50 text-xs",children:[e.jsxs("div",{className:"space-y-1",children:[a.imei1&&e.jsxs("p",{children:[e.jsx("span",{className:"font-bold text-gray-500",children:"IMEI 1:"})," ",e.jsx("span",{className:"font-mono",children:a.imei1})]}),a.imei2&&e.jsxs("p",{children:[e.jsx("span",{className:"font-bold text-gray-500",children:"IMEI 2:"})," ",e.jsx("span",{className:"font-mono",children:a.imei2})]})]}),e.jsxs("div",{className:"space-y-1 text-right sm:text-left",children:[a.serialNumber&&e.jsxs("p",{children:[e.jsx("span",{className:"font-bold text-gray-500",children:"S/N:"})," ",e.jsx("span",{className:"font-mono",children:a.serialNumber})]}),a.batteryHealth!==void 0&&a.batteryHealth!==null&&e.jsxs("p",{children:[e.jsx("span",{className:"font-bold text-gray-500",children:"Saúde Bateria:"})," ",e.jsxs("span",{className:`font-bold ${a.batteryHealth<80?"text-red-500":"text-green-600"}`,children:[a.batteryHealth,"%"]})]})]})]})]},a.id))}))]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{onClick:d,className:"px-4 py-2 bg-gray-200 text-secondary rounded-md hover:bg-gray-300",children:"Fechar"})})]})})},ge=o=>{if(!o)return null;const u=o.split("/");if(u.length===3){const d=parseInt(u[0],10),x=parseInt(u[1],10)-1,m=parseInt(u[2],10);if(!isNaN(d)&&!isNaN(x)&&!isNaN(m))return new Date(m,x,d)}const l=new Date(o+"T00:00:00");return isNaN(l.getTime())?null:l},fs=(o,u)=>{if(!o)return!1;const l=new Date;l.setHours(0,0,0,0);const d=ge(o);if(!d)return!1;const x=d.getMonth(),m=d.getDate();switch(u){case"dia":return x===l.getMonth()&&m===l.getDate();case"semana":const f=new Date(l);f.setDate(l.getDate()+6);const h=new Date(l.getFullYear(),x,m);if(h>=l&&h<=f)return!0;if(f.getFullYear()>l.getFullYear()){const a=new Date(l.getFullYear()+1,x,m);if(a>=l&&a<=f)return!0}return!1;case"mês":return x===l.getMonth()}return!1},Ss=()=>{const[o,u]=t.useState("clientes"),{showToast:l}=ze(),{permissions:d,user:x}=Ye(),[m,f]=t.useState(!0),[h,a]=t.useState(""),[r,i]=t.useState(!1),[p,j]=t.useState(null),[y,D]=t.useState([]),[je,W]=t.useState(!1),[E,H]=t.useState(null),[ye,Ne]=t.useState([]),[J,G]=t.useState(null),[K,we]=t.useState({}),[ve,Ce]=t.useState([]),[O,Se]=t.useState("newest"),[I,M]=t.useState("none"),[Q,C]=t.useState(!1),V=t.useRef(null),[F,R]=t.useState("none"),[X,k]=t.useState(!1),B=t.useRef(null),[Z,_]=t.useState([]),[ee,se]=t.useState(null),[$,De]=t.useState([]),[ke,Pe]=t.useState([]),[A,U]=t.useState(null),[te,ae]=t.useState(null),[Te,Ee]=t.useState([]),[z,Ie]=t.useState(!1),[Y,Me]=t.useState([]);t.useEffect(()=>{const s=c=>{V.current&&!V.current.contains(c.target)&&C(!1),B.current&&!B.current.contains(c.target)&&k(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const P=t.useCallback(async()=>{f(!0);try{const[s,c,g,w,b]=await Promise.all([qe(),We(),Je(),Ge(),Ke()]);D(s),De(g),we(c.reduce((n,N)=>({...n,[N.id]:N}),{})),Ce(c),Pe(w),Me(b);try{const n=await Qe();_(n)}catch(n){console.error("Error loading sales (non-critical):",n),_([])}}catch(s){console.error("Error loading data:",s),l("Erro ao carregar dados.","error")}finally{f(!1)}},[l]);t.useEffect(()=>{P()},[P]);const S=t.useMemo(()=>{const s=[];return d?.canAccessClientes&&s.push({id:"clientes",label:"Clientes"}),d?.canAccessFornecedores&&s.push({id:"fornecedores",label:"Fornecedores"}),s},[d]);t.useEffect(()=>{S.length>0&&!S.find(s=>s.id===o)&&u(S[0].id)},[S,o]);const L=(s=null)=>{j(s),i(!0)},re=()=>{i(!1),j(null)},[ne,le]=t.useState(!1),Fe=async(s,c,g)=>{if(!ne){le(!0),console.log("handleSaveEntity called with:",s,c,g);try{const w=!!s.id;if(c==="Cliente"||c==="Ambos"){const b={name:s.name,email:s.email,phone:s.phone,address:s.address,avatarUrl:s.avatarUrl};g==="Pessoa Física"&&(b.cpf=s.cpf,b.birthDate=s.birthDate),w&&o==="clientes"?await es({...b,id:s.id}):await ss(b)}if(c==="Fornecedor"||c==="Ambos"){const b={name:s.name,contactPerson:s.name,email:s.email,phone:s.phone,avatarUrl:s.avatarUrl};g==="Pessoa Jurídica"&&(b.cnpj=s.cnpj),w&&o==="fornecedores"?await ts({...b,id:s.id}):await as(b)}l("Dados salvos com sucesso!","success"),P(),re()}catch(w){console.error("Erro ao salvar entidade:",w),l(w.message||"Erro ao salvar.","error")}finally{le(!1)}}},oe=t.useMemo(()=>{let s=y.filter(n=>(n.name||"").toLowerCase().includes(h.toLowerCase())||n.email?.toLowerCase().includes(h.toLowerCase()));I!=="none"&&(s=s.filter(n=>fs(n.birthDate,I)));const c=new Map,g=new Map;Z.forEach(n=>{if(n.status!=="Cancelada"){const N=c.get(n.customerId)||0;c.set(n.customerId,N+n.total);const de=n.payments.filter(T=>T.type==="pending").reduce((T,Be)=>T+Be.value,0);if(de>0){const T=g.get(n.customerId)||0;g.set(n.customerId,T+de)}}});let b=s.map(n=>({...n,totalPurchases:c.get(n.id)||0,debt:g.get(n.id)||0}));return z&&(b=b.filter(n=>n.debt>0)),b.sort((n,N)=>F==="highest"?N.totalPurchases-n.totalPurchases:F==="lowest"?n.totalPurchases-N.totalPurchases:O==="newest"?new Date(N.createdAt).getTime()-new Date(n.createdAt).getTime():new Date(n.createdAt).getTime()-new Date(N.createdAt).getTime())},[y,h,O,I,F,Z,z]),Ae=async()=>{if(E)try{await rs(E.id,x?.id,x?.name),l("Cliente excluído com sucesso!","success"),P(),H(null)}catch{l("Erro ao excluir cliente.","error")}},Le=async s=>{const c=await ls(s.id),g=await os(s.id);Ne(g),G(c||s),W(!0)},ce=t.useMemo(()=>$.filter(s=>(s.name||"").toLowerCase().includes(h.toLowerCase())||s.cnpj?.toLowerCase().includes(h.toLowerCase())),[$,h]),He=async()=>{if(A)try{await ns(A.id,x?.id,x?.name),l("Fornecedor excluído com sucesso!","success"),P(),U(null)}catch{l("Erro ao excluir fornecedor.","error")}},Oe=s=>{const c=ke.filter(g=>g.supplierId===s.id);Ee(c),ae(s)},Ve=()=>e.jsxs("div",{className:"bg-surface rounded-lg border border-border p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative flex-grow sm:flex-grow-0",children:[e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-muted",children:e.jsx(ie,{})}),e.jsx("input",{type:"text",placeholder:"Buscar por nome ou email...",value:h,onChange:s=>a(s.target.value),className:"pl-10 p-2 border rounded-md w-full sm:w-80 bg-transparent border-border focus:ring-primary focus:border-primary h-10"})]}),e.jsxs("span",{className:"bg-gray-100 text-gray-700 px-3 py-2 rounded-md text-sm font-medium border border-gray-200",children:["Total: ",y.length]}),e.jsxs("button",{onClick:()=>Se(s=>s==="newest"?"oldest":"newest"),className:"h-10 px-3 py-2 bg-gray-200 text-secondary rounded-md hover:bg-gray-300 flex items-center gap-2 text-sm font-medium",children:[e.jsx(Xe,{className:"h-4 w-4"}),e.jsx("span",{children:O==="newest"?"Mais Recentes":"Mais Antigos"})]}),e.jsxs("div",{className:"relative",ref:V,children:[e.jsxs("button",{onClick:()=>C(s=>!s),className:`h-10 px-3 py-2 rounded-md flex items-center gap-2 text-sm font-medium transition-colors ${I!=="none"?"bg-accent text-white":"bg-gray-200 text-secondary hover:bg-gray-300"}`,children:[e.jsx(Ze,{className:"h-4 w-4"}),e.jsx("span",{children:"Aniversariantes"}),e.jsx(me,{className:`h-4 w-4 transition-transform ${Q?"rotate-180":""}`})]}),Q&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 w-40 bg-surface rounded-md shadow-lg border border-border z-10",children:[e.jsx("button",{onClick:()=>{M("dia"),C(!1)},className:"w-full text-left px-4 py-2 text-sm hover:bg-surface-secondary",children:"Do Dia"}),e.jsx("button",{onClick:()=>{M("semana"),C(!1)},className:"w-full text-left px-4 py-2 text-sm hover:bg-surface-secondary",children:"Da Semana"}),e.jsx("button",{onClick:()=>{M("mês"),C(!1)},className:"w-full text-left px-4 py-2 text-sm hover:bg-surface-secondary",children:"Do Mês"}),e.jsx("div",{className:"border-t border-border my-1"}),e.jsx("button",{onClick:()=>{M("none"),C(!1)},className:"w-full text-left px-4 py-2 text-sm text-danger hover:bg-surface-secondary",children:"Limpar Filtro"})]})]}),e.jsxs("div",{className:"relative",ref:B,children:[e.jsxs("button",{onClick:()=>k(s=>!s),className:`h-10 px-3 py-2 rounded-md flex items-center gap-2 text-sm font-medium transition-colors ${F!=="none"?"bg-accent text-white":"bg-gray-200 text-secondary hover:bg-gray-300"}`,children:[e.jsx(_e,{className:"h-4 w-4"}),e.jsx("span",{children:"Ranking"}),e.jsx(me,{className:`h-4 w-4 transition-transform ${X?"rotate-180":""}`})]}),X&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 w-48 bg-surface rounded-md shadow-lg border border-border z-10",children:[e.jsx("button",{onClick:()=>{R("highest"),k(!1)},className:"w-full text-left px-4 py-2 text-sm hover:bg-surface-secondary",children:"Mais Compram"}),e.jsx("button",{onClick:()=>{R("lowest"),k(!1)},className:"w-full text-left px-4 py-2 text-sm hover:bg-surface-secondary",children:"Menos Compram"}),e.jsx("div",{className:"border-t border-border my-1"}),e.jsx("button",{onClick:()=>{R("none"),k(!1)},className:"w-full text-left px-4 py-2 text-sm text-danger hover:bg-surface-secondary",children:"Limpar Ranking"})]})]}),e.jsxs("button",{onClick:()=>Ie(s=>!s),className:`h-10 px-3 py-2 rounded-md flex items-center gap-2 text-sm font-medium transition-colors ${z?"bg-red-600 text-white shadow-md":"bg-gray-200 text-secondary hover:bg-gray-300"}`,title:"Mostrar apenas clientes com dívidas em aberto",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:"Devedores"})]})]}),d?.canAccessClientes&&e.jsxs("button",{onClick:()=>L(),className:"px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 w-full sm:w-auto flex items-center justify-center gap-2 h-10",children:[e.jsx(xe,{className:"h-5 w-5"})," Adicionar Cliente"]})]}),m?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(q,{})}):oe.length===0?e.jsx("p",{className:"text-center text-muted py-8",children:"Nenhum cliente encontrado."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-muted",children:[e.jsx("thead",{className:"text-xs text-secondary uppercase bg-surface-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Nome"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Email"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Telefone"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Aniversário"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right",children:"Total Comprado"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right",children:"Em Aberto"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Ações"})]})}),e.jsx("tbody",{children:oe.map(s=>e.jsxs("tr",{className:"bg-surface border-b border-border hover:bg-surface-secondary",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-primary",children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.avatarUrl?e.jsx("img",{src:s.avatarUrl,alt:s.name,className:"h-10 w-10 rounded-full object-cover"}):e.jsx(pe,{className:"h-10 w-10 text-gray-300"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.name}),s.isBlocked&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-semibold rounded-full bg-red-100 text-red-800",children:"Bloqueado"}),s.customTag&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-semibold rounded-full bg-gray-100 text-gray-800",children:s.customTag})]})]})}),e.jsx("td",{className:"px-6 py-4",children:s.email}),e.jsx("td",{className:"px-6 py-4",children:s.phone}),e.jsx("td",{className:"px-6 py-4",children:(()=>{const c=ge(s.birthDate);return c?c.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"}):"N/A"})()}),e.jsx("td",{className:"px-6 py-4 text-right font-semibold text-success",children:s.totalPurchases>0?v(s.totalPurchases):"-"}),e.jsx("td",{className:"px-6 py-4 text-right font-bold text-red-600",children:s.debt>0?v(s.debt):"-"}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>Le(s),className:"text-secondary hover:text-primary",title:"Ver Histórico",children:e.jsx(ue,{className:"w-5 h-5"})}),d?.canAccessClientes&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>L(s),className:"text-secondary hover:text-primary",children:e.jsx(he,{})}),e.jsx("button",{onClick:()=>H(s),className:"text-secondary hover:text-danger",children:e.jsx(fe,{})})]})]})})]},s.id))})]})})]}),Re=()=>e.jsxs("div",{className:"bg-surface rounded-lg border border-border p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative flex-grow sm:flex-grow-0",children:[e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-muted",children:e.jsx(ie,{})}),e.jsx("input",{type:"text",placeholder:"Buscar por nome ou CNPJ...",value:h,onChange:s=>a(s.target.value),className:"pl-10 p-2 border rounded-md w-full sm:w-80 bg-transparent border-border focus:ring-primary focus:border-primary"})]}),e.jsxs("span",{className:"bg-gray-100 text-gray-700 px-3 py-2 rounded-md text-sm font-medium border border-gray-200",children:["Total: ",$.length]})]}),d?.canAccessFornecedores&&e.jsxs("button",{onClick:()=>L(),className:"px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 w-full sm:w-auto flex items-center justify-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5"}),"Adicionar Fornecedor"]})]}),m?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(q,{})}):ce.length===0?e.jsx("p",{className:"text-center text-muted py-8",children:"Nenhum fornecedor encontrado."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-muted",children:[e.jsx("thead",{className:"text-xs text-secondary uppercase bg-surface-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Fornecedor"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Contato"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"CNPJ"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Ações"})]})}),e.jsx("tbody",{children:ce.map(s=>e.jsxs("tr",{className:"bg-surface border-b border-border hover:bg-surface-secondary",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-primary",children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.avatarUrl?e.jsx("img",{src:s.avatarUrl,alt:s.name,className:"h-10 w-10 rounded-full object-cover"}):e.jsx(pe,{className:"h-10 w-10 text-gray-300"}),e.jsx("span",{children:s.name})]})}),e.jsxs("td",{className:"px-6 py-4",children:[s.contactPerson," - ",s.phone]}),e.jsx("td",{className:"px-6 py-4",children:s.cnpj}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>Oe(s),className:"text-secondary hover:text-primary",title:"Ver Histórico",children:e.jsx(ue,{className:"w-5 h-5"})}),d?.canAccessFornecedores&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>L(s),className:"text-secondary hover:text-primary",children:e.jsx(he,{})}),e.jsx("button",{onClick:()=>U(s),className:"text-secondary hover:text-danger",children:e.jsx(fe,{})})]})]})})]},s.id))})]})})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-primary",children:"Clientes e Fornecedores"}),e.jsx("div",{className:"inline-flex items-center gap-1 bg-surface-secondary p-1 rounded-lg",children:S.map(s=>e.jsx("button",{onClick:()=>{u(s.id),a("")},className:`px-3 py-1.5 rounded-md text-sm font-medium whitespace-nowrap transition-colors ${o===s.id?"bg-primary text-white shadow-sm":"text-muted hover:text-primary"}`,children:s.label},s.id))}),m?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(q,{})}):e.jsxs(e.Fragment,{children:[o==="clientes"&&Ve(),o==="fornecedores"&&Re(),S.length===0&&e.jsx("p",{className:"text-center text-muted p-6",children:"Você não tem permissão para acessar esta seção."})]}),r&&e.jsx(cs,{entity:p,initialType:o==="clientes"?"Cliente":"Fornecedor",onClose:re,onSave:Fe,isSaving:ne}),je&&J&&e.jsx(hs,{customer:J,sales:ye,users:Y,onClose:()=>{W(!1),G(null)},productMap:K,onViewSale:se}),e.jsx(be,{isOpen:!!E,onClose:()=>H(null),onConfirm:Ae,title:"Confirmar Exclusão",message:`Tem certeza que deseja excluir o cliente "${E?.name}"? Esta ação não pode ser desfeita.`}),te&&e.jsx(us,{supplier:te,purchases:Te,users:Y,products:ve,onClose:()=>ae(null)}),e.jsx(be,{isOpen:!!A,onClose:()=>U(null),onConfirm:He,title:"Confirmar Exclusão",message:`Tem certeza que deseja excluir o fornecedor "${A?.name}"?`}),ee&&e.jsx(is,{sale:ee,productMap:K,customers:y,users:Y,onClose:()=>se(null)})]})};export{Ss as default};
